<UserControl x:Class="ForRobot.Views.Controls.DragAndDropPopup"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:ForRobot.Views.Controls"
             xmlns:model="clr-namespace:ForRobot.Model.Controls"
             mc:Ignorable="d">

    <UserControl.Resources>
        <!--Colors-->
        <Color x:Key="Orange">#FFFFA21B</Color>

        <!--SolidColorBrush-->
        <SolidColorBrush x:Key="BrushOrange" Color="{DynamicResource Orange}"/>

        <!--Images-->
        <DrawingImage x:Key="UnknowFileImage">
            <DrawingImage.Drawing>
                <DrawingGroup>
                    <GeometryDrawing Brush="Black"
                                     Geometry="M12.57,17.29a1,1,0,0,0-1.41,0,1.06,1.06,0,0,0-.22.33,1.07,1.07,0,0,0,0,.76,1.19,1.19,0,0,0,.22.33,1,1,0,0,0,.32.21,1,1,0,0,0,.39.08,1,1,0,0,0,.92-1.38A.91.91,0,0,0,12.57,17.29ZM20,8.94a1.31,1.31,0,0,0-.06-.27l0-.09a1.07,1.07,0,0,0-.19-.28h0l-6-6h0a1.07,1.07,0,0,0-.28-.19l-.09,0A.88.88,0,0,0,13.05,2H7A3,3,0,0,0,4,5V19a3,3,0,0,0,3,3H17a3,3,0,0,0,3-3V9S20,9,20,8.94ZM14,5.41,16.59,8H15a1,1,0,0,1-1-1ZM18,19a1,1,0,0,1-1,1H7a1,1,0,0,1-1-1V5A1,1,0,0,1,7,4h5V7a3,3,0,0,0,3,3h3Zm-6.13-9a3,3,0,0,0-2.6,1.5,1,1,0,1,0,1.73,1,1,1,0,0,1,.87-.5,1,1,0,0,1,0,2,1,1,0,1,0,0,2,3,3,0,0,0,0-6Z"/>
                </DrawingGroup>
            </DrawingImage.Drawing>
        </DrawingImage>

        <DrawingImage x:Key="ProgramFileImage">
            <DrawingImage.Drawing>
                <DrawingGroup>
                    <GeometryDrawing Brush="Black"
                                     Geometry="M 26.5 2.5 H 2.5 C1.268738671875 2.4761015625000002 0.29 3.454885546875 0.29 4.662305078125v19.67538984375c0 1.207408203125 0.9787386718750001 2.186203515625 2.186158203125 2.186146875h24.047683593749998c1.207340234375 -0.0000453125 2.186158203125 -0.9788066406249999 2.186158203125 -2.186146875V4.662305078125c0 -1.20737421875 -0.97877265625 -2.186146875 -2.186158203125 -2.186146875Zm-12.43375 12.877812500000001 -5.465378515625 4.372305078125c-0.657382421875 0.525908203125 -1.637559765625 0.1429609375 -1.764321484375 -0.689305078125 -0.058826953125 -0.386255078125 0.09287929687499999 -0.7745605468750001 0.397968359375 -1.0186250000000001L11.656629296875 14.5 7.258360156250001 10.981654296875c-0.657382421875 -0.525908203125 -0.4989359375 -1.566237890625 0.285208203125 -1.872595703125 0.363916015625 -0.142179296875 0.776055859375 -0.07941015624999999 1.081144921875 0.164665625l5.465378515625 4.372305078125c0.547680859375 0.43759414062499996 0.547680859375 1.270347265625 0 1.70794140625Zm6.968371484375 4.611419140625h-5.465389843750001c-0.841441796875 -0.0000453125 -1.3673613281249999 -0.9109625000000001 -0.9466007812499999 -1.6396667968749998 0.195262890625 -0.33816718749999997 0.556108984375 -0.54649140625 0.9466007812499999 -0.54649140625h5.465389843750001c0.841453125 0 1.3673613281249999 0.9108945312500001 0.946634765625 1.63961015625 -0.1952515625 0.33818984375 -0.556131640625 0.5465253906249999 -0.946634765625 0.546548046875 Z"/>
                </DrawingGroup>
            </DrawingImage.Drawing>
        </DrawingImage>

        <DrawingImage x:Key="DataFileImage">
            <DrawingImage.Drawing>
                <DrawingGroup>
                    <GeometryDrawing Brush="Black"
                                     Geometry="M 26.204116796875 8.261261718750001 18.552580078124997 0.609725c-0.20516367187499998 -0.20493710937499998 -0.48335976562499994 -0.31995156249999995 -0.7733484375 -0.319725H4.662305078125c-1.20741953125 -0.000056640625 -2.186146875 0.9787386718750001 -2.186146875 2.186158203125v24.047683593749998c0 1.20741953125 0.9787273437499999 2.1862148437499997 2.186146875 2.186158203125h19.67538984375c1.20741953125 0.000056640625 2.186146875 -0.9787386718750001 2.186146875 -2.186158203125V9.034621484375c0.0002265625 -0.29 -0.11478789062500001 -0.568184765625 -0.319725 -0.773359765625Zm-7.33181171875 12.7972015625H10.127694921875c-0.841453125 -0.0000453125 -1.3673726562500002 -0.9109625000000001 -0.946612109375 -1.63965546875 0.195262890625 -0.338178515625 0.556108984375 -0.546502734375 0.946612109375 -0.546502734375h8.74461015625c0.841453125 0 1.3673613281249999 0.9108945312500001 0.946634765625 1.639621484375 -0.1952515625 0.338178515625 -0.556131640625 0.5465140625 -0.946634765625 0.54653671875Zm0 -4.372305078125H10.127694921875c-0.841453125 -0.0000453125 -1.3673726562500002 -0.9109625000000001 -0.946612109375 -1.6396667968749998C9.376345703125 14.70832421875 9.737191796875 14.5 10.127694921875 14.5h8.74461015625c0.841453125 0 1.3673613281249999 0.9108945312500001 0.946634765625 1.63961015625 -0.1952515625 0.33818984375 -0.556131640625 0.5465253906249999 -0.946634765625 0.546548046875Zm-1.0930734375 -7.65153671875V3.022694921875l6.0119265625 6.0119265625Z"/>
                </DrawingGroup>
            </DrawingImage.Drawing>
        </DrawingImage>

        <!--Template-->
        
        <!--<ControlTemplate x:Key="buttonTemplate" TargetType="{x:Type Button}">
            <Border Name="buttonPanel" BorderThickness="0" CornerRadius="5">
                <ContentPresenter x:Name="buttonContent"
                              VerticalAlignment="Center" HorizontalAlignment="Center"
                              ContentSource="Content"
                              Margin="{Binding Padding, RelativeSource={RelativeSource AncestorType={x:Type Button}, Mode=FindAncestor}}"/>

                <Border.Style>
                    <Style TargetType="{x:Type Border}">
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding Path=IsMouseOver, RelativeSource={RelativeSource AncestorType={x:Type Button}, Mode=FindAncestor}}" Value="True">
                                <Setter Property="Background" Value="{StaticResource BrushLightGray}"/>
                            </DataTrigger>

                            <DataTrigger Binding="{Binding Path=IsPressed, RelativeSource={RelativeSource AncestorType={x:Type Button}, Mode=FindAncestor}}" Value="True">
                                <Setter Property="Background" Value="{StaticResource BrushAqua}"/>
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </Border.Style>
            </Border>
        </ControlTemplate>-->

        <ControlTemplate x:Key="buttonTemplate" TargetType="{x:Type Button}">
            <Border Name="buttonPanel" BorderThickness="1" Padding="5, 5, 10, 5" CornerRadius="8">
                <ContentPresenter x:Name="ContentSite"
                                  VerticalAlignment="Center" HorizontalAlignment="Center"
                                  ContentSource="Content" Margin="{Binding Padding}"/>
                <Border.Style>
                    <Style TargetType="{x:Type Border}">
                        <Setter Property="BorderBrush" Value="{DynamicResource NotActiveBorderBrush}"/>
                        <Setter Property="Background" Value="White"/>
                    </Style>
                </Border.Style>
            </Border>

            <ControlTemplate.Triggers>
                <Trigger Property="IsPressed" Value="True">
                    <Setter TargetName="buttonPanel" Property="Background" Value="LightSkyBlue"/>
                    <Setter TargetName="buttonPanel" Property="BorderBrush" Value="{DynamicResource {x:Static SystemColors.HighlightBrushKey}}"/>
                </Trigger>
            </ControlTemplate.Triggers>
        </ControlTemplate>

        <ControlTemplate x:Key="listBoxItemTemplate" TargetType="{x:Type ListBoxItem}">
            <Button Height="Auto" Template="{DynamicResource buttonListBoxTemplate}">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <ProgressBar Grid.RowSpan="2"
                                 Panel.ZIndex="1" Background="Transparent" BorderThickness="0"
                                 Foreground="{DynamicResource  {x:Static SystemColors.HotTrackBrushKey}}"
                                 Minimum="0" Maximum="100" IsIndeterminate="True">

                        <ProgressBar.Style>
                            <Style TargetType="{x:Type ProgressBar}">
                                <Setter Property="Visibility" Value="Hidden"/>

                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding Path=IsCopy}" Value="False">
                                        <Setter Property="Visibility" Value="Visible"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </ProgressBar.Style>
                    </ProgressBar>

                    <Image Grid.Row="0" Height="40" Margin="5">
                        <Image.Style>
                            <Style TargetType="{x:Type Image}">
                                <Setter Property="Source" Value="{DynamicResource UnknowFileImage}"/>

                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding Path=Type}" Value="{x:Static model:FileTypes.Program}">
                                        <Setter Property="Source" Value="{DynamicResource ProgramFileImage}"/>
                                    </DataTrigger>

                                    <DataTrigger Binding="{Binding Path=Type}" Value="{x:Static model:FileTypes.DataList}">
                                        <Setter Property="Source" Value="{DynamicResource DataFileImage}"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </Image.Style>
                    </Image>

                    <Label Grid.Row="1" FontSize="13" Background="Transparent" VerticalAlignment="Bottom"
                                       HorizontalContentAlignment="Center" VerticalContentAlignment="Center">
                        <TextBlock TextWrapping="Wrap" TextAlignment="Center"
                                               Text="{Binding Path=FullName}"/>
                    </Label>
                </Grid>
            </Button>
        </ControlTemplate>

        <ControlTemplate x:Key="buttonListBoxTemplate" TargetType="{x:Type Button}">
            <Border Name="buttonPanel" Height="Auto" Width="90" Margin="2" CornerRadius="5"
                    BorderThickness="0" Background="White"
                    VerticalAlignment="Top" HorizontalAlignment="Stretch">
                
                <Grid>
                    <ContentPresenter x:Name="buttonContent"
                              VerticalAlignment="Stretch" HorizontalAlignment="Stretch"
                              ContentSource="Content"
                              Margin="{Binding Padding, RelativeSource={RelativeSource AncestorType={x:Type Button}, Mode=FindAncestor}}"/>

                    <Border Background="White" Opacity="0.9" CornerRadius="{Binding CornerRadius, RelativeSource={RelativeSource AncestorType={x:Type Border}, Mode=FindAncestor}}">
                        <Border.Style>
                            <Style TargetType="{x:Type Border}">
                                <Setter Property="Visibility" Value="Hidden"/>

                                <Style.Triggers>
                                    <MultiDataTrigger>
                                        <MultiDataTrigger.Conditions>
                                            <Condition Binding="{Binding Path=IsCopy}" Value="True"/>
                                            <Condition Binding="{Binding Path=IsMouseOver, RelativeSource={RelativeSource AncestorType={x:Type Button}, Mode=FindAncestor}}" Value="True"/>
                                        </MultiDataTrigger.Conditions>
                                        
                                        <Setter Property="Visibility" Value="Visible"/>
                                    </MultiDataTrigger>
                                </Style.Triggers>
                            </Style>
                        </Border.Style>
                        
                        <Label Foreground="#FF4D4D4D" FontSize="14" FontWeight="Bold"
                                   VerticalContentAlignment="Center" HorizontalContentAlignment="Center">
                            <TextBlock TextWrapping="WrapWithOverflow" TextAlignment="Center">Нажмите дважды для удаления</TextBlock>
                        </Label>
                    </Border>
                </Grid>

                <!--<Border.Style>
                    <Style TargetType="{x:Type Border}">
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding Path=IsMouseOver, RelativeSource={RelativeSource AncestorType={x:Type Button}, Mode=FindAncestor}}" Value="True">
                                <Setter Property="Background" Value="{DynamicResource BrushLightGray}"/>
                            </DataTrigger>

                            <DataTrigger Binding="{Binding Path=IsPressed, RelativeSource={RelativeSource AncestorType={x:Type Button}, Mode=FindAncestor}}" Value="True">
                                <Setter Property="Background" Value="{DynamicResource BrushAqua}"/>
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </Border.Style>-->
            </Border>

            <ControlTemplate.Triggers>
                <!--<Trigger Property="IsMouseOver" Value="True">
                    <Setter TargetName="buttonPanel" Property="Background" Value="{DynamicResource BrushLightGray}"/>

                    --><!--<Setter TargetName="buttonContent" Property="ContentSource">
                        <Setter.Value>
                            <StackPanel/>
                        </Setter.Value>
                    </Setter>-->

                    <!--<Setter Property="Template">
                        <Setter.Value>
                            <ControlTemplate TargetType="{x:Type Button}">
                                <Border Background="Aquamarine"/>
                            </ControlTemplate>
                        </Setter.Value>
                    </Setter>--><!--
                </Trigger>-->

                <MultiDataTrigger>
                    <MultiDataTrigger.Conditions>
                        <Condition Binding="{Binding Path=IsCopy}" Value="True"/>
                        <Condition Binding="{Binding Path=IsMouseOver, RelativeSource={RelativeSource Self}}" Value="True"/>
                    </MultiDataTrigger.Conditions>

                    <!--<Setter TargetName="buttonPanel" Property="Template">
                        <Setter.Value>
                            
                        </Setter.Value>
                    </Setter>-->
                </MultiDataTrigger>
            </ControlTemplate.Triggers>
        </ControlTemplate>
    </UserControl.Resources>

    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*"/>
            <ColumnDefinition Width="Auto"/>
        </Grid.ColumnDefinitions>

        <Border Grid.Column="0" AllowDrop="True"
                Background="Transparent" BorderBrush="{StaticResource BrushOrange}" BorderThickness="5" CornerRadius="8"
                Drop="Border_Drop"
                DragEnter="Border_DragEnter"
                DragLeave="Border_DragLeave">

            <Grid>
                <ListBox Background="Transparent" BorderBrush="Transparent" BorderThickness="0"
                         MaxHeight="200" Height="Auto" Padding="0" Margin="0"
                         HorizontalAlignment="Stretch" VerticalAlignment="Stretch"
                         HorizontalContentAlignment="Stretch" VerticalContentAlignment="Stretch"
                         ScrollViewer.CanContentScroll="True" ScrollViewer.VerticalScrollBarVisibility="Auto" ScrollViewer.HorizontalScrollBarVisibility="Hidden"
                         ItemsSource="{Binding Path=CopyFiles, Mode=OneWay, UpdateSourceTrigger=PropertyChanged,
                            RelativeSource={RelativeSource AncestorType={x:Type local:DragAndDropPopup}, Mode=FindAncestor}}">

                    <ListBox.ItemsPanel>
                        <ItemsPanelTemplate>
                            <WrapPanel IsItemsHost="True" Orientation="Horizontal" MaxWidth="290"/>
                        </ItemsPanelTemplate>
                    </ListBox.ItemsPanel>

                    <ListBox.ItemContainerStyle>
                        <Style TargetType="{x:Type ListBoxItem}">
                            <Setter Property="Template" Value="{StaticResource listBoxItemTemplate}"/>
                        </Style>
                    </ListBox.ItemContainerStyle>
                </ListBox>

                <Grid>
                    <Grid.Style>
                        <Style TargetType="{x:Type Grid}">
                            <Setter Property="Visibility" Value="Hidden"/>

                            <Style.Triggers>
                                <DataTrigger Binding="{Binding Path=IsAddingFile, RelativeSource={RelativeSource AncestorType={x:Type local:DragAndDropPopup}, Mode=FindAncestor}}" Value="True">
                                    <Setter Property="Visibility" Value="Visible"/>
                                </DataTrigger>

                                <DataTrigger Binding="{Binding Path=CopyFiles.Count, RelativeSource={RelativeSource AncestorType={x:Type local:DragAndDropPopup}, Mode=FindAncestor}}" Value="0">
                                    <Setter Property="Visibility" Value="Visible"/>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </Grid.Style>

                    <Border Background="White" Opacity="0.8" CornerRadius="5"/>
                    <Label Foreground="#FF4D4D4D" FontSize="20" FontWeight="Bold"
                           VerticalContentAlignment="Center" HorizontalContentAlignment="Center">
                        <TextBlock TextWrapping="WrapWithOverflow" TextAlignment="Center">Добавление файла</TextBlock>
                    </Label>
                </Grid>
            </Grid>
        </Border>

        <Button Grid.Column="1" Margin="5, 0, 0, 0"
                VerticalAlignment="Center"
                Width="60"
                Height="{Binding Path=ActualWidth, RelativeSource={RelativeSource Self}}"
                Template="{StaticResource buttonTemplate}"
                Command="{Binding Path=SelectedFilesCommand, RelativeSource={RelativeSource AncestorType={x:Type local:DragAndDropPopup}, Mode=FindAncestor}}">

            <Path Stroke="Black" Stretch="None" StrokeThickness="1.3" RenderTransformOrigin="0.6, 0.6">
                <Path.RenderTransform>
                    <ScaleTransform ScaleX="2" ScaleY="2"/>
                </Path.RenderTransform>
                
                <Path.Data>
                    <GeometryGroup>
                        <PathGeometry Figures="M13.5 3H12H8C6.34315 3 5 4.34315 5 6V18C5 19.6569 6.34315 21 8 21H11M13.5 3L19 8.625M13.5 3V7.625C13.5 8.17728 13.9477 8.625 14.5 8.625H19M19 8.625V11.8125"/>
                        <PathGeometry Figures="M17 15V18M17 21V18M17 18H14M17 18H20"/>
                    </GeometryGroup>
                </Path.Data>
            </Path>
        </Button>
    </Grid>
</UserControl>
