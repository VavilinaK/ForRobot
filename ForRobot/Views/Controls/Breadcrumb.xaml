<ComboBox x:Class="ForRobot.Views.Controls.Breadcrumb"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:i="http://schemas.microsoft.com/expression/2010/interactivity"
             xmlns:local="clr-namespace:ForRobot.Views.Controls"
             xmlns:conv="clr-namespace:ForRobot.Libr.Converters"
             mc:Ignorable="d">
    
    <ComboBox.Resources>
        <!--Colors-->
        <Color x:Key="DarkGrayColor">#FF707070</Color>
        <Color x:Key="BlackColor">#FF000000</Color>
        <Color x:Key="LightBlue">#b5eaff</Color>
        <Color x:Key="LightMediumBlue">#85caff</Color>
        <Color x:Key="Yellow">#FFCB42</Color>

        <!--SolidColorBrushs-->
        <SolidColorBrush x:Key="WhiteBrush" Color="White"/>
        <SolidColorBrush x:Key="NotActiveBorderBrush" Color="{DynamicResource DarkGrayColor}"/>
        <SolidColorBrush x:Key="ActiveBackround" Color="{DynamicResource LightBlue}"/>
        <SolidColorBrush x:Key="IsSelectedBackround" Color="{DynamicResource LightMediumBlue}"/>
        <SolidColorBrush x:Key="FolderIconStroke" Color="{DynamicResource Yellow}"/>

        <!--Geometry-->
        <Geometry x:Key="HomeIcon">M 9, 20 V 14 H 13 V 20 H 19 V 12 H 22 L 11, 2 L 0,12 H 3 V 20 Z</Geometry>
        <Geometry x:Key="UpdateIcon">M 10,3 H 4 L 6,5 A 12,12 180 1,0 17,3 C 17,3 16,3 16,6 A 9,9 180 1,1 8.5,7 L 11,9 V 3 Z</Geometry>
        <Geometry x:Key="SendIcon">M 0 0 V 1 H 8 v-1 h-8 Z M 4 2l-3 3 h 2 v 3 h 2 v-3 h 2l-3-3 Z</Geometry>
        <Geometry x:Key="DeleteIcon">M 10.6 34 c -0.7 0 -1.2 -0.2 -1.7 -0.7 -0.5 -0.5 -0.7 -1 -0.7 -1.7 V 8.5 H 7.7 c -0.3 0 -0.634700625 -0.11756875 -0.86815625 -0.352625C6.616861875 7.943812499999999 6.5 7.652669375 6.5 7.3051875c0 -0.34720562499999996 0.116861875 -0.635919375 0.35059375 -0.866125C7.084049375 6.208856875 7.3734375 6.09375 7.71875 6.09375h6.41875c0 -0.352080625 0.11683750000000001 -0.643231875 0.35059375 -0.8734375C14.721525 4.990106875 15.0109375 4.875 15.35625 4.875h8.2875c0.34531249999999997 0 0.63480625 0.116731875 0.8685624999999999 0.3501875 0.23343125 0.23373187499999998 0.3501875 0.52325 0.3501875 0.8685624999999999h6.41875c0.34531249999999997 0 0.63480625 0.11754437499999999 0.8685624999999999 0.352625 0.23343125 0.23481249999999998 0.3501875 0.5259556249999999 0.3501875 0.8734375 0 0.34720562499999996 -0.11675624999999999 0.635919375 -0.3501875 0.866125 -0.23375625 0.23018125 -0.52325 0.34531249999999997 -0.8685624999999999 0.34531249999999997h-0.446875V31.6875c0 0.6703125 -0.23863125000000002 1.2441 -0.7158125 1.72128125 -0.47750625 0.47750625 -1.051375 0.7162187499999999 -1.7216875000000003 0.7162187499999999h-17.79375Zm17.79375 -25.59375h-17.79375V31.6875h17.79375V8.53125ZM16.135437500000002 28.19375c0.34718125 0 0.6359437499999999 -0.11683750000000001 0.866125 -0.35059375 0.23018125 -0.23343125 0.34531249999999997 -0.5228437499999999 0.34531249999999997 -0.86815625V13.203125c0 -0.34531249999999997 -0.11756875 -0.63480625 -0.352625 -0.8685624999999999 -0.23481249999999998 -0.23343125 -0.52593125 -0.3501875 -0.8734375 -0.3501875 -0.34718125 0 -0.6359437499999999 0.11675624999999999 -0.866125 0.3501875 -0.23018125 0.23375625 -0.34531249999999997 0.52325 -0.34531249999999997 0.8685624999999999V26.975c0 0.34531249999999997 0.11756875 0.634725 0.352625 0.86815625 0.23481249999999998 0.23375625 0.52593125 0.35059375 0.8734375 0.35059375Zm6.74375 0c0.34718125 0 0.6359437499999999 -0.11683750000000001 0.866125 -0.35059375 0.23018125 -0.23343125 0.34531249999999997 -0.5228437499999999 0.34531249999999997 -0.86815625V13.203125c0 -0.34531249999999997 -0.11756875 -0.63480625 -0.352625 -0.8685624999999999 -0.23481249999999998 -0.23343125 -0.52593125 -0.3501875 -0.8734375 -0.3501875 -0.34718125 0 -0.6359437499999999 0.11675624999999999 -0.866125 0.3501875 -0.23018125 0.23375625 -0.34531249999999997 0.52325 -0.34531249999999997 0.8685624999999999V26.975c0 0.34531249999999997 0.11756875 0.634725 0.352625 0.86815625 0.23481249999999998 0.23375625 0.52593125 0.35059375 0.8734375 0.35059375Z</Geometry>
        <Geometry x:Key="FolderIcon">M22.035416666666666 8.881458333333333C22.496145833333333 8.881458333333333 22.93885416666667 8.950208333333334 23.354895833333334 9.076875000000001V8.881458333333333C23.354895833333334 6.883020833333334 21.734895833333336 5.263020833333334 19.736458333333335 5.263020833333334H15.057708333333334C14.8178125 5.2628125 14.587916666666668 5.167291666666667 14.4184375 4.997604166666667L11.860104166666668 2.4405208333333337C11.351354166666667 1.9311458333333336 10.661041666666668 1.6447916666666667 9.941145833333334 1.6444791666666667H5.262395833333334C3.2639583333333335 1.6444791666666667 1.6438541666666668 3.264479166666667 1.6438541666666668 5.2629166666666665V9.076875000000001C2.0716666666666668 8.946979166666667 2.516354166666667 8.881145833333335 2.9634375000000004 8.881458333333333H22.035416666666666ZM2.9634375000000004 10.690729166666667C1.3121875 10.691041666666669 0.043854166666666666 12.153541666666667 0.27729166666666666 13.78822916666667L1.3109375 21.025208333333335C1.5017708333333335 22.362083333333334 2.646666666666667 23.3553125 3.9970833333333338 23.355520833333333H21.002916666666668C22.353333333333335 23.3553125 23.49822916666667 22.362083333333334 23.6890625 21.025208333333335L24.722708333333333 13.78822916666667C24.956145833333334 12.153541666666667 23.687812500000003 10.691041666666669 22.036562500000002 10.690729166666667H2.9634375000000004Z</Geometry>
        <Geometry x:Key="NormalArrow">M0,0 L4,3.5 0,7 z</Geometry>
        <Geometry x:Key="ExpandedArrow">M0,3 L7,3 3.5,7 z</Geometry>
        
        <!--Converters-->
        <conv:ArrayMultiValueConverter x:Key="ArrayMultiValueConvert"/>
        <!--<conv:NullBooleanConverter x:Key="NullBooleanConvert"/>-->

        <!--Styles-->


        <!--Template-->
        <ControlTemplate x:Key="buttonTemplate" TargetType="{x:Type Button}">
            <Border Name="Panel" BorderThickness="1" BorderBrush="{DynamicResource NotActiveBorderBrush}" Background="Transparent">
                <ContentPresenter x:Name="Content"
                                  VerticalAlignment="Center" HorizontalAlignment="Center"
                                  ContentSource="Content" Margin="5"/>
            </Border>

            <ControlTemplate.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter TargetName="Panel" Property="Background" Value="{DynamicResource ActiveBackround}"/>
                    <Setter TargetName="Panel" Property="BorderBrush" Value="{DynamicResource {x:Static SystemColors.HighlightBrushKey}}"/>
                </Trigger>

                <Trigger Property="IsPressed" Value="True">
                    <Setter TargetName="Panel" Property="Background" Value="{DynamicResource ActiveBackround}"/>
                    <Setter TargetName="Panel" Property="BorderBrush" Value="{DynamicResource {x:Static SystemColors.HighlightBrushKey}}"/>
                </Trigger>
            </ControlTemplate.Triggers>
        </ControlTemplate>

        <ControlTemplate x:Key="listBoxItemTemplate" TargetType="{x:Type ListBoxItem}">
            <Border BorderThickness="0">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <ContentPresenter Grid.Column="0" VerticalAlignment="Center" HorizontalAlignment="Center" Margin="5, 0"
                                      Content="{Binding Path=Content, RelativeSource={RelativeSource AncestorType={x:Type ListBoxItem}, Mode=FindAncestor}}"/>

                    <ToggleButton Grid.Column="1" x:Name="toggleButtonMenu"
                                  IsChecked="{Binding Path=IsSelected, RelativeSource={RelativeSource AncestorType=ListBoxItem, Mode=FindAncestor}, UpdateSourceTrigger=PropertyChanged, Mode=TwoWay}">

                        <ToggleButton.Template>
                            <ControlTemplate TargetType="{x:Type ToggleButton}">
                                <Border Background="Transparent" BorderThickness="0.5">
                                    <Path Fill="#FF000000" HorizontalAlignment="Center" VerticalAlignment="Center"
                                          Margin="5" IsHitTestVisible="True">

                                        <Path.Style>
                                            <Style TargetType="{x:Type Path}">
                                                <Setter Property="Data" Value="{StaticResource NormalArrow}"/>

                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding Path=IsChecked, RelativeSource={RelativeSource AncestorType={x:Type ToggleButton}, Mode=FindAncestor}}" Value="True">
                                                        <Setter Property="Data" Value="{StaticResource ExpandedArrow}"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </Path.Style>
                                    </Path>

                                    <Border.Style>
                                        <Style TargetType="{x:Type Border}">
                                            <Setter Property="BorderBrush" Value="Transparent"/>

                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding Path=IsSelected, RelativeSource={RelativeSource AncestorType={x:Type ListBoxItem}, Mode=FindAncestor}}"  Value="True">
                                                    <Setter Property="BorderBrush" Value="{DynamicResource {x:Static SystemColors.HighlightBrushKey}}"/>
                                                </DataTrigger>

                                                <DataTrigger Binding="{Binding Path=IsPressed, RelativeSource={RelativeSource AncestorType={x:Type ListBoxItem}, Mode=FindAncestor}}"  Value="True">
                                                    <Setter Property="BorderBrush" Value="{DynamicResource {x:Static SystemColors.HighlightBrushKey}}"/>
                                                </DataTrigger>

                                                <DataTrigger Binding="{Binding Path=IsMouseOver, RelativeSource={RelativeSource AncestorType={x:Type ListBoxItem}, Mode=FindAncestor}}" Value="True">
                                                    <Setter Property="BorderBrush" Value="{DynamicResource {x:Static SystemColors.HighlightBrushKey}}"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Border.Style>
                                </Border>
                            </ControlTemplate>
                        </ToggleButton.Template>
                    </ToggleButton>

                    <Popup IsOpen="{Binding Path=IsChecked, ElementName=toggleButtonMenu}" StaysOpen="False" Placement="Bottom"
                           PlacementTarget="{Binding ElementName=toggleButtonMenu}" AllowsTransparency="True"
                           PopupAnimation="{DynamicResource {x:Static SystemParameters.ComboBoxPopupAnimationKey}}">

                        <Border BorderBrush="Black" BorderThickness="1">
                            <ListBox FontSize="14" SelectionMode="Single" Margin="{Binding Padding}"
                                     ItemsSource="{Binding Path=ChildrenFolder, RelativeSource={RelativeSource AncestorType={x:Type local:Breadcrumb}, Mode=FindAncestor}}">

                                <ListBox.ItemTemplate>
                                    <DataTemplate>
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>

                                            <Image Grid.Column="0" Source="{Binding Icon}" Stretch="Fill" Height="25"/>
                                            <Label Grid.Column="1" Content="{Binding Name}"/>
                                        </Grid>
                                    </DataTemplate>
                                </ListBox.ItemTemplate>

                                <i:Interaction.Triggers>
                                    <i:EventTrigger EventName="SelectionChanged">
                                        <i:InvokeCommandAction Command="{Binding Path=SelectMenuItemCommand, RelativeSource={RelativeSource AncestorType={x:Type local:Breadcrumb}, Mode=FindAncestor}}">
                                            <i:InvokeCommandAction.CommandParameter>
                                                <MultiBinding Converter="{StaticResource ArrayMultiValueConvert}">
                                                    <Binding Path="." RelativeSource="{RelativeSource AncestorType={x:Type local:Breadcrumb}, Mode=FindAncestor}"/>
                                                    <Binding Path="SelectedItem" RelativeSource="{RelativeSource AncestorType={x:Type ListBox}, Mode=FindAncestor}"/>
                                                </MultiBinding>
                                            </i:InvokeCommandAction.CommandParameter>
                                        </i:InvokeCommandAction>
                                    </i:EventTrigger>
                                </i:Interaction.Triggers>
                            </ListBox>

                            <Border.Style>
                                <Style TargetType="{x:Type Border}">
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding Path=CanOpenMenu, RelativeSource={RelativeSource AncestorType={x:Type local:Breadcrumb}, Mode=FindAncestor}}"
                                                     Value="False">
                                            <Setter Property="Visibility" Value="Hidden"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Border.Style>
                        </Border>
                    </Popup>
                </Grid>

                <Border.Style>
                    <Style TargetType="{x:Type Border}">
                        <Setter Property="Background" Value="Transparent"/>

                        <Style.Triggers>
                            <DataTrigger Binding="{Binding Path=IsSelected, RelativeSource={RelativeSource AncestorType={x:Type ListBoxItem}, Mode=FindAncestor}}"  Value="True">
                                <Setter Property="Background" Value="{DynamicResource IsSelectedBackround}"/>
                            </DataTrigger>

                            <DataTrigger Binding="{Binding Path=IsPressed, RelativeSource={RelativeSource AncestorType={x:Type ListBoxItem}, Mode=FindAncestor}}"  Value="True">
                                <Setter Property="Background" Value="{DynamicResource ActiveBackround}"/>
                            </DataTrigger>

                            <MultiDataTrigger>
                                <MultiDataTrigger.Conditions>
                                    <Condition Binding="{Binding Path=IsMouseOver, RelativeSource={RelativeSource AncestorType={x:Type ListBoxItem}, Mode=FindAncestor}}" Value="True"/>
                                    <Condition Binding="{Binding Path=IsSelected, RelativeSource={RelativeSource AncestorType={x:Type ListBoxItem}, Mode=FindAncestor}}"  Value="False"/>
                                </MultiDataTrigger.Conditions>

                                <Setter Property="Background" Value="{DynamicResource ActiveBackround}"/>
                            </MultiDataTrigger>
                        </Style.Triggers>
                    </Style>
                </Border.Style>

                <Border.InputBindings>
                    <MouseBinding MouseAction="LeftClick" Command="{Binding Path=SelectDirectoryCommand, RelativeSource={RelativeSource AncestorType={x:Type local:Breadcrumb}, Mode=FindAncestor}}">
                        <MouseBinding.CommandParameter>
                            <MultiBinding Converter="{StaticResource ArrayMultiValueConvert}">
                                <Binding Path="ItemsSource" RelativeSource="{RelativeSource AncestorType={x:Type local:Breadcrumb}, Mode=FindAncestor}"/>
                                <Binding Path="Content" RelativeSource="{RelativeSource AncestorType={x:Type ListBoxItem}, Mode=FindAncestor}"/>
                                <Binding Path="." RelativeSource="{RelativeSource AncestorType={x:Type local:Breadcrumb}, Mode=FindAncestor}"/>
                            </MultiBinding>
                        </MouseBinding.CommandParameter>
                    </MouseBinding>
                </Border.InputBindings>
            </Border>
        </ControlTemplate>
    </ComboBox.Resources>

    <ComboBox.Style>
        <Style TargetType="{x:Type ComboBox}">
            <Setter Property="Focusable" Value="False"/>
            <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
            <Setter Property="VerticalContentAlignment" Value="Stretch"/>
            <Setter Property="ItemsPanel">
                <Setter.Value>
                    <ItemsPanelTemplate>
                        <StackPanel IsItemsHost="True" />
                    </ItemsPanelTemplate>
                </Setter.Value>
            </Setter>

            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="{x:Type ComboBox}">
                        <ControlTemplate.Resources>
                            <Style TargetType="{x:Type Button}">
                                <Setter Property="Width" Value="Auto"/>
                                <Setter Property="Height" Value="{Binding Path=ActualHeight, RelativeSource={RelativeSource AncestorType={x:Type local:Breadcrumb}, Mode=FindAncestor}}"/>
                                <Setter Property="Margin" Value="0"/>
                                <Setter Property="Template" Value="{StaticResource buttonTemplate}"/>
                            </Style>

                            <Style TargetType="{x:Type Path}">
                                <Setter Property="Stretch" Value="Uniform"/>
                                <Setter Property="Fill" Value="{Binding Path=IconsBackground, RelativeSource={RelativeSource AncestorType={x:Type local:Breadcrumb}, Mode=FindAncestor}}"/>

                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding Path=IconsBackground, RelativeSource={RelativeSource AncestorType={x:Type local:Breadcrumb}, Mode=FindAncestor}}" Value="{x:Null}">
                                        <Setter Property="Fill" Value="Black"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </ControlTemplate.Resources>
                        
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <Grid.Style>                                
                                <Style TargetType="{x:Type Grid}">
                                    <Setter Property="Background" Value="{Binding Path=Background, RelativeSource={RelativeSource AncestorType={x:Type local:Breadcrumb}, Mode=FindAncestor}}"/>

                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding Path=Background, RelativeSource={RelativeSource AncestorType={x:Type local:Breadcrumb}, Mode=FindAncestor}}"
                                                     Value="{x:Null}">
                                            
                                            <Setter Property="Background" Value="White"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Grid.Style>

                            <Button Grid.Column="0" x:Name="buttonHome" ToolTip="Возврат к начальной папке"
                                    Command="{Binding Path=HomeCommand, RelativeSource={RelativeSource AncestorType={x:Type local:Breadcrumb}, Mode=FindAncestor}}"
                                    CommandParameter="{Binding Path=., RelativeSource={RelativeSource AncestorType={x:Type local:Breadcrumb}, Mode=FindAncestor}}">

                                <Path Data="{StaticResource HomeIcon}"/>
                            </Button>

                            <Border Grid.Column="1" BorderThickness="1"
                                    Height="{Binding Path=ActualHeight, RelativeSource={RelativeSource AncestorType={x:Type local:Breadcrumb}, Mode=FindAncestor}}">
                              
                                <Border.Style>
                                    <Style TargetType="{x:Type Border}">
                                        <Setter Property="BorderBrush" Value="{DynamicResource NotActiveBorderBrush}"/>

                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding Path=IsChecked, ElementName=togglePath}" Value="True">
                                                <Setter Property="BorderBrush" Value="{DynamicResource {x:Static SystemColors.HighlightBrushKey}}"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </Border.Style>

                                <Grid>
                                    <ProgressBar x:Name="progressBar" Panel.ZIndex="1" Background="Transparent" BorderThickness="0"
                                                 Foreground="{DynamicResource {x:Static SystemColors.HotTrackBrushKey}}"
                                                 Minimum="0" Maximum="100" IsIndeterminate="True" 
                                                 Value="{Binding ElementName=BreadcrumbControl, Path=Progress}">
                                        
                                        <ProgressBar.Style>
                                            <Style TargetType="{x:Type ProgressBar}">
                                                <Setter Property="Visibility" Value="Hidden"/>

                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding Path=IsProgress, RelativeSource={RelativeSource AncestorType={x:Type local:Breadcrumb}, Mode=FindAncestor}}" Value="True">
                                                        <Setter Property="Visibility" Value="Visible"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </ProgressBar.Style>
                                    </ProgressBar>

                                    <Grid>
                                        <Grid.Style>
                                            <Style TargetType="{x:Type Grid}">
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding Path=Visibility, ElementName=progressBar}" Value="Visible">
                                                        <Setter Property="IsEnabled" Value="False"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </Grid.Style>

                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>

                                        <ToggleButton x:Name="togglePath" Grid.Column="0" IsChecked="False" Padding="0" Margin="0"
                                                  Focusable="False" Background="Transparent" BorderThickness="0"
                                                  Width="{Binding Path=ActualHeight, RelativeSource={RelativeSource Self}}">

                                            <Path Fill="{StaticResource FolderIconStroke}" Stretch="None"
                                                  Data="{StaticResource FolderIcon}"/>
                                        </ToggleButton>

                                        <ContentControl Grid.Column="1">
                                            <ContentControl.Style>
                                                <Style TargetType="{x:Type ContentControl}">
                                                    <Setter Property="Template">
                                                        <Setter.Value>
                                                            <ControlTemplate TargetType="{x:Type ContentControl}">
                                                                <ListBox x:Name="listBoxFolders" Margin="0" Padding="-8, 0, 0, 0"
                                                                         FontFamily="{Binding Path=FontFamily, RelativeSource={RelativeSource AncestorType={x:Type local:Breadcrumb}, Mode=FindAncestor}}"
                                                                         Foreground="{Binding Path=Foreground, RelativeSource={RelativeSource AncestorType={x:Type local:Breadcrumb}, Mode=FindAncestor}}"
                                                                         FontSize="{Binding Path=FontSize, RelativeSource={RelativeSource AncestorType={x:Type local:Breadcrumb}, Mode=FindAncestor}}"
                                                                         Background="Transparent" BorderBrush="Transparent" BorderThickness="0"
                                                                         HorizontalAlignment="Stretch" HorizontalContentAlignment="Left"
                                                                         ScrollViewer.HorizontalScrollBarVisibility="Hidden" ScrollViewer.VerticalScrollBarVisibility="Hidden"
                                                                         ItemsSource="{Binding Path=FoldersCollection, Mode=OneWay, UpdateSourceTrigger=PropertyChanged,
                                                                                       RelativeSource={RelativeSource AncestorType={x:Type ComboBox}, Mode=FindAncestor}}"
                                                                         Height="{Binding Path=ActualHeight, RelativeSource={RelativeSource AncestorType={x:Type local:Breadcrumb}, Mode=FindAncestor}}"
                                                                         SelectedItem="{Binding Path=SelectedFolder, Mode=OneWayToSource, RelativeSource={RelativeSource AncestorType={x:Type local:Breadcrumb}, Mode=FindAncestor}}">

                                                                    <ListBox.ItemContainerStyle>
                                                                        <Style TargetType="{x:Type ListBoxItem}">
                                                                            <Setter Property="Template" Value="{StaticResource listBoxItemTemplate}"/>
                                                                        </Style>
                                                                    </ListBox.ItemContainerStyle>                                                                   

                                                                    <ListBox.ItemsPanel>
                                                                        <ItemsPanelTemplate>
                                                                            <StackPanel Margin="8,0,0,0" Orientation="Horizontal"/>
                                                                        </ItemsPanelTemplate>
                                                                    </ListBox.ItemsPanel>
                                                                </ListBox>
                                                            </ControlTemplate>
                                                        </Setter.Value>
                                                    </Setter>

                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding Path=IsChecked, ElementName=togglePath}" Value="True">
                                                            <Setter Property="Template">
                                                                <Setter.Value>
                                                                    <ControlTemplate TargetType="{x:Type ContentControl}">
                                                                        <TextBox x:Name="textBoxFullPath"
                                                                                 Text="{Binding Path=Directory, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, 
                                                                                    RelativeSource={RelativeSource AncestorType={x:Type ComboBox}, Mode=FindAncestor}}"
                                                                                 VerticalContentAlignment="Center" HorizontalContentAlignment="Left"/>
                                                                    </ControlTemplate>
                                                                </Setter.Value>
                                                            </Setter>
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </ContentControl.Style>
                                        </ContentControl>
                                    </Grid>
                                </Grid>
                            </Border>

                            <Button Grid.Column="2" ToolTip="Обновить дерево файлов"
                                    Command="{Binding Path=UpDateCommand, RelativeSource={RelativeSource AncestorType={x:Type local:Breadcrumb}, Mode=FindAncestor}}">

                                <Path Data="{StaticResource UpdateIcon}"/>
                            </Button>

                            <Button Grid.Column="3" Width="35" ToolTip="Отправление файла/ов на робота"                                    
                                    Command="{Binding Path=SelectFilesCommand, RelativeSource={RelativeSource AncestorType={x:Type local:Breadcrumb}, Mode=FindAncestor}}">

                                <Path Data="{StaticResource SendIcon}"/>
                            </Button>

                            <Button Grid.Column="4" ToolTip="Удаление файла/ов"
                                    Command="{Binding Path=DeleteFilesCommand, RelativeSource={RelativeSource AncestorType={x:Type local:Breadcrumb}, Mode=FindAncestor}}">

                                <Path Data="{StaticResource DeleteIcon}"/>
                            </Button>
                        </Grid>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </ComboBox.Style>
</ComboBox>
