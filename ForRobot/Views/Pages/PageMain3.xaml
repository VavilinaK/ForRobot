<Page x:Class="ForRobot.Views.Pages.PageMain3"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
      xmlns:client="clr-namespace:ForRobot.Libr.Client"
      xmlns:control="clr-namespace:ForRobot.Views.Controls"
      xmlns:lib="clr-namespace:ForRobot.Libr"
      xmlns:vm="clr-namespace:ForRobot.ViewModels"  
      xmlns:local="clr-namespace:ForRobot.Views.Pages"       
      xmlns:i="http://schemas.microsoft.com/expression/2010/interactivity"
      xmlns:h="http://helix-toolkit.org/wpf"
      xmlns:hx="http://helix-toolkit.org/wpf/SharpDX"
      xmlns:pt="http://propertytools.org/wpf"
      mc:Ignorable="d"       
      d:DesignHeight="800" d:DesignWidth="1500"
      Background="#cfcfcf">

    <Page.Title>
        <MultiBinding Converter="{StaticResource StringFormatMultiConvert}" ConverterParameter="Интерфейс генерации программ - v.{0}">
            <Binding Path="Version" Mode="OneWay"/>
        </MultiBinding>
    </Page.Title>

    <Page.DataContext>
        <vm:MainPageViewModel3/>
    </Page.DataContext>

    <Page.Resources>
        <Style x:Key="TextBase" TargetType="{x:Type FrameworkElement}">
            <Setter Property="TextElement.FontFamily" Value="DefaultFont"/>
            <Setter Property="TextElement.Foreground" Value="{StaticResource ThemeFgP2Brush}"/>
        </Style>

        <Style x:Key="MenuItemTemplate" TargetType="{x:Type MenuItem}" BasedOn="{StaticResource TextBase}">
            <Setter Property="FontSize" Value="{StaticResource FontSizeN}"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
            <Setter Property="HorizontalContentAlignment" Value="Center"/>
            <Setter Property="Padding" Value="10, 3"/>
        </Style>

        <Style TargetType="{x:Type TabControl}">
            <Setter Property="Background" Value="{StaticResource {x:Static SystemColors.InfoBrushKey}}"/>
            <Setter Property="BorderBrush" Value="#4a4a4a"/>
            <Setter Property="BorderThickness" Value="3"/>
        </Style>

        <Style TargetType="{x:Type TabItem}">
            <Setter Property="FontSize" Value="15"/>
            <Setter Property="Foreground" Value="Black"/>
            <!--<Setter Property="MinWidth" Value="90"/>-->

            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="{x:Type TabItem}">
                        <Border Name="Panel">
                            <ContentPresenter x:Name="ContentSite" VerticalAlignment="Center" HorizontalAlignment="Center"
                                              ContentSource="Header" Margin="15, 5"/>
                        </Border>

                        <ControlTemplate.Triggers>
                            <Trigger Property="IsSelected" Value="True">
                                <!--<Setter TargetName="Panel" Property="Background" Value="#4a4a4a"/>-->
                                <Setter TargetName="Panel" Property="Background" Value="#4a4a4a"/>
                                <Setter TargetName="Panel" Property="BorderBrush" Value="{StaticResource {x:Static SystemColors.GrayTextBrushKey}}"/>
                                <!--<Setter TargetName="Panel" Property="BorderThickness"  Value="1.5"/>-->
                                <Setter TargetName="Panel" Property="Margin"  Value="0,-2,0,0"/>
                                <Setter TargetName="ContentSite" Property="TextElement.Foreground" Value="#3094ff"/>
                            </Trigger>

                            <Trigger Property="IsSelected" Value="False">
                                <Setter TargetName="Panel" Property="Background" Value="#b0b0b0"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="cbBase" TargetType="{x:Type ComboBox}">
            <Setter Property="FontSize" Value="{StaticResource FontSizeNP2}"/>
            <Setter Property="ItemContainerStyle">
                <Setter.Value>
                    <Style TargetType="{x:Type ComboBoxItem}">
                        <Setter Property="Height" Value="45"/>
                        <Setter Property="TextBlock.TextAlignment" Value="Center"/>
                        <Setter Property="TextBlock.VerticalAlignment" Value="Center"/>
                    </Style>
                </Setter.Value>
            </Setter>
        </Style>

        <Style TargetType="{x:Type ComboBox}" BasedOn="{StaticResource cbBase}"></Style>

        <!--<Style TargetType="{x:Type ComboBoxItem}">
            <Setter Property="Height" Value="45"/>
            <Setter Property="TextBlock.TextAlignment" Value="Center"/>
            <Setter Property="TextBlock.VerticalAlignment" Value="Center"/>
        </Style>-->

        <!--<Style TargetType="{x:Type Canvas}">
            <Setter Property="Background" Value="Red"/>
            <Setter Property="Block.BorderThickness" Value="10"/>
        </Style>-->

        <ControlTemplate x:Key="RadioButtonInToggleTemplate" TargetType="{x:Type RadioButton}">
            <ToggleButton IsChecked="{Binding IsChecked, RelativeSource={RelativeSource TemplatedParent}, Mode=TwoWay}"
                          Content="{Binding Content, RelativeSource={RelativeSource TemplatedParent}, Mode=TwoWay}"/>
        </ControlTemplate>

        <ControlTemplate x:Key="MenuItemTemplate1" TargetType="{x:Type MenuItem}">
            <Button Content="{Binding Icon, RelativeSource={RelativeSource TemplatedParent}}"
                    ToolTip="{Binding Header, RelativeSource={RelativeSource TemplatedParent}}"
                    Command="{Binding Command, RelativeSource={RelativeSource TemplatedParent}}"
                    CommandParameter="{Binding CommandParameter, RelativeSource={RelativeSource TemplatedParent}}"
                    CommandTarget="{Binding CommandTarget, RelativeSource={RelativeSource TemplatedParent}}"
                    Width="Auto" Margin="3,2" Padding="5"/>
        </ControlTemplate>

        <ControlTemplate x:Key="MenuItemTemplate2" TargetType="{x:Type MenuItem}">
            <Border Name="Panel" BorderThickness="0" CornerRadius="5">
                <StackPanel Orientation="Horizontal" Margin="5">
                    <ContentPresenter x:Name="Icon" ContentSource="Icon" Height="30" Margin="5,0"/>
                    <ContentPresenter ContentSource="Header" RecognizesAccessKey="True"
                                      TextElement.FontSize="{StaticResource FontSizeNP3}"
                                      TextElement.Foreground="{StaticResource ThemeFgP2Brush}"
                                      VerticalAlignment="Center" Margin="5,0"
                                      Style="{StaticResource TextBase}"/>
                </StackPanel>
            </Border>

            <ControlTemplate.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter TargetName="Panel" Property="Background" Value="{StaticResource ThemeIsMouseOverMenuItemBgBrush}"/>
                </Trigger>

                <Trigger Property="IsPressed" Value="True">
                    <Setter TargetName="Panel" Property="Background" Value="{StaticResource ThemeIsPressedMenuItemBgBrush}"/>
                </Trigger>
            </ControlTemplate.Triggers>
        </ControlTemplate>

        <ControlTemplate x:Key="MenuToggleButtonTemplate" TargetType="{x:Type ToggleButton}">
            <Border Name="Panel" BorderBrush="{StaticResource ThemeNotActiveToggleButBordBrush}" BorderThickness="0,7,0,0" Margin="5,0">
                <ContentPresenter x:Name="Content" ContentSource="Content" Margin="15,5"/>
            </Border>

            <ControlTemplate.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter TargetName="Panel" Property="Background" Value="{StaticResource ThemeIsMouseOverMenuItemBgBrush}"/>
                    <Setter TargetName="Panel" Property="BorderBrush" Value="{StaticResource ThemeIsMouseOverToggleButBordBrush}"/>
                </Trigger>
                
                <Trigger Property="IsChecked" Value="True">
                    <Setter TargetName="Panel" Property="Background" Value="{StaticResource ThemeIsMouseOverMenuItemBgBrush}"/>
                    <Setter TargetName="Panel" Property="BorderBrush" Value="{StaticResource ThemeIsMouseOverToggleButBordBrush}"/>
                </Trigger>

                <Trigger Property="IsPressed" Value="True">
                    <Setter TargetName="Panel" Property="Background" Value="{StaticResource ThemeIsPressedToggleButBgBrush}"/>
                    <Setter TargetName="Panel" Property="BorderBrush" Value="{StaticResource ThemeIsPressedToggleButBordBrush}"/>
                </Trigger>
            </ControlTemplate.Triggers>
        </ControlTemplate>

        <DataTemplate x:Key="RobotControlTemplate" DataType="{x:Type ContentControl}">
            <Grid Margin="10"
                  DataContext="{Binding Path=DataContext, RelativeSource={RelativeSource AncestorType={x:Type Page}, Mode=FindAncestor}}">
                
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="10"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <Grid.Resources>
                    <Style TargetType="{x:Type ComboBox}" BasedOn="{StaticResource cbBase}"></Style>

                    <Style TargetType="{x:Type Button}">
                        <Setter Property="Height" Value="35"/>
                        <Setter Property="Width" Value="{Binding Path=ActualHeight, RelativeSource={RelativeSource Self}}"/>
                    </Style>

                    <Style TargetType="{x:Type Grid}">
                        <Setter Property="Margin" Value="0,0,0,10"/>
                    </Style>

                    <Style TargetType="{x:Type Path}">
                        <Setter Property="Stretch" Value="Uniform"/>
                    </Style>

                    <Style TargetType="{x:Type TextBox}" BasedOn="{StaticResource TextBase}">
                        <Setter Property="TextElement.FontSize" Value="{StaticResource FontSizeNP2}"/>
                        <Setter Property="MinHeight" Value="35"/>
                        <Setter Property="Padding" Value="5"/>
                        <Setter Property="HorizontalContentAlignment" Value="Center"/>
                        <Setter Property="VerticalContentAlignment" Value="Center"/>
                    </Style>
                </Grid.Resources>

                <Grid Grid.Row="0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <Button Grid.Column="0" ToolTip="Удалить робота"
                                Command="{Binding Path=DeleteRobotCommand}"
                                CommandParameter="{Binding Path=SelectedRobot}">

                        <Path Fill="{StaticResource IconDeleteBrush}"
                                  Data="{StaticResource DeletePathGeomerty}"/>
                    </Button>

                    <ComboBox FontWeight="Bold" Grid.Column="1" Margin="5,0"
                                  HorizontalContentAlignment="Center" VerticalContentAlignment="Center"
                                  ItemsSource="{Binding Path=RobotsCollection, Mode=OneWay}"
                                  SelectedItem="{Binding Path=SelectedRobot, Mode=TwoWay}"      
                                  SelectedIndex="0">

                        <ComboBox.ItemTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding Path=Name, Mode=OneWay}"/>
                            </DataTemplate>
                        </ComboBox.ItemTemplate>
                    </ComboBox>

                    <Button Grid.Column="2" ToolTip="Повторное соединение"
                                Command="{Binding Path=ConnectedRobotCommand}"
                                CommandParameter="{Binding Path=SelectedRobot}">

                        <Button.Style>
                            <Style TargetType="{x:Type Button}" BasedOn="{StaticResource buttonBaseStyle}">
                                <Setter Property="Height" Value="0"/>
                                <Setter Property="Width" Value="{Binding Path=ActualHeight, RelativeSource={RelativeSource Self}}"/>

                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding Path=SelectedRobot.IsConnection}" Value="False">
                                        <Setter Property="Height" Value="35"/>
                                        <Setter Property="Margin" Value="0,0,5,0"/>
                                    </DataTrigger>

                                    <DataTrigger Binding="{Binding Path=Visibility, RelativeSource={RelativeSource Self}}" Value="Visible">
                                        <DataTrigger.EnterActions>
                                            <BeginStoryboard Name="StartBlinking">
                                                <Storyboard>
                                                    <DoubleAnimation Storyboard.TargetProperty="Opacity" From="0" To="1" RepeatBehavior="Forever" AutoReverse="True" Duration="0:0:1"/>
                                                </Storyboard>
                                            </BeginStoryboard>
                                        </DataTrigger.EnterActions>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </Button.Style>

                        <Path Fill="{StaticResource IconUpDateBrush}"
                                  Data="{StaticResource UpDatePathGeomerty}"/>
                    </Button>

                    <Button Grid.Column="3" ToolTip="Закрыть соединение"
                                Command="{Binding Path=DisconnectedRobotCommand}"
                                CommandParameter="{Binding Path=SelectedRobot}">

                        <Button.Style>
                            <Style TargetType="{x:Type Button}" BasedOn="{StaticResource buttonBaseStyle}">
                                <Setter Property="Height" Value="0"/>
                                <Setter Property="Width" Value="{Binding Path=ActualHeight, RelativeSource={RelativeSource Self}}"/>

                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding Path=SelectedRobot.IsConnection}" Value="True">
                                        <Setter Property="Height" Value="35"/>
                                        <Setter Property="Margin" Value="0,0,5,0"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </Button.Style>

                        <Path Stroke="{StaticResource IconAddBrush}" StrokeThickness="2.5">
                            <Path.Data>
                                <GeometryGroup>
                                    <StaticResource ResourceKey="DisconnectPathGeomerty1"/>
                                    <StaticResource ResourceKey="DisconnectPathGeomerty2"/>
                                    <StaticResource ResourceKey="DisconnectPathGeomerty3"/>
                                    <StaticResource ResourceKey="DisconnectPathGeomerty4"/>
                                    <StaticResource ResourceKey="DisconnectPathGeomerty5"/>
                                    <StaticResource ResourceKey="DisconnectPathGeomerty6"/>
                                </GeometryGroup>
                            </Path.Data>
                        </Path>
                    </Button>

                    <Button Grid.Column="4" ToolTip="Добавить робота"
                                Command="{Binding Path=AddRobotCommand}">

                        <Path Stroke="{StaticResource IconAddBrush}" StrokeThickness="2">
                            <Path.Data>
                                <GeometryGroup>
                                    <StaticResource ResourceKey="AddRobotPathGeomerty1"/>
                                    <StaticResource ResourceKey="AddRobotPathGeomerty2"/>
                                </GeometryGroup>
                            </Path.Data>
                        </Path>
                    </Button>
                </Grid>

                <Grid Grid.Row="1">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="1.75*"/>
                        <ColumnDefinition Width="5"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <TextBox Grid.Column="0" Text="{Binding Path=SelectedRobot.Host, Mode=TwoWay, FallbackValue='0.0.0.0', TargetNullValue='0.0.0.0', UpdateSourceTrigger=LostFocus}"/>
                    <TextBox Grid.Column="2" Text="{Binding Path=SelectedRobot.Port, Mode=TwoWay, FallbackValue=0000, TargetNullValue=0000, UpdateSourceTrigger=LostFocus}"/>
                </Grid>

                <Grid Grid.Row="2">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="5"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <TextBox Grid.Column="0" Text="{Binding Path=SelectedRobot.PathProgramm, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>

                    <Button Grid.Column="2"
                                ToolTip="Изменить папку генерации"
                                Command="{Binding Path=DataContext.ChangePatnOnPCCommand, RelativeSource={RelativeSource AncestorType={x:Type Page}, Mode=FindAncestor}}">

                        <Path Fill="{StaticResource IconEditBrush}"
                                  Data="{StaticResource EditPathGeomerty}">
                            <Path.LayoutTransform>
                                <RotateTransform Angle="90"/>
                            </Path.LayoutTransform>
                        </Path>
                    </Button>
                </Grid>

                <control:Breadcrumb Grid.Row="3" FontSize="{StaticResource FontSizeNP2}"
                                    Root="{x:Static client:JsonRpcConnection.DefaulRoot}"
                                    Directory="{Binding Path=SelectedRobot.PathControllerFolder, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                    ItemsSource="{Binding Path=SelectedRobot.Files, Mode=OneWay}"
                                    UpDateCommand="{Binding Path=UpDateFilesCommand, Mode=OneWay}"
                                    IsProgress="{Binding Path=SelectedRobot.IsLoadFiles, Mode=OneWay}"
                                    IsEnabled="{Binding Path=SelectedRobot.IsConnection, Mode=OneWay}"
                                    SelectFilesCommand="{Binding Path=DropFilesCommandAsync}"
                                    DeleteFilesCommand="{Binding Path=DeleteFileCommandAsync}"/>

                <control:NavigationTreeView Grid.Row="5" FontSize="{StaticResource FontSizeNP2}" Margin="0"
                                                IsEnabled="{Binding Path=SelectedRobot.IsConnection, Mode=OneWay}"
                                                DataFileIsHidden="{Binding Path=Settings.AccessDataFile, Source={x:Static Application.Current}, Mode=TwoWay}"
                                                SelectedFile="{Binding Path=SelectedRobot.RobotProgramName, Mode=TwoWay}"
                                                SelectItemCommand="{Binding Path=SelectFileCommandAsync}"
                                                SelectFolderCommand="{Binding Path=SelectFolderCommand}"
                                                DeleteNodeCommand="{Binding Path=DeleteFileCommandAsync}"
                                                Height="{Binding Path=ActualHeight, RelativeSource={RelativeSource AncestorType={x:Type RowDefinition}, Mode=FindAncestor}}"
                                                ScrollViewer.CanContentScroll="False"
                                                ScrollViewer.VerticalScrollBarVisibility="Disabled">

                    <control:NavigationTreeView.FileCollection>
                        <MultiBinding Converter="{StaticResource VisibilityFolderOnRobot}">
                            <Binding Path="DataContext.SelectedRobot.Files" RelativeSource="{RelativeSource AncestorType={x:Type Page}, Mode=FindAncestor}"/>
                            <Binding Path="Settings.AvailableFolders" Source="{x:Static Application.Current}"/>
                        </MultiBinding>
                    </control:NavigationTreeView.FileCollection>

                    <control:NavigationTreeView.Style>
                        <Style TargetType="{x:Type control:NavigationTreeView}">
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding Path=SelectedRobot.IsLoadFiles, Mode=OneWay}" Value="True">
                                    <Setter Property="IsEnabled" Value="False"/>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </control:NavigationTreeView.Style>
                </control:NavigationTreeView>
            </Grid>
        </DataTemplate>

        <DataTemplate x:Key="UprControlTemplate" DataType="{x:Type ContentControl}">
            <Grid DataContext="{Binding Path=DataContext, RelativeSource={RelativeSource AncestorType={x:Type Page}, Mode=FindAncestor}}">
                <ListView SelectionMode="Single" Margin="0"
                          FontSize="{StaticResource FontSizeNP4}" FontFamily="{StaticResource DefaultFont}" Foreground="{StaticResource ThemeFgP2Brush}"
                          ScrollViewer.CanContentScroll="True"
                          ScrollViewer.VerticalScrollBarVisibility="Auto"
                          ScrollViewer.HorizontalScrollBarVisibility="Auto"
                          ItemsSource="{Binding Path=RobotsCollection, Mode=OneWay}">

                    <ListView.Resources>
                        <Style x:Key="LvTextBase" TargetType="{x:Type FrameworkElement}" BasedOn="{StaticResource TextBase}">
                            <Setter Property="TextElement.FontSize" Value="{StaticResource FontSizeNP4}"/>
                            <Setter Property="TextElement.Foreground" Value="{StaticResource ThemeFgP2Brush}"/>
                        </Style>

                        <Style x:Key="UprControlButtonBase" TargetType="{x:Type Button}">
                            <Setter Property="Height" Value="40"/>
                            <Setter Property="Margin" Value="5"/>
                        </Style>

                        <Style TargetType="{x:Type Button}" BasedOn="{StaticResource UprControlButtonBase}"></Style>

                        <DataTemplate x:Key="PanelLvDelete">
                            <Button ToolTip="Удалить робота"
                                    Width="{Binding Path=ActualHeight, RelativeSource={RelativeSource Self}}"
                                    Command="{Binding Path=DataContext.DeleteRobotCommand, RelativeSource={RelativeSource AncestorType={x:Type Page}, Mode=FindAncestor}}"
                                    CommandParameter="{Binding}">

                                <Path Fill="{StaticResource IconDeleteBrush}" Stretch="Uniform"
                                      Data="{StaticResource DeletePathGeomerty}"/>
                            </Button>
                        </DataTemplate>

                        <DataTemplate x:Key="PanelLvRobot">
                            <DataTemplate.Resources>
                                <Style TargetType="{x:Type Button}" BasedOn="{StaticResource UprControlButtonBase}">
                                    <Setter Property="Width" Value="{Binding Path=ActualHeight, RelativeSource={RelativeSource Self}}"/>
                                </Style>

                                <Style TargetType="{x:Type Path}">
                                    <Setter Property="Stretch" Value="Uniform"/>
                                </Style>
                            </DataTemplate.Resources>

                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="5"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <TextBlock Grid.Column="0" Text="{Binding Path=Name}" TextWrapping="Wrap"
                                           TextAlignment="Center" VerticalAlignment="Center">

                                    <TextBlock.ToolTip>
                                        <MultiBinding Converter="{StaticResource StringFormatMultiConvert}" ConverterParameter="{}{0} : {1}">
                                            <Binding Path="Host"/>
                                            <Binding Path="Port"/>
                                        </MultiBinding>
                                    </TextBlock.ToolTip>
                                </TextBlock>

                                <Button Grid.Column="2" ToolTip="Переименовать робота"
                                        Command="{Binding Path=DataContext.RenameRobotCommand, RelativeSource={RelativeSource AncestorType={x:Type Page}, Mode=FindAncestor}}"
                                        CommandParameter="{Binding}">

                                    <Path Fill="{StaticResource IconEditBrush}"
                                          Data="{StaticResource EditPathGeomerty}">

                                        <Path.LayoutTransform>
                                            <RotateTransform Angle="90"/>
                                        </Path.LayoutTransform>
                                    </Path>
                                </Button>

                                <Button Grid.Column="3" ToolTip="Повторное соединение"
                                        Command="{Binding Path=DataContext.ConnectedRobotCommand, RelativeSource={RelativeSource AncestorType={x:Type Page}, Mode=FindAncestor}}"
                                        CommandParameter="{Binding}">

                                    <Button.Style>
                                        <Style TargetType="{x:Type Button}" BasedOn="{StaticResource UprControlButtonBase}">
                                            <Setter Property="Width" Value="{Binding Path=ActualHeight, RelativeSource={RelativeSource Self}}"/>

                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding Path=IsConnection}" Value="True">
                                                    <Setter Property="Height" Value="0"/>
                                                    <Setter Property="Margin" Value="0"/>
                                                </DataTrigger>

                                                <DataTrigger Binding="{Binding Path=Visibility, RelativeSource={RelativeSource Self}}" Value="Visible">
                                                    <DataTrigger.EnterActions>
                                                        <BeginStoryboard Name="StartBlinking">
                                                            <Storyboard>
                                                                <DoubleAnimation Storyboard.TargetProperty="Opacity" From="0" To="1" RepeatBehavior="Forever" AutoReverse="True" Duration="0:0:1"/>
                                                            </Storyboard>
                                                        </BeginStoryboard>
                                                    </DataTrigger.EnterActions>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Button.Style>

                                    <Path Fill="{StaticResource IconUpDateBrush}"
                                          Data="{StaticResource UpDatePathGeomerty}"/>
                                </Button>

                                <Button Grid.Column="4" ToolTip="Закрыть соединение"
                                        Command="{Binding Path=DataContext.DisconnectedRobotCommand, RelativeSource={RelativeSource AncestorType={x:Type Page}, Mode=FindAncestor}}"
                                        CommandParameter="{Binding}">

                                    <Button.Style>
                                        <Style TargetType="{x:Type Button}" BasedOn="{StaticResource UprControlButtonBase}">
                                            <Setter Property="Width" Value="{Binding Path=ActualHeight, RelativeSource={RelativeSource Self}}"/>

                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding Path=IsConnection}" Value="False">
                                                    <Setter Property="Height" Value="0"/>
                                                    <Setter Property="Margin" Value="0"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Button.Style>

                                    <Path Stroke="{StaticResource IconAddBrush}" StrokeThickness="2.5">
                                        <Path.Data>
                                            <GeometryGroup>
                                                <StaticResource ResourceKey="DisconnectPathGeomerty1"/>
                                                <StaticResource ResourceKey="DisconnectPathGeomerty2"/>
                                                <StaticResource ResourceKey="DisconnectPathGeomerty3"/>
                                                <StaticResource ResourceKey="DisconnectPathGeomerty4"/>
                                                <StaticResource ResourceKey="DisconnectPathGeomerty5"/>
                                                <StaticResource ResourceKey="DisconnectPathGeomerty6"/>
                                            </GeometryGroup>
                                        </Path.Data>
                                    </Path>
                                </Button>
                            </Grid>
                        </DataTemplate>

                        <DataTemplate x:Key="PanelLvControl">
                            <Menu Background="Transparent">
                                <Menu.Resources>
                                    <Style TargetType="{x:Type MenuItem}" BasedOn="{StaticResource LvTextBase}">
                                        <Setter Property="HorizontalAlignment" Value="Left"/>
                                        <Setter Property="Margin" Value="5"/>
                                    </Style>

                                    <Style TargetType="{x:Type Path}">
                                        <Setter Property="Stretch" Value="Fill"/>
                                        <Setter Property="StrokeThickness" Value="0"/>
                                        <Setter Property="Height" Value="30"/>
                                        <Setter Property="Width" Value="30"/>
                                    </Style>

                                    <ControlTemplate x:Key="SeparatorTemplate" TargetType="{x:Type MenuItem}">
                                        <Separator Height="0" Margin="0,2"/>
                                    </ControlTemplate>

                                    <ControlTemplate x:Key="MenuItemTemplate" TargetType="{x:Type MenuItem}">
                                        <Border Name="Panel" BorderThickness="0" Background="{StaticResource ThemeBgM1Brush}" CornerRadius="4">
                                            <StackPanel Orientation="Horizontal" Margin="5">
                                                <ContentPresenter x:Name="Icon" ContentSource="Icon"/>
                                                <ContentPresenter ContentSource="Header" RecognizesAccessKey="True"
                                                      VerticalAlignment="Center" Margin="10,0"
                                                      Style="{StaticResource TextBase}"/>
                                            </StackPanel>
                                        </Border>

                                        <ControlTemplate.Triggers>
                                            <Trigger Property="IsMouseOver" Value="True">
                                                <Setter TargetName="Panel" Property="Background" Value="{StaticResource ThemeIsMouseOverMenuItemBgBrush}"/>
                                            </Trigger>

                                            <Trigger Property="IsPressed" Value="True">
                                                <Setter TargetName="Panel" Property="Background" Value="{StaticResource ThemeIsPressedMenuItemBgBrush}"/>
                                            </Trigger>
                                        </ControlTemplate.Triggers>
                                    </ControlTemplate>
                                </Menu.Resources>

                                <Menu.ItemsPanel>
                                    <ItemsPanelTemplate>
                                        <WrapPanel Orientation="Horizontal" Margin="0, 5"/>
                                    </ItemsPanelTemplate>
                                </Menu.ItemsPanel>

                                <MenuItem Template="{StaticResource MenuItemTemplate}" Header="Пуск">
                                    <MenuItem.Icon>
                                        <Path Stretch="Fill" Fill="{StaticResource IconRunProgramBrush}" StrokeThickness="0" Height="30" Width="30">
                                            <Path.Data>
                                                <GeometryGroup>
                                                    <StaticResource ResourceKey="RunProgramPathGeomerty1"/>
                                                    <StaticResource ResourceKey="RunProgramPathGeomerty2"/>
                                                </GeometryGroup>
                                            </Path.Data>
                                        </Path>
                                    </MenuItem.Icon>

                                    <i:Interaction.Triggers>
                                        <i:EventTrigger EventName="PreviewMouseDown">
                                            <i:InvokeCommandAction Command="{Binding Path=DataContext.RunProgramCommandAsync, RelativeSource={RelativeSource AncestorType={x:Type Page}, Mode=FindAncestor}}"
                                                                   CommandParameter="{Binding}"/>
                                        </i:EventTrigger>

                                        <i:EventTrigger EventName="PreviewMouseUp">
                                            <i:InvokeCommandAction Command="{Binding Path=DataContext.RetentionRunButtonCommandAsync, RelativeSource={RelativeSource AncestorType={x:Type Page}, Mode=FindAncestor}}"
                                                                   CommandParameter="{Binding}"/>
                                        </i:EventTrigger>
                                    </i:Interaction.Triggers>
                                </MenuItem>

                                <MenuItem Template="{StaticResource MenuItemTemplate}" Header="Остановить" ToolTip="Аннулировать программу"
                                          Command="{Binding Path=DataContext.PauseProgramCommandAsync, RelativeSource={RelativeSource AncestorType={x:Type Page}, Mode=FindAncestor}}"
                                          CommandParameter="{Binding}">
                                    <MenuItem.Icon>
                                        <Path Stretch="Fill" Fill="{StaticResource IconStopProgramBrush}" Height="30" Width="30">
                                            <Path.Data>
                                                <GeometryGroup>
                                                    <StaticResource ResourceKey="StopProgramPathGeomerty1"/>
                                                    <StaticResource ResourceKey="StopProgramPathGeomerty2"/>
                                                </GeometryGroup>
                                            </Path.Data>
                                        </Path>
                                    </MenuItem.Icon>
                                </MenuItem>

                                <MenuItem Template="{StaticResource MenuItemTemplate}" Header="Анулировать" ToolTip="Аннулировать программу"
                                          Command="{Binding Path=DataContext.CancelProgramCommandAsync, RelativeSource={RelativeSource AncestorType={x:Type Page}, Mode=FindAncestor}}"
                                          CommandParameter="{Binding}">
                                    <MenuItem.Icon>
                                        <Path Fill="{StaticResource IconCancelProgramBrush}" StrokeThickness="0">
                                            <Path.Data>
                                                <GeometryGroup>
                                                    <StaticResource ResourceKey="CancelProgramPathGeomerty1"/>
                                                    <StaticResource ResourceKey="CancelProgramPathGeomerty2"/>
                                                </GeometryGroup>
                                            </Path.Data>
                                        </Path>
                                    </MenuItem.Icon>
                                </MenuItem>
                            </Menu>
                        </DataTemplate>

                        <DataTemplate x:Key="PanelLvStatus">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="20"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>

                                <Ellipse Grid.Column="0"
                                         Height="{Binding Path=ActualWidth, RelativeSource={RelativeSource Self}}"
                                         Width="{Binding Path=ActualWidth, RelativeSource={RelativeSource AncestorType={x:Type ColumnDefinition}, Mode=FindAncestor}}">

                                    <Ellipse.Style>
                                        <Style TargetType="{x:Type Ellipse}">
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding Path=Pro_State}" Value="#P_ACTIVE">
                                                    <DataTrigger.EnterActions>
                                                        <BeginStoryboard x:Name="blinkAnimation">
                                                            <Storyboard>
                                                                <DoubleAnimation Storyboard.TargetProperty="Opacity" From="0" To="1" RepeatBehavior="Forever" AutoReverse="True" Duration="0:0:1.25"/>
                                                            </Storyboard>
                                                        </BeginStoryboard>
                                                    </DataTrigger.EnterActions>

                                                    <DataTrigger.ExitActions>
                                                        <StopStoryboard BeginStoryboardName="blinkAnimation"/>
                                                    </DataTrigger.ExitActions>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Ellipse.Style>

                                    <Ellipse.Fill>
                                        <RadialGradientBrush>
                                            <GradientStop Color="White" Offset="0"/>
                                            <GradientStop Color="{Binding Path=Foreground.Color, ElementName=statusString}" Offset="1"/>
                                        </RadialGradientBrush>
                                    </Ellipse.Fill>
                                </Ellipse>

                                <TextBlock Grid.Column="1" x:Name="statusString" FontWeight="Bold" FontSize="{StaticResource FontSizeNP4}" 
                                           HorizontalAlignment="Left" TextAlignment="Left" Margin="5,0"
                                           Foreground="{Binding Path=Text, RelativeSource={RelativeSource Self}, Converter={StaticResource StatusColorConvert}}">

                                    <TextBlock.Style>
                                        <Style TargetType="{x:Type TextBlock}" BasedOn="{StaticResource LvTextBase}">
                                            <Setter Property="Text" Value="Нет соединения"/>
                                            <Setter Property="TextWrapping" Value="Wrap"/>

                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding Path=Pro_State}" Value="#P_FREE">
                                                    <Setter Property="Text" Value="Программа не выбрана"/>
                                                </DataTrigger>

                                                <DataTrigger Binding="{Binding Path=Pro_State}" Value="#P_RESET">
                                                    <Setter Property="Text">
                                                        <Setter.Value>
                                                            <MultiBinding Converter="{StaticResource StringFormatMultiConvert}" ConverterParameter="Выбрана программа {0}">
                                                                <Binding Path="RobotProgramName" Mode="OneWay"/>
                                                            </MultiBinding>
                                                        </Setter.Value>
                                                    </Setter>
                                                </DataTrigger>

                                                <DataTrigger Binding="{Binding Path=Pro_State}" Value="#P_ACTIVE">
                                                    <Setter Property="Text">
                                                        <Setter.Value>
                                                            <MultiBinding Converter="{StaticResource StringFormatMultiConvert}" ConverterParameter="Запущена программа {0}">
                                                                <Binding Path="RobotProgramName" Mode="OneWay"/>
                                                            </MultiBinding>
                                                        </Setter.Value>
                                                    </Setter>
                                                </DataTrigger>

                                                <DataTrigger Binding="{Binding Path=Pro_State}" Value="#P_STOP">
                                                    <Setter Property="Text">
                                                        <Setter.Value>
                                                            <MultiBinding Converter="{StaticResource StringFormatMultiConvert}" ConverterParameter="Программа {0} остановлена">
                                                                <Binding Path="RobotProgramName" Mode="OneWay"/>
                                                            </MultiBinding>
                                                        </Setter.Value>
                                                    </Setter>
                                                </DataTrigger>

                                                <DataTrigger Binding="{Binding Path=Pro_State}" Value="#P_END">
                                                    <Setter Property="Text">
                                                        <Setter.Value>
                                                            <MultiBinding Converter="{StaticResource StringFormatMultiConvert}" ConverterParameter="Программа {0} завершена">
                                                                <Binding Path="RobotProgramName" Mode="OneWay"/>
                                                            </MultiBinding>
                                                        </Setter.Value>
                                                    </Setter>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </TextBlock.Style>
                                </TextBlock>
                            </Grid>
                        </DataTemplate>
                    </ListView.Resources>

                    <ListView.ItemContainerStyle>
                        <Style TargetType="{x:Type ListViewItem}">
                            <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
                        </Style>
                    </ListView.ItemContainerStyle>

                    <ListView.View>
                        <GridView>
                            <GridViewColumn CellTemplate="{StaticResource PanelLvDelete}" Width="Auto"></GridViewColumn>
                            <GridViewColumn CellTemplate="{StaticResource PanelLvRobot}" Width="Auto"></GridViewColumn>
                            <GridViewColumn CellTemplate="{StaticResource PanelLvControl}" Width="Auto"></GridViewColumn>
                            <GridViewColumn CellTemplate="{StaticResource PanelLvStatus}">Статус</GridViewColumn>
                        </GridView>
                    </ListView.View>

                    <i:Interaction.Triggers>
                        <i:EventTrigger EventName="MouseDoubleClick">
                            <i:InvokeCommandAction Command="{Binding Path=SelectRobotCommand}"
                                                   CommandParameter="{Binding Path=., RelativeSource={RelativeSource AncestorType={x:Type ListView}, Mode=FindAncestor}}"/>
                        </i:EventTrigger>
                    </i:Interaction.Triggers>
                </ListView>
            </Grid>
        </DataTemplate>
    </Page.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="25"/>
        </Grid.RowDefinitions>

        <Menu Grid.Row="0" Grid.Column="0" Grid.ColumnSpan="2">
            <MenuItem Header="_Файл" Style="{StaticResource MenuItemTemplate}">
                <MenuItem Header="_Создать" Style="{StaticResource MenuItemTemplate}"/>
                <MenuItem Header="_Открыть" Style="{StaticResource MenuItemTemplate}"/>
                <MenuItem Header="_Сохранить" Style="{StaticResource MenuItemTemplate}"/>
                <MenuItem Header="_Сохранить как" Style="{StaticResource MenuItemTemplate}"/>
                <Separator/>
                <MenuItem Header="_Экспорт" Style="{StaticResource MenuItemTemplate}"/>
                <Separator/>
                <MenuItem Header="_Импорт параметров" Style="{StaticResource MenuItemTemplate}"/>
                <MenuItem Header="_Экспорт параметров" Style="{StaticResource MenuItemTemplate}"/>
                <Separator/>
                <MenuItem Header="_Выход" Style="{StaticResource MenuItemTemplate}"/>
            </MenuItem>

            <MenuItem Header="_Правка" Style="{StaticResource MenuItemTemplate}">
                <MenuItem Header="_Отменить"  Style="{StaticResource MenuItemTemplate}"/>
                <MenuItem Header="_Вернуть"  Style="{StaticResource MenuItemTemplate}"/>
                <MenuItem Header="_Обновить"  Style="{StaticResource MenuItemTemplate}"/>
                <MenuItem Header="_Выделить всё" Style="{StaticResource MenuItemTemplate}"/>
                <MenuItem Header="_Выделить область" Style="{StaticResource MenuItemTemplate}"/>
                <MenuItem Header="_Дублировать выбранное" Style="{StaticResource MenuItemTemplate}"/>
                <MenuItem Header="_Удалить" Style="{StaticResource MenuItemTemplate}"/>
            </MenuItem>

            <MenuItem Header="_Генерация" Style="{StaticResource MenuItemTemplate}">
                <MenuItem Header="_Начать генерацию" Style="{StaticResource MenuItemTemplate}"/>
                <Separator />
                <MenuItem Header="_Настройки" Style="{StaticResource MenuItemTemplate}"/>
            </MenuItem>

            <MenuItem Header="_Окно" Style="{StaticResource MenuItemTemplate}">
                <!--<MenuItem Header="_Расположение" Style="{StaticResource MenuItemTemplate}"/>-->
                <MenuItem Header="_Система координат" IsCheckable="True"
                          IsChecked="{Binding Path=Settings.ShowCoordinateSystem, Source={x:Static Application.Current}, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                          Style="{StaticResource MenuItemTemplate}"/>

                <MenuItem Header="_Пространственный куб" IsCheckable="True"
                          IsChecked="{Binding Path=Settings.ShowViewCube, Source={x:Static Application.Current}, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                          Style="{StaticResource MenuItemTemplate}"/>

                <MenuItem Header="_Кол-во полигонов" IsCheckable="True"
                          IsChecked="{Binding Path=Settings.ShowTriangleCountInfo, Source={x:Static Application.Current}, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                          Style="{StaticResource MenuItemTemplate}"/>

                <Separator/>

                <MenuItem Header="_Ортоганальная камера" IsCheckable="True"
                          IsChecked="{Binding Path=Settings.Orthographic, Source={x:Static Application.Current}, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                          Style="{StaticResource MenuItemTemplate}"/>

                <MenuItem Header="_Демонстрация информации о камере" IsCheckable="True"
                          IsChecked="{Binding Path=Settings.ShowCameraInfo, Source={x:Static Application.Current}, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                          Style="{StaticResource MenuItemTemplate}"/>

                <MenuItem Header="_Демонстрация курсора камеры" IsCheckable="True"
                          IsChecked="{Binding Path=Settings.ShowCameraTarget, Source={x:Static Application.Current}, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                          Style="{StaticResource MenuItemTemplate}"/>

                <MenuItem Header="_Поворот вокруг мыши" IsCheckable="True"
                          IsChecked="{Binding Path=Settings.RotateAroundMouseDownPoint, Source={x:Static Application.Current}, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                          Style="{StaticResource MenuItemTemplate}"/>

                <MenuItem Header="_Приближение около мыши" IsCheckable="True"
                          IsChecked="{Binding Path=Settings.ZoomAroundMouseDownPoint, Source={x:Static Application.Current}, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                          Style="{StaticResource MenuItemTemplate}"/>

                <MenuItem Header="_Инерция" IsCheckable="True"
                          IsChecked="{Binding Path=Settings.IsInertiaEnabled, Source={x:Static Application.Current}, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                          Style="{StaticResource MenuItemTemplate}"/>

                <MenuItem Header="_Панорамирование" IsCheckable="True"
                          IsChecked="{Binding Path=Settings.IsPanEnabled, Source={x:Static Application.Current}, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                          Style="{StaticResource MenuItemTemplate}"/>

                <MenuItem Header="_Перемещение" IsCheckable="True"
                          IsChecked="{Binding Path=Settings.IsMoveEnabled, Source={x:Static Application.Current}, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                          Style="{StaticResource MenuItemTemplate}"/>

                <MenuItem Header="_Вращение" IsCheckable="True"
                          IsChecked="{Binding Path=Settings.IsRotationEnabled, Source={x:Static Application.Current}, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                          Style="{StaticResource MenuItemTemplate}"/>

                <MenuItem Header="_Маштабирование" IsCheckable="True"
                          IsChecked="{Binding Path=Settings.IsZoomEnabled, Source={x:Static Application.Current}, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                          Style="{StaticResource MenuItemTemplate}"/>
            </MenuItem>

            <MenuItem Header="_Настройки" Style="{StaticResource MenuItemTemplate}"
                      Command="{Binding Path=PropertiesCommand}"/>

            <MenuItem Header="_Справка" Style="{StaticResource MenuItemTemplate}"/>
        </Menu>

        <Menu Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="2">
            <Menu.Resources>
                <ControlTemplate x:Key="SeparatorTemplate" TargetType="{x:Type MenuItem}">
                    <Separator HorizontalAlignment="Right" Margin="10,2">
                        <Separator.LayoutTransform>
                            <RotateTransform Angle="90" />
                        </Separator.LayoutTransform>
                    </Separator>
                </ControlTemplate>

                <Style TargetType="{x:Type Path}">
                    <Setter Property="Stretch" Value="Uniform"/>
                </Style>
            </Menu.Resources>

            <Menu.ItemsPanel>
                <ItemsPanelTemplate>
                    <WrapPanel HorizontalAlignment="Left" Margin="10,0"/>
                </ItemsPanelTemplate>
            </Menu.ItemsPanel>

            <MenuItem Template="{StaticResource MenuItemTemplate1}" Header="Создать"
                      Command="{Binding Path=CreateNewFileCommand}">
                <MenuItem.Icon>
                    <Path Fill="{StaticResource IconNewFileBrush}" StrokeThickness="0"
                          Data="{StaticResource NewFilePathGeomerty}"/>
                </MenuItem.Icon>
            </MenuItem>

            <MenuItem Template="{StaticResource MenuItemTemplate1}" Header="Открыть">
                <MenuItem.Icon>
                    <Path Fill="{StaticResource IconOpenFileBrush}"
                          Data="{StaticResource OpenPathGeomerty}"/>
                </MenuItem.Icon>
            </MenuItem>

            <MenuItem Template="{StaticResource MenuItemTemplate1}" Header="Сохранить">
                <MenuItem.Icon>
                    <Path Fill="{StaticResource IconSaveBrush}"
                          Data="{StaticResource SavePathGeomerty}"/>
                </MenuItem.Icon>
            </MenuItem>

            <MenuItem Template="{StaticResource MenuItemTemplate1}" Header="Сохранить как">
                <MenuItem.Icon>
                    <Path Fill="{StaticResource IconSaveAsBrush}"
                          Data="{StaticResource SaveAsPathGeomerty}"/>
                </MenuItem.Icon>
            </MenuItem>

            <MenuItem Template="{StaticResource SeparatorTemplate}"/>

            <MenuItem Template="{StaticResource MenuItemTemplate1}" Header="Отменить">
                <MenuItem.Icon>
                    <Path Fill="{StaticResource IconBackBrush}"
                          Data="{StaticResource BackPathGeomerty}"/>
                </MenuItem.Icon>
            </MenuItem>

            <MenuItem Template="{StaticResource MenuItemTemplate1}" Header="Вернуть">
                <MenuItem.Icon>
                    <Path Fill="{StaticResource IconReternBrush}"
                          Data="{StaticResource ReternPathGeomerty}"/>
                </MenuItem.Icon>
            </MenuItem>

            <MenuItem Template="{StaticResource SeparatorTemplate}"/>

            <MenuItem>
                <MenuItem.Template>
                    <ControlTemplate TargetType="{x:Type MenuItem}">
                        <ComboBox VerticalContentAlignment="Center" HorizontalContentAlignment="Center"
                                  FontSize="{StaticResource FontSizeNP4}" Width="Auto" MinWidth="200" Margin="4"
                                  ItemsSource="{Binding Path=RobotNamesCollection, Mode=OneWay}"
                                  SelectedItem="{Binding Path=SelectedNameRobot, Mode=TwoWay}"
                                  SelectedIndex="0">

                            <ComboBox.Style>
                                <Style TargetType="{x:Type ComboBox}" BasedOn="{StaticResource cbBase}">
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding Path=RobotsCollection.Count}" Value="0">
                                            <Setter Property="IsEnabled" Value="False"/>
                                            <Setter Property="IsEditable" Value="True"/>
                                            <Setter Property="Text" Value="Нет введёных роботов"/>
                                        </DataTrigger>

                                        <DataTrigger Binding="{Binding Path=SelectedNameRobot}" Value="{x:Null}">
                                            <Setter Property="SelectedIndex" Value="0"/>
                                        </DataTrigger>

                                        <!--<DataTrigger Binding="{Binding Path=Settings.AvailableTab, Source={x:Static Application.Current}, 
                                            Converter={StaticResource CollectionsStringToBoolConvert}, ConverterParameter='Программа'}" Value="False">
                                            <Setter Property="Visibility" Value="Hidden"/>
                                            <Setter Property="Height" Value="0"/>
                                            <Setter Property="Width" Value="0"/>
                                        </DataTrigger>-->
                                    </Style.Triggers>
                                </Style>
                            </ComboBox.Style>
                        </ComboBox>
                    </ControlTemplate>
                </MenuItem.Template>
            </MenuItem>

            <MenuItem Template="{StaticResource MenuItemTemplate2}" Header="Генерировать" Margin="10,2">
                <MenuItem.Icon>
                    <Path Fill="{StaticResource IconGenerateBrush}"
                          Data="{StaticResource GeneratePathGeomerty}"/>
                </MenuItem.Icon>
            </MenuItem>

            <MenuItem Template="{StaticResource MenuItemTemplate1}" Header="Параметры по-умолчанию">
                <MenuItem.Icon>
                    <Path Fill="{StaticResource IconCleanBrush}"
                          RenderTransformOrigin="0.5,0.5"
                          Data="{StaticResource CleanPathGeomerty}">

                        <Path.LayoutTransform>
                            <ScaleTransform ScaleX="1.75" ScaleY="1.75"/>
                        </Path.LayoutTransform>
                    </Path>
                </MenuItem.Icon>
            </MenuItem>
            
            <MenuItem Template="{StaticResource SeparatorTemplate}"/>

            <MenuItem Template="{StaticResource MenuItemTemplate1}" Header="Уменьшить">
                <MenuItem.Icon>
                    <Path Fill="{StaticResource IconDecreaseBrush}"
                          Data="{StaticResource DecreasePathGeomerty}"/>
                </MenuItem.Icon>
            </MenuItem>

            <MenuItem Template="{StaticResource MenuItemTemplate1}" Header="Увеличить"
                Command="{x:Static h:CameraController.ZoomExtentsCommand}">
                <MenuItem.Icon>
                    <Path Fill="{StaticResource IconIncreaseBrush}"
                          Data="{StaticResource IncreasePathGeomerty}"/>
                </MenuItem.Icon>
            </MenuItem>

            <MenuItem Template="{StaticResource SeparatorTemplate}"/>

            <MenuItem Template="{StaticResource MenuItemTemplate1}" Header="Вкл/выкл. оси координат">
                <MenuItem.Icon>                   
                    <Path Fill="{StaticResource IconAxistBrush}"
                        Data="{StaticResource AxistPathGeomerty}"/>
                </MenuItem.Icon>
            </MenuItem>

            <MenuItem Template="{StaticResource MenuItemTemplate1}" Header="Вкл/выкл. отображение плоскостей">
                <MenuItem.Icon>
                    <Image Source="/InterfaceOfRobots;component/Themes/Images/isometric_view.png" Height="24" Width="24" Stretch="Uniform"/>
                </MenuItem.Icon>
            </MenuItem>

            <MenuItem Template="{StaticResource MenuItemTemplate1}"
                      Command="{x:Static h:CameraController.TopViewCommand}">
                <MenuItem.Header>
                    <TextBlock>
                        Aaa
                        <LineBreak/>
                        Cntrl+U
                    </TextBlock>
                </MenuItem.Header>

                <MenuItem.Icon>
                    <Image Source="/InterfaceOfRobots;component/Themes/Images/top_view.png" Height="24" Width="24" Stretch="Uniform"/>
                </MenuItem.Icon>
            </MenuItem>

            <MenuItem Template="{StaticResource MenuItemTemplate1}"
                      Command="{x:Static h:CameraController.BottomViewCommand}">
                <MenuItem.Header>
                    <TextBlock>
                        Aaa
                        <LineBreak/>
                        Cntrl+D
                    </TextBlock>
                </MenuItem.Header>

                <MenuItem.Icon>
                    <Image Source="/InterfaceOfRobots;component/Themes/Images/bottom_view.png" Height="24" Width="24" Stretch="Uniform"/>
                </MenuItem.Icon>
            </MenuItem>

            <MenuItem Template="{StaticResource MenuItemTemplate1}"
                      Command="{x:Static h:CameraController.FrontViewCommand}">
                <MenuItem.Header>
                    <TextBlock>
                        Aaa
                        <LineBreak/>
                        Cntrl+F
                    </TextBlock>
                </MenuItem.Header>

                <MenuItem.Icon>
                    <Image Source="/InterfaceOfRobots;component/Themes/Images/front_view.png" Height="24" Width="24" Stretch="Uniform"/>
                </MenuItem.Icon>
            </MenuItem>

            <MenuItem Template="{StaticResource MenuItemTemplate1}"
                      Command="{x:Static h:CameraController.BackViewCommand}">
                <MenuItem.Header>
                    <TextBlock>
                        Aaa
                        <LineBreak/>
                        Cntrl+B
                    </TextBlock>
                </MenuItem.Header>
                
                <MenuItem.Icon>
                    <Image Source="/InterfaceOfRobots;component/Themes/Images/back_view.png" Height="24" Width="24" Stretch="Uniform"/>
                </MenuItem.Icon>
            </MenuItem>

            <MenuItem Template="{StaticResource MenuItemTemplate1}"
                      Command="{x:Static h:CameraController.LeftViewCommand}">
                <MenuItem.Header>
                    <TextBlock>
                        Aaa
                        <LineBreak/>
                        Cntrl+L
                    </TextBlock>
                </MenuItem.Header>
                
                <MenuItem.Icon>
                    <Image Source="/InterfaceOfRobots;component/Themes/Images/left_side_view.png" Height="24" Width="24" Stretch="Uniform"/>
                </MenuItem.Icon>
            </MenuItem>

            <MenuItem Template="{StaticResource MenuItemTemplate1}"
                      Command="{x:Static h:CameraController.RightViewCommand}">
                <MenuItem.Header>
                    <TextBlock>
                        Aaa
                        <LineBreak/>
                        Cntrl+R
                    </TextBlock>
                </MenuItem.Header>

                <MenuItem.Icon>
                    <Image Source="/InterfaceOfRobots;component/Themes/Images/right_side_view.png" Height="24" Width="24" Stretch="Uniform"/>
                </MenuItem.Icon>
            </MenuItem>
        </Menu>

        <Grid Grid.Row="2">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <Grid Grid.Column="0" Margin="15,10,15,0">
                <Grid.RowDefinitions>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="150"/>
                </Grid.RowDefinitions>

                <TabControl Grid.Row="0" TabStripPlacement="Bottom"
                            ItemsSource="{Binding Path=OpenedFiles, Source={x:Static Application.Current}, Mode=OneWay}">
                    
                    <TabControl.Resources>
                        <Style TargetType="{x:Type TabItem}">
                            <Setter Property="FontSize" Value="12"/>
                            <Setter Property="Foreground" Value="Black"/>

                            <Setter Property="Template">
                                <Setter.Value>
                                    <ControlTemplate TargetType="{x:Type TabItem}">
                                        <Border Name="Panel">
                                            <Grid Margin="10, 4">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition/>
                                                    <ColumnDefinition Width="Auto"/>
                                                </Grid.ColumnDefinitions>

                                                <ContentPresenter x:Name="ContentSite" Grid.Column="0"
                                                                  VerticalAlignment="Center" HorizontalAlignment="Center"
                                                                  ContentSource="Header" Margin="0"/>

                                                <Button Grid.Column="1" Padding="3" Margin="5,0"
                                                        Command="{Binding Path=DataContext.CloseFileCommand, RelativeSource={RelativeSource AncestorType={x:Type Page}, Mode=FindAncestor}}"
                                                        CommandParameter="{Binding Path=.}">
                                                 
                                                    <!--<Button.CommandParameter>
                                                        <MultiBinding Converter="{StaticResource ArrayMultiValueConvert}">
                                                            <Binding RelativeSource="{RelativeSource AncestorType={x:Type TabControl}, Mode=FindAncestor}"/>
                                                            <Binding RelativeSource="{RelativeSource AncestorType={x:Type TabItem}, Mode=FindAncestor}"/>
                                                        </MultiBinding>
                                                    </Button.CommandParameter>-->
                                                    
                                                    <Path Stretch="Uniform" Fill="Black"
                                                          Data="M12.567039999999999 4.300341333333334c0.23957333333333333 -0.23951999999999998 0.23957333333333333 -0.6278613333333334 0 -0.8673813333333332 -0.23946666666666666 -0.23951999999999998 -0.62784 -0.23951999999999998 -0.8673066666666667 0L8.000053333333334 7.132608 4.300416 3.43296c-0.23953066666666667 -0.23951999999999998 -0.627872 -0.23951999999999998 -0.867392 0 -0.23951999999999998 0.23951999999999998 -0.23951999999999998 0.6278613333333334 0 0.8673813333333332l3.699648 3.699648 -3.699648 3.6996373333333334c-0.23951999999999998 0.23957333333333333 -0.23951999999999998 0.62784 0 0.8674133333333334 0.23951999999999998 0.23946666666666666 0.6278613333333334 0.23946666666666666 0.867392 0l3.6996373333333334 -3.6996693333333335 3.69968 3.6996693333333335c0.23946666666666666 0.23946666666666666 0.62784 0.23946666666666666 0.8673066666666667 0 0.23957333333333333 -0.23957333333333333 0.23957333333333333 -0.62784 0 -0.8674133333333334L8.867434666666666 7.999989333333334l3.699605333333333 -3.699648Z"/>
                                                </Button>
                                            </Grid>
                                        </Border>

                                        <ControlTemplate.Triggers>
                                            <Trigger Property="IsSelected" Value="True">
                                                <Setter TargetName="Panel" Property="Background" Value="#4a4a4a"/>
                                                <Setter TargetName="Panel" Property="BorderBrush" Value="{StaticResource {x:Static SystemColors.GrayTextBrushKey}}"/>
                                                <Setter TargetName="ContentSite" Property="TextElement.Foreground" Value="#3094ff"/>
                                            </Trigger>

                                            <Trigger Property="IsSelected" Value="False">
                                                <Setter TargetName="Panel" Property="Background" Value="#b0b0b0"/>
                                            </Trigger>
                                        </ControlTemplate.Triggers>
                                    </ControlTemplate>
                                </Setter.Value>
                            </Setter>
                        </Style>
                    </TabControl.Resources>

                    <TabControl.Style>
                        <Style TargetType="{x:Type TabControl}">
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding Path=Items.Count, RelativeSource={RelativeSource Self}}" Value="0">
                                    <Setter Property="Visibility" Value="Hidden"/>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </TabControl.Style>

                    <TabControl.ContentTemplate>
                        <DataTemplate>
                            <h:HelixViewport3D Margin="4"
                                               Background="{h:LinearGradientBrush Gray, White}"
                                               CoordinateSystemHorizontalPosition="Right" CoordinateSystemVerticalPosition="Top"
                                               ShowCoordinateSystem="{Binding Path=Settings.ShowCoordinateSystem, Source={x:Static Application.Current}, Mode=OneWay}"
                                               ShowViewCube="{Binding Path=Settings.ShowViewCube, Source={x:Static Application.Current}, Mode=OneWay}"
                                               ShowTriangleCountInfo="{Binding Path=Settings.ShowTriangleCountInfo, Source={x:Static Application.Current}, Mode=OneWay}"
                                               ShowFieldOfView="{Binding Path=Settings.ShowFieldOfView, Source={x:Static Application.Current}, Mode=OneWay}"
                                               ShowFrameRate="{Binding Path=Settings.ShowFrameRate, Source={x:Static Application.Current}, Mode=OneWay}"
                                
                                               Orthographic="{Binding Path=Settings.Orthographic, Source={x:Static Application.Current}, Mode=OneWay}"
                                               ShowCameraInfo="{Binding Path=Settings.ShowCameraInfo, Source={x:Static Application.Current}, Mode=OneWay}"
                                               ShowCameraTarget="{Binding Path=Settings.ShowCameraTarget, Source={x:Static Application.Current}, Mode=OneWay}"
                                               RotateAroundMouseDownPoint="{Binding Path=Settings.RotateAroundMouseDownPoint, Source={x:Static Application.Current}, Mode=OneWay}"
                                               ZoomAroundMouseDownPoint="{Binding Path=Settings.ZoomAroundMouseDownPoint, Source={x:Static Application.Current}, Mode=OneWay}"
                                               IsInertiaEnabled="{Binding Path=Settings.IsInertiaEnabled, Source={x:Static Application.Current}, Mode=OneWay}"
                                               IsPanEnabled="{Binding Path=Settings.IsPanEnabled, Source={x:Static Application.Current}, Mode=OneWay}"
                                               IsMoveEnabled="{Binding Path=Settings.IsMoveEnabled, Source={x:Static Application.Current}, Mode=OneWay}"
                                               IsRotationEnabled="{Binding Path=Settings.IsRotationEnabled, Source={x:Static Application.Current}, Mode=OneWay}"
                                               IsZoomEnabled="{Binding Path=Settings.IsZoomEnabled, Source={x:Static Application.Current}, Mode=OneWay}"
                                               IsChangeFieldOfViewEnabled="{Binding Path=Settings.IsChangeFieldOfViewEnabled, Source={x:Static Application.Current}, Mode=OneWay}"
                                               RotationSensitivity="{Binding Path=Settings.RotationSensitivity, Source={x:Static Application.Current}, Mode=OneWay}"
                                               ZoomSensitivity="{Binding Path=Settings.ZoomSensitivity, Source={x:Static Application.Current}, Mode=OneWay}"
                                               CameraInertiaFactor="{Binding Path=Settings.CameraInertiaFactor, Source={x:Static Application.Current}, Mode=OneWay}"
                                               PageUpDownZoomSensitivity="5"
                                               MinimumFieldOfView="10.0" MaximumFieldOfView="120.0">

                                <h:HelixViewport3D.DefaultCamera>
                                    <PerspectiveCamera Position="100,100,100"
                                                       LookDirection="-100,-100,-100"
                                                       UpDirection="0,0,1"
                                                       FieldOfView="10"
                                                       NearPlaneDistance="0.001" />
                                </h:HelixViewport3D.DefaultCamera>

                                <h:HelixViewport3D.InputBindings>
                                    <KeyBinding Key="B"
                                                Command="{x:Static h:CameraController.BackViewCommand}"/>
                                    <KeyBinding Key="F"
                                                Command="{x:Static h:CameraController.FrontViewCommand}"/>
                                    <KeyBinding Key="U"
                                                Command="{x:Static h:CameraController.TopViewCommand}"/>
                                    <KeyBinding Key="D"
                                                Command="{x:Static h:CameraController.BottomViewCommand}"/>
                                    <KeyBinding Key="L"
                                                Command="{x:Static h:CameraController.LeftViewCommand}"/>
                                    <KeyBinding Key="R"
                                                Command="{x:Static h:CameraController.RightViewCommand}"/>

                                    <MouseBinding Command="{x:Static h:CameraController.RotateCommand}"  Gesture="RightClick" />
                                    <MouseBinding Command="{x:Static h:CameraController.ZoomCommand}" Gesture="MiddleClick" />
                                    <MouseBinding Command="{x:Static h:CameraController.PanCommand}" Gesture="LeftClick" />
                                </h:HelixViewport3D.InputBindings>

                                <h:SunLight/>
                                <h:GridLinesVisual3D/>
                                <h:CoordinateSystemVisual3D ArrowLengths="2.5"/>

                                <h:CubeVisual3D Center="0 0 0" Fill="Yellow" SideLength="1"/>
                            </h:HelixViewport3D>
                        </DataTemplate>
                    </TabControl.ContentTemplate>
                </TabControl>

                <GridSplitter Grid.Row="1" ShowsPreview="False" Height="5" HorizontalAlignment="Stretch" VerticalAlignment="Center"
                              ResizeDirection="Rows" ResizeBehavior="PreviousAndNext"/>

                <TabControl Grid.Row="2" TabStripPlacement="Bottom">
                    <TabItem Header="Сообщения">
                        <DataGrid FontSize="{StaticResource FontSizeNP3}"
                                  ItemsSource="{Binding Path=MessagesCollection, Mode=OneWay}"
                                  SelectionMode="Single"
                                  AutoGenerateColumns="False"
                                  EnableRowVirtualization="False"
                                  ScrollViewer.CanContentScroll="True"
                                  ScrollViewer.HorizontalScrollBarVisibility="Auto"
                                  ScrollViewer.VerticalScrollBarVisibility="Auto"
                                  lib:ScrollViewerAttachedPropertiesDataGrid.ScrollOnLoadingRow="True">

                            <DataGrid.Resources>
                                <Style x:Key="dgCellBase" TargetType="{x:Type DataGridCell}">
                                    <Setter Property="IsEnabled" Value="False"/>
                                    <Setter Property="Focusable" Value="False"/>
                                    <Setter Property="Foreground" Value="Black"/>
                                    <Setter Property="TextBlock.TextAlignment" Value="Center"/>
                                    <Setter Property="Template">
                                        <Setter.Value>
                                            <ControlTemplate TargetType="{x:Type DataGridCell}">
                                                <Grid Background="{TemplateBinding Background}">
                                                    <ContentPresenter VerticalAlignment="Center" Margin="15,0"/>
                                                </Grid>
                                            </ControlTemplate>
                                        </Setter.Value>
                                    </Setter>

                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding LogLevel}" Value="Error">
                                            <Setter Property="Foreground" Value="Red"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>

                                <Style TargetType="{x:Type DataGridCell}" BasedOn="{StaticResource dgCellBase}"></Style>

                                <Style x:Key="dgCellLeft" TargetType="{x:Type DataGridCell}" BasedOn="{StaticResource dgCellBase}">
                                    <Setter Property="TextBlock.TextAlignment" Value="Left"/>
                                </Style>

                                <Style TargetType="{x:Type DataGridColumnHeader}">
                                    <Setter Property="HorizontalContentAlignment" Value="Center"/>
                                </Style>

                                <Style TargetType="{x:Type DataGridRowHeader}">
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding Path=Item.Ditails, RelativeSource={RelativeSource AncestorType={x:Type DataGridRow}}}" Value="">
                                            <Setter Property="IsEnabled" Value="False"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </DataGrid.Resources>

                            <DataGrid.RowHeaderTemplate>
                                <DataTemplate>
                                    <Expander Expanded="Expander_Expanded"  Collapsed="Expander_Collapsed">
                                        <Expander.Style>
                                            <Style TargetType="{x:Type Expander}">
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding Path=Item.Ditails, RelativeSource={RelativeSource AncestorType={x:Type DataGridRow}}}" Value="">
                                                        <Setter Property="Visibility" Value="Hidden"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </Expander.Style>
                                    </Expander>
                                </DataTemplate>
                            </DataGrid.RowHeaderTemplate>
                            
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="Время" Binding="{Binding Time, StringFormat=\{0:HH:mm:ss\}}" Width="Auto"/>
                                <DataGridTextColumn Header="Сообщение" Binding="{Binding Message}" Width="*" CellStyle="{StaticResource dgCellLeft}"/>
                            </DataGrid.Columns>

                            <DataGrid.RowDetailsTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding Ditails}" Focusable="False" IsEnabled="False" Padding="5,10"/>
                                </DataTemplate>
                            </DataGrid.RowDetailsTemplate>
                        </DataGrid>
                    </TabItem>
                </TabControl>
            </Grid>

            <GridSplitter Grid.Column="1" ShowsPreview="False" Width="5" HorizontalAlignment="Center" VerticalAlignment="Stretch"
                          ResizeDirection="Columns" ResizeBehavior="PreviousAndNext"/>
            
            <Grid Grid.Column="2">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <Grid Grid.Column="0">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <Border Grid.Row="0" Background="{StaticResource {x:Static SystemColors.InfoBrushKey}}" BorderBrush="#4a4a4a" BorderThickness="3">
                        <ContentControl ScrollViewer.CanContentScroll="True"
                                        ScrollViewer.VerticalScrollBarVisibility="Auto">
                            <ContentControl.Style>
                                <Style TargetType="{x:Type ContentControl}">
                                    <!--<Setter Property="Template">
                                            <Setter.Value>
                                                <ControlTemplate TargetType="ContentControl">
                                                    -->
                                    <!--Для примера-->
                                    <!--
                                                    <TreeView FontSize="15" Padding="5,5,10,5" HorizontalContentAlignment="Center">
                                                        <TreeViewItem Header="Базы данных">
                                                            <TreeViewItem Header="MS SQL Server" />
                                                            <TreeViewItem Header="MySQL" />
                                                        </TreeViewItem>
                                                        <TreeViewItem Header="Языки программирования">
                                                            <TreeViewItem Header="C-языки">
                                                                <TreeViewItem Header="C#" />
                                                            </TreeViewItem>
                                                            <TreeViewItem Header="Basic">
                                                                <TreeViewItem Header="Visual Basic" />
                                                            </TreeViewItem>
                                                        </TreeViewItem>
                                                    </TreeView>
                                                </ControlTemplate>
                                            </Setter.Value>
                                        </Setter>-->

                                    <Setter Property="ContentTemplate" Value="{StaticResource OtherTemplateStyle}"/>

                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding Path=IsChecked, ElementName=RobotRadioButton}" Value="True">
                                            <Setter Property="ContentTemplate" Value="{StaticResource RobotControlTemplate}"/>
                                        </DataTrigger>

                                        <DataTrigger Binding="{Binding Path=IsChecked, ElementName=ControlRadioButton}" Value="True">
                                            <Setter Property="ContentTemplate" Value="{StaticResource UprControlTemplate}"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </ContentControl.Style>
                        </ContentControl>
                    </Border>

                    <GridSplitter Grid.Column="0" Grid.Row="1" ShowsPreview="False" Height="5" HorizontalAlignment="Stretch"
                                  ResizeDirection="Rows"  ResizeBehavior="PreviousAndNext"/>

                    <TabControl Grid.Row="2" Grid.Column="0"  TabStripPlacement="Bottom"
                                ScrollViewer.CanContentScroll="True"
                                ScrollViewer.HorizontalScrollBarVisibility="Auto"
                                ScrollViewer.VerticalScrollBarVisibility="Auto">

                        <TabItem Header="Свойства">

                        </TabItem>

                        <TabItem Header="Параметры">
                            <!--<pt:PropertyGrid Margin="-5">
                                <pt:PropertyGrid.ControlFactory>
                                    <pt:CustomControlFactory/>
                                </pt:PropertyGrid.ControlFactory>
                            </pt:PropertyGrid>-->
                            
                            <TreeView FontSize="{StaticResource FontSizeNP2}" 
                                      VerticalContentAlignment="Top" HorizontalContentAlignment="Stretch"
                                      VerticalAlignment="Stretch" HorizontalAlignment="Stretch">

                                <TreeView.Resources>
                                    <SolidColorBrush x:Key="TreeViewItem.TreeArrow.Static.Checked.Fill" Color="#FF595959"/>
                                    <SolidColorBrush x:Key="TreeViewItem.TreeArrow.Static.Checked.Stroke" Color="#FF262626"/>
                                    <SolidColorBrush x:Key="TreeViewItem.TreeArrow.MouseOver.Stroke" Color="#FF27C7F7"/>
                                    <SolidColorBrush x:Key="TreeViewItem.TreeArrow.MouseOver.Fill" Color="#FFCCEEFB"/>
                                    <SolidColorBrush x:Key="TreeViewItem.TreeArrow.MouseOver.Checked.Stroke" Color="#FF1CC4F7"/>
                                    <SolidColorBrush x:Key="TreeViewItem.TreeArrow.MouseOver.Checked.Fill" Color="#FF82DFFB"/>
                                    <PathGeometry x:Key="TreeArrow" Figures="M0,0 L0,6 L6,0 z"/>
                                    <SolidColorBrush x:Key="TreeViewItem.TreeArrow.Static.Fill" Color="#FFFFFFFF"/>
                                    <SolidColorBrush x:Key="TreeViewItem.TreeArrow.Static.Stroke" Color="#FF818181"/>
                                    
                                    <Style TargetType="{x:Type TreeViewItem}">
                                        <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
                                        <Setter Property="Focusable" Value="False"/>
                                        <Setter Property="Margin" Value="5"/>

                                        <Setter Property="Template">
                                            <Setter.Value>
                                                <ControlTemplate TargetType="TreeViewItem">
                                                    <Grid>
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition MinWidth="19" Width="Auto"/>
                                                            <ColumnDefinition Width="*"/>
                                                        </Grid.ColumnDefinitions>
                                                        <Grid.RowDefinitions>
                                                            <RowDefinition Height="Auto"/>
                                                            <RowDefinition/>
                                                        </Grid.RowDefinitions>
                                                        
                                                        <ToggleButton x:Name="Expander" ClickMode="Press" IsChecked="{Binding IsExpanded, RelativeSource={RelativeSource TemplatedParent}}" Style="{DynamicResource ExpandCollapseToggleStyle}"/>
                                                        
                                                        <Border x:Name="Bd" Grid.Column="1" BorderBrush="{TemplateBinding BorderBrush}" BorderThickness="{TemplateBinding BorderThickness}" Background="{TemplateBinding Background}" Padding="{TemplateBinding Padding}" SnapsToDevicePixels="true">
                                                            <ContentPresenter x:Name="PART_Header" ContentSource="Header" HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}" SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}"/>
                                                        </Border>
                                                        
                                                        <ItemsPresenter x:Name="ItemsHost" Grid.Row="1" Grid.Column="1" />
                                                    </Grid>

                                                    <ControlTemplate.Triggers>
                                                        <Trigger Property="IsExpanded" Value="false">
                                                            <Setter Property="Visibility" TargetName="ItemsHost" Value="Collapsed"/>
                                                        </Trigger>
                                                        <Trigger Property="HasItems" Value="false">
                                                            <Setter Property="Visibility" TargetName="Expander" Value="Hidden"/>
                                                        </Trigger>
                                                        <Trigger Property="IsSelected" Value="true">
                                                            <Setter Property="Background" TargetName="Bd" Value="{DynamicResource {x:Static SystemColors.HighlightBrushKey}}"/>
                                                            <Setter Property="Foreground" Value="{DynamicResource {x:Static SystemColors.HighlightTextBrushKey}}"/>
                                                        </Trigger>
                                                        <MultiTrigger>
                                                            <MultiTrigger.Conditions>
                                                                <Condition Property="IsSelected" Value="true"/>
                                                                <Condition Property="IsSelectionActive" Value="false"/>
                                                            </MultiTrigger.Conditions>
                                                            <Setter Property="Background" TargetName="Bd" Value="{DynamicResource {x:Static SystemColors.InactiveSelectionHighlightBrushKey}}"/>
                                                            <Setter Property="Foreground" Value="{DynamicResource {x:Static SystemColors.InactiveSelectionHighlightTextBrushKey}}"/>
                                                        </MultiTrigger>
                                                        <Trigger Property="IsEnabled" Value="false">
                                                            <Setter Property="Foreground" Value="{DynamicResource {x:Static SystemColors.GrayTextBrushKey}}"/>
                                                        </Trigger>
                                                    </ControlTemplate.Triggers>
                                                </ControlTemplate>
                                            </Setter.Value>
                                        </Setter>                                        
                                    </Style>

                                    <Style x:Key="ExpandCollapseToggleStyle" TargetType="{x:Type ToggleButton}">
                                        <Setter Property="Focusable" Value="False"/>
                                        <Setter Property="Width" Value="16"/>
                                        <Setter Property="Height" Value="16"/>
                                        <Setter Property="Template">
                                            <Setter.Value>
                                                <ControlTemplate TargetType="{x:Type ToggleButton}">
                                                    <Border Background="Transparent" Height="16" Padding="5,5,5,5" Width="16">
                                                        <Path x:Name="ExpandPath" Data="{StaticResource TreeArrow}" Fill="{StaticResource TreeViewItem.TreeArrow.Static.Fill}" Stroke="{StaticResource TreeViewItem.TreeArrow.Static.Stroke}">
                                                            <Path.RenderTransform>
                                                                <RotateTransform Angle="135" CenterY="3" CenterX="3"/>
                                                            </Path.RenderTransform>
                                                        </Path>
                                                    </Border>
                                                    <ControlTemplate.Triggers>
                                                        <Trigger Property="IsChecked" Value="True">
                                                            <Setter Property="RenderTransform" TargetName="ExpandPath">
                                                                <Setter.Value>
                                                                    <RotateTransform Angle="180" CenterY="3" CenterX="3"/>
                                                                </Setter.Value>
                                                            </Setter>
                                                            <Setter Property="Fill" TargetName="ExpandPath" Value="{StaticResource TreeViewItem.TreeArrow.Static.Checked.Fill}"/>
                                                            <Setter Property="Stroke" TargetName="ExpandPath" Value="{StaticResource TreeViewItem.TreeArrow.Static.Checked.Stroke}"/>
                                                        </Trigger>
                                                        <Trigger Property="IsMouseOver" Value="True">
                                                            <Setter Property="Stroke" TargetName="ExpandPath" Value="{StaticResource TreeViewItem.TreeArrow.MouseOver.Stroke}"/>
                                                            <Setter Property="Fill" TargetName="ExpandPath" Value="{StaticResource TreeViewItem.TreeArrow.MouseOver.Fill}"/>
                                                        </Trigger>
                                                        <MultiTrigger>
                                                            <MultiTrigger.Conditions>
                                                                <Condition Property="IsMouseOver" Value="True"/>
                                                                <Condition Property="IsChecked" Value="True"/>
                                                            </MultiTrigger.Conditions>
                                                            <Setter Property="Stroke" TargetName="ExpandPath" Value="{StaticResource TreeViewItem.TreeArrow.MouseOver.Checked.Stroke}"/>
                                                            <Setter Property="Fill" TargetName="ExpandPath" Value="{StaticResource TreeViewItem.TreeArrow.MouseOver.Checked.Fill}"/>
                                                        </MultiTrigger>
                                                    </ControlTemplate.Triggers>
                                                </ControlTemplate>
                                            </Setter.Value>
                                        </Setter>
                                    </Style>

                                    <Style TargetType="{x:Type ContentControl}">
                                        <Setter Property="Margin" Value="-25,0,-5,-5"/>
                                    </Style>
                                </TreeView.Resources>

                                <TreeViewItem Header="Общие">
                                    <ContentControl ContentTemplate="{StaticResource PlitaTemplate3Style}"/>
                                </TreeViewItem>

                                <TreeViewItem Header="Доп.">
                                    <ContentControl ContentTemplate="{StaticResource PlitaDopTemplate3Style}"/>
                                </TreeViewItem>

                                <TreeViewItem Header="Сварка" HorizontalContentAlignment="Stretch">
                                    <ContentControl ContentTemplate="{StaticResource PlitaSvarkaTemplate3Style}"
                                                    HorizontalAlignment="Stretch"/>
                                </TreeViewItem>
                            </TreeView>
                        </TabItem>
                    </TabControl>
                </Grid>

                <Grid Grid.Column="1">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <Grid.Resources>
                        <Style TargetType="{x:Type ToggleButton}" BasedOn="{StaticResource TextBase}">
                            <Setter Property="FontSize" Value="14"/>
                            <Setter Property="Template" Value="{StaticResource MenuToggleButtonTemplate}"/>
                            <Setter Property="LayoutTransform">
                                <Setter.Value>
                                    <RotateTransform CenterX="0" CenterY="0" Angle="90"/>
                                </Setter.Value>
                            </Setter>
                        </Style>
                    </Grid.Resources>

                    <RadioButton Grid.Row="0" x:Name="RobotRadioButton" Content="Роботы"
                                 Template="{StaticResource RadioButtonInToggleTemplate}"/>

                    <RadioButton Grid.Row="1" x:Name="ControlRadioButton" Content="Управление" IsChecked="True"
                                 Template="{StaticResource RadioButtonInToggleTemplate}"/>
                </Grid>
            </Grid>
        </Grid>

        <DockPanel Grid.Row="3" Background="{StaticResource ThemeBottomMenuBarBrush}">
            
        </DockPanel>
    </Grid>
</Page>
