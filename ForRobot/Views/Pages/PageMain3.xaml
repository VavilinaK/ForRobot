<Page x:Class="ForRobot.Views.Pages.PageMain3"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
      xmlns:client="clr-namespace:ForRobot.Libr.Client"
      xmlns:control="clr-namespace:ForRobot.Views.Controls"
      xmlns:lib="clr-namespace:ForRobot.Libr"
      xmlns:vm="clr-namespace:ForRobot.ViewModels"  
      xmlns:model="clr-namespace:ForRobot.Model"
      xmlns:file="clr-namespace:ForRobot.Model.File3D"
      xmlns:local="clr-namespace:ForRobot.Views.Pages" 
      xmlns:diag="clr-namespace:System.Diagnostics;assembly=WindowsBase"
      xmlns:avalonDock="https://github.com/Dirkster99/AvalonDock"
      xmlns:sys="clr-namespace:System;assembly=mscorlib"
      xmlns:i="http://schemas.microsoft.com/expression/2010/interactivity"
      xmlns:behavior="clr-namespace:ForRobot.Libr.Behavior"
      xmlns:componentModel="clr-namespace:System.ComponentModel;assembly=System"
      xmlns:h="http://helix-toolkit.org/wpf"
      xmlns:hx="http://helix-toolkit.org/wpf/SharpDX"
      xmlns:pt="http://propertytools.org/wpf"
      mc:Ignorable="d"       
      d:DesignHeight="800" d:DesignWidth="1500">

    <Page.Title>
        <MultiBinding Converter="{StaticResource StringFormatMultiConvert}" ConverterParameter="Интерфейс генерации программ - v.{0}">
            <Binding Path="Version" Mode="OneWay"/>
        </MultiBinding>
    </Page.Title>

    <Page.DataContext>
        <vm:MainPageViewModel3/>
    </Page.DataContext>

    <Page.InputBindings>
        <KeyBinding Key="Return" Command="{Binding Path=LostFocusCommand}"
                    CommandParameter="{Binding Path=., RelativeSource={RelativeSource AncestorType={x:Type Page}, Mode=FindAncestor}}"/>

        <KeyBinding Gesture="Ctrl+Shift+N" Command="{Binding Path=CreateNewFileCommand}"/>

        <KeyBinding Gesture="Ctrl+O" Command="{Binding Path=OpenedFileCommand}"/>

        <KeyBinding Gesture="Ctrl+S"
                    Command="{Binding Path=SaveFileCommand}"                    
                    CommandParameter="{Binding Path=SelectedFile}"/>

        <KeyBinding Gesture="Ctrl+Z" Command="{Binding Path=UndoCommand}"/>

        <KeyBinding Gesture="Ctrl+V" Command="{Binding Path=RedoCommand}"/>
        
        <KeyBinding Gesture="Ctrl+F5" 
                    Command="{Binding Path=GenerateProgramCommandAsync}"
                    CommandParameter="{Binding Path=., RelativeSource={RelativeSource AncestorType={x:Type Page}, Mode=FindAncestor}}"/>

        <KeyBinding Gesture="Ctrl+Shift+S"
                    Command="{Binding Path=StandartParametrsCommand}"
                    CommandParameter="{Binding Path=SelectedFile}"/>

        <KeyBinding Key="OemMinus" Command="{Binding Path=ZoomCommand}">
            <KeyBinding.CommandParameter>
                <sys:Double>1</sys:Double>
            </KeyBinding.CommandParameter>
        </KeyBinding>

        <KeyBinding Key="OemPlus" Command="{Binding Path=ZoomCommand}">
            <KeyBinding.CommandParameter>
                <sys:Double>-50</sys:Double>
            </KeyBinding.CommandParameter>
        </KeyBinding>
    </Page.InputBindings>

    <Page.Resources>
        <Style x:Key="TextBase" TargetType="{x:Type FrameworkElement}">
            <Setter Property="TextElement.FontFamily" Value="DefaultFont"/>
            <Setter Property="TextElement.Foreground" Value="{StaticResource ThemeFgP2Brush}"/>
        </Style>

        <Style x:Key="cbBase" TargetType="{x:Type ComboBox}" BasedOn="{StaticResource TextBase}">
            <Setter Property="FontSize" Value="{StaticResource FontSizeNP2}"/>
            <Setter Property="ItemContainerStyle">
                <Setter.Value>
                    <Style TargetType="{x:Type ComboBoxItem}">
                        <Setter Property="Height" Value="45"/>
                        <Setter Property="TextBlock.TextAlignment" Value="Center"/>
                        <Setter Property="TextBlock.VerticalAlignment" Value="Center"/>
                    </Style>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="MenuItemDetalNull" TargetType="{x:Type MenuItem}">
            <Style.Triggers>
                <DataTrigger Binding="{Binding Path=SelectedFile.Detal}" Value="{x:Null}">
                    <Setter Property="IsEnabled" Value="False"/>
                </DataTrigger>
            </Style.Triggers>
        </Style>
    </Page.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="25"/>
        </Grid.RowDefinitions>

        <Menu Grid.Row="0">
            <Menu.Resources>
                <Style TargetType="{x:Type MenuItem}" BasedOn="{StaticResource TextBase}">
                    <Setter Property="FontSize" Value="{StaticResource FontSizeN}"/>
                    <Setter Property="VerticalContentAlignment" Value="Center"/>
                    <Setter Property="HorizontalContentAlignment" Value="Center"/>
                    <Setter Property="Padding" Value="10, 3"/>
                    <Style.Resources>
                        <Style TargetType="{x:Type Path}">
                            <Setter Property="Stretch" Value="Uniform"/>
                            <Setter Property="RenderTransformOrigin" Value="0.5, 0.5"/>
                            <Setter Property="LayoutTransform">
                                <Setter.Value>
                                    <ScaleTransform ScaleX="1.75" ScaleY="1.75"/>
                                </Setter.Value>
                            </Setter>
                        </Style>

                        <Style TargetType="{x:Type CheckBox}">
                            <Setter Property="HorizontalAlignment" Value="Center"/>
                        </Style>
                    </Style.Resources>
                </Style>
              
                <!--<Style TargetType="{x:Type Path}">
                    <Setter Property="Stretch" Value="Uniform"/>
                </Style>-->
                <!--<Style TargetType="{x:Type MenuItem}" BasedOn="{StaticResource MenuItemTemplate}"></Style>-->
            </Menu.Resources>
            
            <MenuItem Header="_Файл">
                <MenuItem Header="_Создать"
                          Command="{Binding Path=CreateNewFileCommand}"
                          InputGestureText="Ctrl+Shift+N">
                    <MenuItem.Icon>
                        <Path Fill="{StaticResource IconNewFileBrush}" StrokeThickness="0"
                              Data="{StaticResource NewFilePathGeomerty}"/>
                    </MenuItem.Icon>
                </MenuItem>
                <MenuItem Header="_Открыть"
                          Command="{Binding Path=OpenedFileCommand}"
                          InputGestureText="Ctrl+O">
                    <MenuItem.Icon>
                        <Path Fill="{StaticResource IconOpenFileBrush}"
                              Data="{StaticResource OpenPathGeomerty}"/>
                    </MenuItem.Icon>
                </MenuItem>
                <MenuItem Command="{Binding Path=SaveFileCommand}" InputGestureText="Ctrl+S">
                    <MenuItem.Header>
                        <MultiBinding Converter="{StaticResource StringFormatMultiConvert}" ConverterParameter="_Сохранить {0}">
                            <Binding Path="SelectedFile.Name" Mode="OneWay"/>
                        </MultiBinding>
                    </MenuItem.Header>

                    <MenuItem.Icon>
                        <Path Fill="{StaticResource IconSaveBrush}"
                              Data="{StaticResource SavePathGeomerty}"/>
                    </MenuItem.Icon>
                </MenuItem>
                <MenuItem Command="{Binding Path=SaveAsFileCommand}"
                          CommandParameter="{Binding Path=SelectedFile}"
                          IsEnabled="False">
                    <MenuItem.Header>
                        <MultiBinding Converter="{StaticResource StringFormatMultiConvert}" ConverterParameter="_Сохранить {0} как">
                            <Binding Path="SelectedFile.Name" Mode="OneWay"/>
                        </MultiBinding>
                    </MenuItem.Header>
                </MenuItem>
                <MenuItem Header="_Сохранить все"
                          Command="{Binding Path=SaveAsFileCommand}"
                          InputGestureText="Ctrl+K, S">
                    <MenuItem.Icon>
                        <Path Fill="{StaticResource IconSaveAsBrush}"
                              Data="{StaticResource SaveAsPathGeomerty}"/>
                    </MenuItem.Icon>
                </MenuItem>                
                <Separator/>
                <!--<MenuItem Header="_Экспорт модели"/>-->
                <MenuItem Header="_Экспорт параметров">
                    <MenuItem.Icon>
                        <Path Fill="{StaticResource IconExportBrush}"
                              Data="{StaticResource ExportPathGeomerty}"/>
                    </MenuItem.Icon>
                </MenuItem>
                <MenuItem Header="_Импорт параметров">
                    <MenuItem.Icon>
                        <Path Fill="{StaticResource IconImportBrush}"
                              Data="{StaticResource ImportPathGeomerty}"/>
                    </MenuItem.Icon>
                </MenuItem>                
                <Separator/>
                <MenuItem Header="_Выход" InputGestureText="Alt+F4"/>
            </MenuItem>

            <MenuItem Header="_Правка">
                <MenuItem Header="_Отменить" InputGestureText="Ctrl+Z"/>
                <MenuItem Header="_Вернуть" InputGestureText="Ctrl+Y"/>
                <!--<Separator/>
                <MenuItem Header="_Обновить"/>
                <MenuItem Header="_Выделить всё" InputGestureText="Ctrl+A"/>
                <MenuItem Header="_Выделить область"/>-->
                <!--<Separator/>
                <MenuItem Header="_Вырезать" InputGestureText="Ctrl+X"/>
                <MenuItem Header="_Копировать" InputGestureText="Ctrl+C"/>
                <MenuItem Header="_Вставить" InputGestureText="Ctrl+V"/>
                <MenuItem Header="_Дублировать" InputGestureText="Ctrl+D"/>
                <MenuItem Header="_Удалить" InputGestureText="Del"/>-->
            </MenuItem>

            <MenuItem Header="_Генерация" >
                <MenuItem Header="_Копировать программу на контроллер" IsCheckable="True"
                          IsChecked="{Binding Path=Settings.SendingGeneratedFiles, Source={x:Static Application.Current}, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                <MenuItem Header="_Запрашивать имя генерируемой программы" IsCheckable="True"
                          IsChecked="{Binding Path=Settings.AskNameFile, Source={x:Static Application.Current}, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                <MenuItem Header="_Начать генерацию" InputGestureText="Ctrl+F5" Style="{StaticResource MenuItemDetalNull}">
                    <MenuItem.Icon>
                        <Path Fill="{StaticResource IconRunProgramBrush}" StrokeThickness="0"
                              Data="{StaticResource RunTrianglePathGeomerty}" Margin="2"/>
                    </MenuItem.Icon>
                </MenuItem>
                <!--<Separator/>
                <MenuItem Header="_Настройки"/>-->
            </MenuItem>

            <MenuItem Header="_Окно" >
                <MenuItem Header="_Настройки робота/ов"
                          Command="{Binding Path=CollapedCommand}" CommandParameter="Robots"/>
                <MenuItem Header="_Окно управления работами"
                          Command="{Binding Path=CollapedCommand}" CommandParameter="Control"/>
                
                <Separator/>
                
                <MenuItem Header="_Состав сцены"
                          Command="{Binding Path=CollapedCommand}" CommandParameter="Components"/>
                <MenuItem Header="_Свойства модели"
                          Command="{Binding Path=CollapedCommand}" CommandParameter="Properties"/>
                
                <Separator/>
                
                <MenuItem Header="_Параметры детали"
                          Command="{Binding Path=CollapedCommand}" CommandParameter="ParametrsOfDetal"/>
                <!--<MenuItem Header="_Настройки генерации"/>-->
                <Separator/>
                <MenuItem Header="_Окно сообщений"
                          Command="{Binding Path=CollapedCommand}" CommandParameter="Messages"/>
            </MenuItem>

            <MenuItem Header="_3D View" >
                <MenuItem Header="_Система координат" IsCheckable="True"
                          IsChecked="{Binding Path=Settings.ShowCoordinateSystem, Source={x:Static Application.Current}, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>

                <MenuItem Header="_Пространственный куб" IsCheckable="True"
                          IsChecked="{Binding Path=Settings.ShowViewCube, Source={x:Static Application.Current}, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>

                <MenuItem Header="_Кол-во полигонов" IsCheckable="True"
                          IsChecked="{Binding Path=Settings.ShowTriangleCountInfo, Source={x:Static Application.Current}, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />

                <Separator/>

                <MenuItem Header="_Ортоганальная камера" IsCheckable="True"
                          IsChecked="{Binding Path=Settings.Orthographic, Source={x:Static Application.Current}, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>

                <MenuItem Header="_Демонстрация информации о камере" IsCheckable="True"
                          IsChecked="{Binding Path=Settings.ShowCameraInfo, Source={x:Static Application.Current}, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>

                <MenuItem Header="_Демонстрация курсора камеры" IsCheckable="True"
                          IsChecked="{Binding Path=Settings.ShowCameraTarget, Source={x:Static Application.Current}, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>

                <MenuItem Header="_Поворот вокруг мыши" IsCheckable="True"
                          IsChecked="{Binding Path=Settings.RotateAroundMouseDownPoint, Source={x:Static Application.Current}, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>

                <MenuItem Header="_Приближение около мыши" IsCheckable="True"
                          IsChecked="{Binding Path=Settings.ZoomAroundMouseDownPoint, Source={x:Static Application.Current}, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>

                <MenuItem Header="_Инерция" IsCheckable="True"
                          IsChecked="{Binding Path=Settings.IsInertiaEnabled, Source={x:Static Application.Current}, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>

                <MenuItem Header="_Панорамирование" IsCheckable="True"
                          IsChecked="{Binding Path=Settings.IsPanEnabled, Source={x:Static Application.Current}, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>

                <MenuItem Header="_Перемещение" IsCheckable="True"
                          IsChecked="{Binding Path=Settings.IsMoveEnabled, Source={x:Static Application.Current}, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>

                <MenuItem Header="_Вращение" IsCheckable="True"
                          IsChecked="{Binding Path=Settings.IsRotationEnabled, Source={x:Static Application.Current}, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>

                <MenuItem Header="_Маштабирование" IsCheckable="True"
                          IsChecked="{Binding Path=Settings.IsZoomEnabled, Source={x:Static Application.Current}, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
            </MenuItem>

            <MenuItem Header="_Настройки" Command="{Binding Path=PropertiesCommand}"/>

            <MenuItem Header="_Справка" Command="{Binding Path=HelpCommand}" InputGestureText="Ctrl+F1"/>
        </Menu>

        <Menu Grid.Row="1">
            <Menu.Resources>
                <ControlTemplate x:Key="MenuItemTemplate1" TargetType="{x:Type MenuItem}">
                    <Button Content="{Binding Icon, RelativeSource={RelativeSource TemplatedParent}}"
                    ToolTip="{Binding Header, RelativeSource={RelativeSource TemplatedParent}}"
                    Command="{Binding Command, RelativeSource={RelativeSource TemplatedParent}}"
                    CommandParameter="{Binding CommandParameter, RelativeSource={RelativeSource TemplatedParent}}"
                    CommandTarget="{Binding CommandTarget, RelativeSource={RelativeSource TemplatedParent}}"
                    Width="Auto" Margin="3,2" Padding="5"/>
                </ControlTemplate>

                <ControlTemplate x:Key="MenuItemTemplate2" TargetType="{x:Type MenuItem}">
                    <Border Name="Panel" BorderThickness="0" CornerRadius="5">
                        <StackPanel Orientation="Horizontal" Margin="5">
                            <ContentPresenter x:Name="Icon" ContentSource="Icon" Height="30" Margin="5,0"/>
                            <ContentPresenter ContentSource="Header" RecognizesAccessKey="True"
                                      TextElement.FontSize="{StaticResource FontSizeNP3}"
                                      TextElement.Foreground="{StaticResource ThemeFgP2Brush}"
                                      VerticalAlignment="Center" Margin="5,0"
                                      Style="{StaticResource TextBase}"/>
                        </StackPanel>
                    </Border>

                    <ControlTemplate.Triggers>
                        <Trigger Property="IsMouseOver" Value="True">
                            <Setter TargetName="Panel" Property="Background" Value="{StaticResource ThemeIsMouseOverMenuItemBgBrush}"/>
                        </Trigger>

                        <Trigger Property="IsPressed" Value="True">
                            <Setter TargetName="Panel" Property="Background" Value="{StaticResource ThemeIsPressedMenuItemBgBrush}"/>
                        </Trigger>
                    </ControlTemplate.Triggers>
                </ControlTemplate>

                <ControlTemplate x:Key="SeparatorTemplate" TargetType="{x:Type MenuItem}">
                    <Separator HorizontalAlignment="Right" Margin="10,2">
                        <Separator.LayoutTransform>
                            <RotateTransform Angle="90" />
                        </Separator.LayoutTransform>
                    </Separator>
                </ControlTemplate>

                <Style TargetType="{x:Type Path}">
                    <Setter Property="Stretch" Value="Uniform"/>
                </Style>

                <Style TargetType="{x:Type ToggleButton}">
                    <Setter Property="Width" Value="Auto"/>
                    <Setter Property="Padding" Value="5"/>
                    <Setter Property="Margin" Value="3, 2"/>
                </Style>
            </Menu.Resources>

            <Menu.ItemsPanel>
                <ItemsPanelTemplate>
                    <WrapPanel HorizontalAlignment="Left" Margin="10,3"/>
                </ItemsPanelTemplate>
            </Menu.ItemsPanel>

            <MenuItem Header="Создать новый файл (Ctrl+Shift+N)"
                      Template="{StaticResource MenuItemTemplate1}"
                      Command="{Binding Path=CreateNewFileCommand}">
                
                <MenuItem.Icon>
                    <Path Fill="{StaticResource IconNewFileBrush}" StrokeThickness="0"
                          Data="{StaticResource NewFilePathGeomerty}"/>
                </MenuItem.Icon>
            </MenuItem>

            <MenuItem Header="Открыть файл (Ctrl+O)"
                      Template="{StaticResource MenuItemTemplate1}"
                      Command="{Binding Path=OpenedFileCommand}">
                
                <MenuItem.Icon>
                    <Path Fill="{StaticResource IconOpenFileBrush}"
                          Data="{StaticResource OpenPathGeomerty}"/>
                </MenuItem.Icon>
            </MenuItem>

            <MenuItem Template="{StaticResource MenuItemTemplate1}"
                      Command="{Binding Path=SaveFileCommand}"
                      CommandParameter="{Binding Path=SelectedFile}">

                <MenuItem.Header>
                    <MultiBinding Converter="{StaticResource StringFormatMultiConvert}" ConverterParameter="Сохранить {0} (Ctrl+S)">
                        <Binding Path="SelectedFile.Name" Mode="OneWay"/>
                    </MultiBinding>
                </MenuItem.Header>

                <MenuItem.Icon>
                    <Path Fill="{StaticResource IconSaveBrush}"
                          Data="{StaticResource SavePathGeomerty}"/>
                </MenuItem.Icon>
            </MenuItem>

            <MenuItem Header="Сохранить все"
                      Template="{StaticResource MenuItemTemplate1}"
                      Command="{Binding Path=SaveAllFilesCommand}"
                      CommandParameter="{Binding Path=OpenedFiles, Source={x:Static Application.Current}}">
                <MenuItem.Icon>
                    <Path Fill="{StaticResource IconSaveAsBrush}"
                          Data="{StaticResource SaveAsPathGeomerty}"/>
                </MenuItem.Icon>
            </MenuItem>

            <MenuItem Template="{StaticResource SeparatorTemplate}"/>

            <MenuItem Header="Отменить (Ctrl+Z)"
                      Template="{StaticResource MenuItemTemplate1}" 
                      Command="{Binding Path=UndoCommand}">
                
                <MenuItem.Icon>
                    <Path Fill="{StaticResource IconBackBrush}"
                          Data="{StaticResource BackPathGeomerty}"/>
                </MenuItem.Icon>
            </MenuItem>

            <MenuItem Header="Вернуть (Ctrl+V)"
                      Template="{StaticResource MenuItemTemplate1}"
                      Command="{Binding Path=RedoCommand}">
                
                <MenuItem.Icon>
                    <Path Fill="{StaticResource IconReturnBrush}"
                          Data="{StaticResource ReturnPathGeomerty}"/>
                </MenuItem.Icon>
            </MenuItem>

            <MenuItem Template="{StaticResource SeparatorTemplate}"/>

            <MenuItem Style="{StaticResource MenuItemDetalNull}">
                <MenuItem.Template>
                    <ControlTemplate TargetType="{x:Type MenuItem}">
                        <ComboBox VerticalContentAlignment="Center" HorizontalContentAlignment="Center"
                                  FontSize="{StaticResource FontSizeNP4}" Width="Auto" MinWidth="200" Margin="4"
                                  ItemsSource="{Binding Path=RobotNamesCollection, Mode=OneWay}"
                                  SelectedItem="{Binding Path=SelectedRobotsName, Mode=TwoWay}"
                                  SelectedIndex="0">

                            <ComboBox.Style>
                                <Style TargetType="{x:Type ComboBox}" BasedOn="{StaticResource cbBase}">
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding Path=RobotsCollection.Count}" Value="0">
                                            <Setter Property="IsEnabled" Value="False"/>
                                            <Setter Property="IsEditable" Value="True"/>
                                            <Setter Property="Text" Value="Нет введёных роботов"/>
                                        </DataTrigger>

                                        <DataTrigger Binding="{Binding Path=SelectedNameRobot}" Value="{x:Null}">
                                            <Setter Property="SelectedIndex" Value="0"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </ComboBox.Style>
                        </ComboBox>
                    </ControlTemplate>
                </MenuItem.Template>
            </MenuItem>

            <MenuItem Template="{StaticResource MenuItemTemplate2}" Header="Генерировать"
                      Style="{StaticResource MenuItemDetalNull}" Margin="10,2">
                
                <MenuItem.Icon>
                    <Path Fill="{StaticResource IconGenerateBrush}"
                          Data="{StaticResource GeneratePathGeomerty}"/>
                </MenuItem.Icon>

                <i:Interaction.Triggers>
                    <i:EventTrigger EventName="Click">
                        <i:InvokeCommandAction Command="{Binding Path=LostFocusCommand}"
                                               CommandParameter="{Binding Path=., RelativeSource={RelativeSource AncestorType={x:Type Page}, Mode=FindAncestor}}"/>
                        <i:InvokeCommandAction Command="{Binding Path=GenerateProgramCommandAsync}"/>
                    </i:EventTrigger>
                </i:Interaction.Triggers>
            </MenuItem>

            <MenuItem Header="Параметры по-умолчанию (Ctrl+Shift+S)"
                      Command="{Binding Path=StandartParametrsCommand}"
                      CommandParameter="{Binding Path=SelectedFile}"
                      Template="{StaticResource MenuItemTemplate1}"
                      Style="{StaticResource MenuItemDetalNull}">
                
                <MenuItem.Icon>
                    <Path Fill="{StaticResource IconCleanBrush}"
                          RenderTransformOrigin="0.5,0.5"
                          Data="{StaticResource CleanPathGeomerty}">

                        <Path.LayoutTransform>
                            <ScaleTransform ScaleX="1.75" ScaleY="1.75"/>
                        </Path.LayoutTransform>
                    </Path>
                </MenuItem.Icon>
            </MenuItem>

            <MenuItem Template="{StaticResource SeparatorTemplate}"/>

            <MenuItem Header="Отдалить камеру (-)"
                      Template="{StaticResource MenuItemTemplate1}"
                      Command="{Binding Path=ZoomCommand}">

                <MenuItem.CommandParameter>
                    <sys:Double>1</sys:Double>
                </MenuItem.CommandParameter>

                <MenuItem.Icon>
                    <Path Fill="{StaticResource IconDecreaseBrush}"
                          Data="{StaticResource DecreasePathGeomerty}"/>
                </MenuItem.Icon>
            </MenuItem>

            <MenuItem Header="Приблизить камеру (+)"
                      Template="{StaticResource MenuItemTemplate1}" 
                      Command="{Binding Path=ZoomCommand}">

                <MenuItem.CommandParameter>
                    <sys:Double>-50</sys:Double>
                </MenuItem.CommandParameter>

                <MenuItem.Icon>
                    <Path Fill="{StaticResource IconIncreaseBrush}"
                          Data="{StaticResource IncreasePathGeomerty}"/>
                </MenuItem.Icon>
            </MenuItem>

            <MenuItem Template="{StaticResource SeparatorTemplate}"/>

            <MenuItem ToolTip="Вкл/выкл. оси координат">
                <MenuItem.Template>
                    <ControlTemplate TargetType="{x:Type MenuItem}">
                        <ToggleButton IsChecked="{Binding Path=Settings.ShowCoordinateSystem, Source={x:Static Application.Current}, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}">
                            <Path Fill="{StaticResource IconAxistBrush}" Stretch="Uniform"
                                  Data="{StaticResource AxistPathGeomerty}"/>
                        </ToggleButton>
                    </ControlTemplate>
                </MenuItem.Template>
            </MenuItem>

            <MenuItem ToolTip="Вкл/выкл. сетку">
                <MenuItem.Template>
                    <ControlTemplate TargetType="{x:Type MenuItem}">
                        <ToggleButton IsChecked="{Binding Path=IsVisibleGridLinesVisual3D, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}">
                            <Path Stroke="{StaticResource IconAxistBrush}" 
                                  Data="{StaticResource PerspectiveGridGeomerty}"
                                  Stretch="Uniform"/>
                        </ToggleButton>
                    </ControlTemplate>
                </MenuItem.Template>
            </MenuItem>

            <MenuItem Template="{StaticResource MenuItemTemplate1}" Header="Вкл/выкл. отображение плоскостей">
                <MenuItem.Icon>
                    <Image Source="/InterfaceOfRobots;component/Themes/Images/isometric_view.png" Height="24" Width="24" Stretch="Uniform"/>
                </MenuItem.Icon>
            </MenuItem>

            <MenuItem Header="Вид сверху (Ctrl+U)"
                      Template="{StaticResource MenuItemTemplate1}"
                      Command="{x:Static h:CameraController.TopViewCommand}">

                <MenuItem.Icon>
                    <Image Source="/InterfaceOfRobots;component/Themes/Images/top_view.png" Height="24" Width="24" Stretch="Uniform"/>
                </MenuItem.Icon>
            </MenuItem>

            <MenuItem Header="Вид снизу (Ctrl+D)"
                      Template="{StaticResource MenuItemTemplate1}"
                      Command="{x:Static h:CameraController.BottomViewCommand}">

                <MenuItem.Icon>
                    <Image Source="/InterfaceOfRobots;component/Themes/Images/bottom_view.png" Height="24" Width="24" Stretch="Uniform"/>
                </MenuItem.Icon>
            </MenuItem>

            <MenuItem Header="Вид спереди (Ctrl+F)"
                      Template="{StaticResource MenuItemTemplate1}"
                      Command="{x:Static h:CameraController.FrontViewCommand}">

                <MenuItem.Icon>
                    <Image Source="/InterfaceOfRobots;component/Themes/Images/front_view.png" Height="24" Width="24" Stretch="Uniform"/>
                </MenuItem.Icon>
            </MenuItem>

            <MenuItem Header="Вид сзади (Ctrl+B)"
                      Template="{StaticResource MenuItemTemplate1}"
                      Command="{x:Static h:CameraController.BackViewCommand}">

                <MenuItem.Icon>
                    <Image Source="/InterfaceOfRobots;component/Themes/Images/back_view.png" Height="24" Width="24" Stretch="Uniform"/>
                </MenuItem.Icon>
            </MenuItem>

            <MenuItem Header="Вид с левого бока (Ctrl+L)"
                      Template="{StaticResource MenuItemTemplate1}"
                      Command="{x:Static h:CameraController.LeftViewCommand}">

                <MenuItem.Icon>
                    <Image Source="/InterfaceOfRobots;component/Themes/Images/left_side_view.png" Height="24" Width="24" Stretch="Uniform"/>
                </MenuItem.Icon>
            </MenuItem>

            <MenuItem Header="Вид с правого бока (Ctrl+R)"
                      Template="{StaticResource MenuItemTemplate1}"
                      Command="{x:Static h:CameraController.RightViewCommand}">

                <MenuItem.Icon>
                    <Image Source="/InterfaceOfRobots;component/Themes/Images/right_side_view.png" Height="24" Width="24" Stretch="Uniform"/>
                </MenuItem.Icon>
            </MenuItem>
        </Menu>

        <avalonDock:DockingManager Grid.Row="2" x:Name="DockingManeger" Padding="0,10,0,0"
                                   FontSize="{StaticResource FontSizeNP2}"
                                   Theme="{Binding Path=Settings.SelectedTheme.Item2, Source={x:Static Application.Current}, Mode=OneWay}"
                                   DataContext="{Binding Path=DataContext, RelativeSource={RelativeSource AncestorType={x:Type Page}, Mode=FindAncestor}}"
                                   DocumentsSource="{Binding Path=OpenedFiles, Source={x:Static Application.Current}, Mode=TwoWay}"
                                   ActiveContent="{Binding Path=ActiveContent, Mode=TwoWay}"  
                                   AutoWindowSizeWhenOpened="True"
                                   AllowMixedOrientation="True"
                                   IsVirtualizingAnchorable="True"
                                   IsVirtualizingDocument="True">

            <avalonDock:DockingManager.DocumentPaneMenuItemHeaderTemplate>
                <DataTemplate>
                    <Grid>
                        <TextBlock Text="{Binding Path=Content.Name}" TextTrimming="CharacterEllipsis"/>
                    </Grid>
                </DataTemplate>
            </avalonDock:DockingManager.DocumentPaneMenuItemHeaderTemplate>

            <DockingManager.DocumentHeaderTemplate>
                <DataTemplate>
                    <Grid ToolTip="{Binding Content.Path}">
                        <TextBlock Text="{Binding Path=Content.Name}"/>
                    </Grid>
                </DataTemplate>
            </DockingManager.DocumentHeaderTemplate>

            <DockingManager.LayoutItemTemplateSelector>
                <control:PanesTemplateSelector>
                    <control:PanesTemplateSelector.FileViewTemplate>
                        <DataTemplate>
                            <h:HelixViewport3D PreviewMouseDown="UIElement_OnMouseDown"
                                               Background="{h:LinearGradientBrush Gray, White}"
                                               CoordinateSystemHorizontalPosition="Right" CoordinateSystemVerticalPosition="Top"
                                               
                                               ShowCoordinateSystem="{Binding Path=Settings.ShowCoordinateSystem, Source={x:Static Application.Current}, Mode=OneWay}"
                                               ShowViewCube="{Binding Path=Settings.ShowViewCube, Source={x:Static Application.Current}, Mode=OneWay}"
                                               ShowTriangleCountInfo="{Binding Path=Settings.ShowTriangleCountInfo, Source={x:Static Application.Current}, Mode=OneWay}"
                                               ShowFieldOfView="{Binding Path=Settings.ShowFieldOfView, Source={x:Static Application.Current}, Mode=OneWay}"
                                               ShowFrameRate="{Binding Path=Settings.ShowFrameRate, Source={x:Static Application.Current}, Mode=OneWay}"
                                               
                                               Orthographic="{Binding Path=Settings.Orthographic, Source={x:Static Application.Current}, Mode=OneWay}"
                                               ShowCameraInfo="{Binding Path=Settings.ShowCameraInfo, Source={x:Static Application.Current}, Mode=OneWay}"
                                               ShowCameraTarget="{Binding Path=Settings.ShowCameraTarget, Source={x:Static Application.Current}, Mode=OneWay}"
                                               RotateAroundMouseDownPoint="{Binding Path=Settings.RotateAroundMouseDownPoint, Source={x:Static Application.Current}, Mode=OneWay}"
                                               ZoomAroundMouseDownPoint="{Binding Path=Settings.ZoomAroundMouseDownPoint, Source={x:Static Application.Current}, Mode=OneWay}"
                                               IsInertiaEnabled="{Binding Path=Settings.IsInertiaEnabled, Source={x:Static Application.Current}, Mode=OneWay}"
                                               IsPanEnabled="{Binding Path=Settings.IsPanEnabled, Source={x:Static Application.Current}, Mode=OneWay}"
                                               IsMoveEnabled="{Binding Path=Settings.IsMoveEnabled, Source={x:Static Application.Current}, Mode=OneWay}"
                                               IsRotationEnabled="{Binding Path=Settings.IsRotationEnabled, Source={x:Static Application.Current}, Mode=OneWay}"
                                               IsZoomEnabled="{Binding Path=Settings.IsZoomEnabled, Source={x:Static Application.Current}, Mode=OneWay}"
                                               IsChangeFieldOfViewEnabled="{Binding Path=Settings.IsChangeFieldOfViewEnabled, Source={x:Static Application.Current}, Mode=OneWay}"
                                               RotationSensitivity="{Binding Path=Settings.RotationSensitivity, Source={x:Static Application.Current}, Mode=OneWay}"
                                               ZoomSensitivity="{Binding Path=Settings.ZoomSensitivity, Source={x:Static Application.Current}, Mode=OneWay}"
                                               CameraInertiaFactor="{Binding Path=Settings.CameraInertiaFactor, Source={x:Static Application.Current}, Mode=OneWay}"
                                               PageUpDownZoomSensitivity="5"
                                               MinimumFieldOfView="10.0" MaximumFieldOfView="120.0">

                                <h:HelixViewport3D.DefaultCamera>
                                    <!--<PerspectiveCamera x:Name="CameraControler" 
                                                       Position="0,0,100"
                                                       LookDirection="0,0,-1"
                                                       UpDirection="0,1,0"
                                                       FieldOfView="45"
                                                       NearPlaneDistance="0.001"/>-->

                                    <!--<PerspectiveCamera x:Name="CameraControler" 
                                                       Position="100,100,100"
                                                       LookDirection="-100,-100,-100"
                                                       UpDirection="0,0,1"
                                                       FieldOfView="10"
                                                       NearPlaneDistance="0.001"/>-->

                                    <PerspectiveCamera x:Name="CameraControler" 
                                                       Position="-354, 3, 381"
                                                       LookDirection="351,-3,-383"
                                                       UpDirection="0.7, 0, 0.7"
                                                       FieldOfView="10"
                                                       NearPlaneDistance="0.001"/>

                                    <!--<PerspectiveCamera x:Name="CameraControler" Position="290,-2,208"
                                                       LookDirection="-220,2,-155"
                                                       UpDirection="0,0,1"
                                                       FieldOfView="10"
                                                       NearPlaneDistance="0.001"/>-->
                                </h:HelixViewport3D.DefaultCamera>

                                <h:HelixViewport3D.InputBindings>
                                    <KeyBinding Key="B" Command="{x:Static h:CameraController.BackViewCommand}"/>
                                    <KeyBinding Key="F" Command="{x:Static h:CameraController.FrontViewCommand}"/>
                                    <KeyBinding Key="U" Command="{x:Static h:CameraController.TopViewCommand}"/>
                                    <KeyBinding Key="D" Command="{x:Static h:CameraController.BottomViewCommand}"/>
                                    <KeyBinding Key="L" Command="{x:Static h:CameraController.LeftViewCommand}"/>
                                    <KeyBinding Key="R" Command="{x:Static h:CameraController.RightViewCommand}"/>

                                    <MouseBinding Command="{x:Static h:CameraController.RotateCommand}"  Gesture="RightClick" />
                                    <MouseBinding Command="{x:Static h:CameraController.ZoomCommand}" Gesture="MiddleClick" />
                                    <MouseBinding Command="{x:Static h:CameraController.ZoomExtentsCommand}" Gesture="MiddleDoubleClick" />
                                    <MouseBinding Command="{x:Static h:CameraController.PanCommand}" Gesture="LeftClick" />
                                </h:HelixViewport3D.InputBindings>

                                <!--<h:SunLight/>-->
                                <h:DefaultLights/>
                                <!-- Дополнительный источник света -->
                                <!--<ModelVisual3D>
                                    <ModelVisual3D.Content>
                                        <Model3DGroup>
                                            <DirectionalLight Color="White" Direction="-1,-1, -1" />
                                        </Model3DGroup>
                                    </ModelVisual3D.Content>
                                </ModelVisual3D>-->

                                <h:GridLinesVisual3D Visible="{Binding Path=DataContext.IsVisibleGridLinesVisual3D, Mode=OneWay, RelativeSource={RelativeSource AncestorType={x:Type Page}, Mode=FindAncestor}}"/>

                                <ModelVisual3D Content="{Binding Path=CurrentModel, Mode=OneWay, UpdateSourceTrigger=PropertyChanged}"/>

                                <h:CoordinateSystemVisual3D ArrowLengths="3"/>

                                <h:BoundingBoxVisual3D BoundingBox="{Binding Path=DataContext.SelectedObject, Converter={StaticResource BoundsConvert}, Mode=TwoWay, RelativeSource={RelativeSource AncestorType={x:Type Page}, Mode=FindAncestor}}"
                                                       Diameter="0.1"/>

                                <i:Interaction.Behaviors>
                                    <behavior:ZoomBehavior/>
                                    <behavior:HelixWeldsBehavior Welds="{Binding Path=WeldsCollection}"/>
                                    <!--<behavior:HelixAnnotationsBehavior Annotations="{Binding Path=Annotations}"/>-->
                                    <behavior:HelixSceneTrackerBehavior SceneItems="{Binding Path=DataContext.SceneItemsCollection, Mode=OneWayToSource, UpdateSourceTrigger=PropertyChanged, RelativeSource={RelativeSource AncestorType={x:Type Page}, Mode=FindAncestor}}"/>
                                </i:Interaction.Behaviors>
                            </h:HelixViewport3D>
                        </DataTemplate>
                    </control:PanesTemplateSelector.FileViewTemplate>
                </control:PanesTemplateSelector>
            </DockingManager.LayoutItemTemplateSelector>

            <avalonDock:LayoutRoot>
                <avalonDock:LayoutPanel Orientation="Horizontal">
                    <avalonDock:LayoutPanel Orientation="Vertical">
                        <avalonDock:LayoutDocumentPaneGroup>
                            <avalonDock:LayoutDocumentPane></avalonDock:LayoutDocumentPane>
                        </avalonDock:LayoutDocumentPaneGroup>
                        
                        <avalonDock:LayoutAnchorablePaneGroup>
                            <avalonDock:LayoutAnchorablePane>
                                <avalonDock:LayoutAnchorable Title="Сообщения" ContentId="Messages">
                                    <DataGrid ItemsSource="{Binding Path=MessagesCollection, Mode=OneWay}"
                                              SelectionMode="Single"
                                              AutoGenerateColumns="False"
                                              EnableRowVirtualization="False"
                                              CanUserAddRows="False"
                                              CanUserSortColumns="False"
                                              ScrollViewer.CanContentScroll="True"
                                              ScrollViewer.HorizontalScrollBarVisibility="Auto"
                                              ScrollViewer.VerticalScrollBarVisibility="Auto"
                                              lib:ScrollViewerAttachedPropertiesDataGrid.ScrollOnLoadingRow="True">

                                        <DataGrid.Resources>
                                            <Style x:Key="dgCellBase" TargetType="{x:Type DataGridCell}">
                                                <Setter Property="IsEnabled" Value="False"/>
                                                <Setter Property="Focusable" Value="False"/>
                                                <Setter Property="Foreground" Value="Black"/>
                                                <Setter Property="TextBlock.TextAlignment" Value="Center"/>
                                                <Setter Property="Template">
                                                    <Setter.Value>
                                                        <ControlTemplate TargetType="{x:Type DataGridCell}">
                                                            <Grid Background="{TemplateBinding Background}">
                                                                <ContentPresenter VerticalAlignment="Center" Margin="15,0"/>
                                                            </Grid>
                                                        </ControlTemplate>
                                                    </Setter.Value>
                                                </Setter>

                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding LogLevel}" Value="Error">
                                                        <Setter Property="Foreground" Value="Red"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>

                                            <Style TargetType="{x:Type DataGridCell}" BasedOn="{StaticResource dgCellBase}"></Style>

                                            <Style x:Key="dgCellLeft" TargetType="{x:Type DataGridCell}" BasedOn="{StaticResource dgCellBase}">
                                                <Setter Property="TextBlock.TextAlignment" Value="Left"/>
                                            </Style>

                                            <Style TargetType="{x:Type DataGridColumnHeader}">
                                                <Setter Property="HorizontalContentAlignment" Value="Center"/>
                                            </Style>

                                            <Style TargetType="{x:Type DataGridRowHeader}">
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding Path=Item.Ditails, RelativeSource={RelativeSource AncestorType={x:Type DataGridRow}}}" Value="">
                                                        <Setter Property="IsEnabled" Value="False"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </DataGrid.Resources>

                                        <DataGrid.RowHeaderTemplate>
                                            <DataTemplate>
                                                <Expander Expanded="Expander_Expanded"  Collapsed="Expander_Collapsed">
                                                    <Expander.Style>
                                                        <Style TargetType="{x:Type Expander}">
                                                            <Style.Triggers>
                                                                <DataTrigger Binding="{Binding Path=Item.Ditails, RelativeSource={RelativeSource AncestorType={x:Type DataGridRow}}}" Value="">
                                                                    <Setter Property="Visibility" Value="Hidden"/>
                                                                </DataTrigger>
                                                            </Style.Triggers>
                                                        </Style>
                                                    </Expander.Style>
                                                </Expander>
                                            </DataTemplate>
                                        </DataGrid.RowHeaderTemplate>

                                        <DataGrid.Columns>
                                            <DataGridTextColumn Header="Время" Binding="{Binding Time, StringFormat=\{0:HH:mm:ss\}}" Width="Auto"/>
                                            <DataGridTextColumn Header="Сообщение" Binding="{Binding Message}" Width="*" CellStyle="{StaticResource dgCellLeft}"/>
                                        </DataGrid.Columns>

                                        <DataGrid.RowDetailsTemplate>
                                            <DataTemplate>
                                                <TextBlock Text="{Binding Ditails}" Focusable="False" IsEnabled="False" Padding="5,10"/>
                                            </DataTemplate>
                                        </DataGrid.RowDetailsTemplate>

                                        <!--<i:Interaction.Behaviors>
                                            <behavior:DataGridStretchLastColumn/>
                                        </i:Interaction.Behaviors>-->
                                    </DataGrid>
                                </avalonDock:LayoutAnchorable>
                            </avalonDock:LayoutAnchorablePane>
                        </avalonDock:LayoutAnchorablePaneGroup>
                    </avalonDock:LayoutPanel>

                    <avalonDock:LayoutPanel Orientation="Vertical">
                        <avalonDock:LayoutAnchorablePaneGroup>
                            <avalonDock:LayoutAnchorablePane>
                                <avalonDock:LayoutAnchorable Title="Состав" ContentId="Components">
                                    <TreeView FontSize="{StaticResource FontSizeNP2}"
                                              Style="{StaticResource TextBase}"
                                              ItemsSource="{Binding Path=SceneItemsCollection, Mode=OneWay}">
                                     
                                        <TreeView.Resources>
                                            <HierarchicalDataTemplate DataType="{x:Type file:SceneItem}"
                                                                      ItemsSource="{Binding Path=Children, Mode=OneWay, NotifyOnSourceUpdated=True}">
                                              
                                                <StackPanel Orientation="Horizontal">
                                                    <!--<ToggleButton IsChecked="{Binding IsVisible, Mode=TwoWay, TargetNullValue={StaticResource True}}">
                                                        <ToggleButton.Template>
                                                            <ControlTemplate TargetType="{x:Type ToggleButton}">
                                                                
                                                            </ControlTemplate>
                                                        </ToggleButton.Template>
                                                    </ToggleButton>-->
                                                    
                                                    <CheckBox IsChecked="{Binding IsVisible, Mode=TwoWay}" VerticalAlignment="Center" Margin="0,0,5,0"/>                                    
                                                    <TextBlock Text="{Binding Name}"/>
                                                </StackPanel>
                                            </HierarchicalDataTemplate>
                                        </TreeView.Resources>

                                    </TreeView>
                                    
                                    <!--<ContentControl ContentTemplate="{StaticResource OtherTemplateStyle}"/>-->
                                </avalonDock:LayoutAnchorable>
                            </avalonDock:LayoutAnchorablePane>
                        </avalonDock:LayoutAnchorablePaneGroup>

                        <avalonDock:LayoutAnchorablePaneGroup>
                            <avalonDock:LayoutAnchorablePane>
                                <avalonDock:LayoutAnchorable Title="Свойства" ContentId="Properties">
                                    <!--<pt:PropertyGrid SelectedObject="{Binding Path=DataContext.SelectedObject, 
                                                                              RelativeSource={RelativeSource AncestorType={x:Type Page}, Mode=FindAncestor},
                                                                              UpdateSourceTrigger=PropertyChanged, Mode=OneWay}"
                                                     TabVisibility="Collapsed"
                                                    
                                                     Margin="4"/>-->
                                    <ContentControl ContentTemplate="{StaticResource OtherTemplateStyle}"/>
                                </avalonDock:LayoutAnchorable>

                                <avalonDock:LayoutAnchorable Title="Параметры детали" ContentId="ParametrsOfDetal">
                                    <TreeView FontSize="{StaticResource FontSizeNP2}" BorderBrush="Transparent"
                                              VerticalContentAlignment="Top" HorizontalContentAlignment="Stretch"
                                              VerticalAlignment="Stretch" HorizontalAlignment="Stretch">
                                        
                                        <TreeView.Style>
                                            <Style TargetType="{x:Type TreeView}">
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding Path=SelectedFile.Detal}" Value="{x:Null}">
                                                        <Setter Property="Visibility" Value="Hidden"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </TreeView.Style>

                                        <TreeView.Resources>
                                            <!--<SolidColorBrush x:Key="TreeViewItem.TreeArrow.Static.Background" Color="#B8B8B8"/>-->
                                            <SolidColorBrush x:Key="TreeViewItem.TreeArrow.Static.Checked.Fill" Color="#304cff"/>
                                            <SolidColorBrush x:Key="TreeViewItem.TreeArrow.Static.Checked.Stroke" Color="#001ccf"/>
                                            <SolidColorBrush x:Key="TreeViewItem.TreeArrow.MouseOver.Stroke" Color="#42fcff"/>
                                            <SolidColorBrush x:Key="TreeViewItem.TreeArrow.MouseOver.Fill" Color="#FFCCEEFB"/>
                                            <SolidColorBrush x:Key="TreeViewItem.TreeArrow.MouseOver.Checked.Stroke" Color="#FF1CC4F7"/>
                                            <SolidColorBrush x:Key="TreeViewItem.TreeArrow.MouseOver.Checked.Fill" Color="#FF82DFFB"/>
                                            <PathGeometry x:Key="TreeArrow" Figures="M0,0 L0,6 L6,0 z"/>
                                            <SolidColorBrush x:Key="TreeViewItem.TreeArrow.Static.Fill" Color="#FFFFFFFF"/>
                                            <SolidColorBrush x:Key="TreeViewItem.TreeArrow.Static.Stroke" Color="#FF818181"/>

                                            <Style TargetType="{x:Type TreeViewItem}">
                                                <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
                                                <Setter Property="Focusable" Value="False"/>
                                                <Setter Property="Margin" Value="5"/>

                                                <Setter Property="Template">
                                                    <Setter.Value>
                                                        <ControlTemplate TargetType="{x:Type TreeViewItem}">
                                                            <Grid>
                                                                <Grid.ColumnDefinitions>
                                                                    <ColumnDefinition MinWidth="19" Width="Auto"/>
                                                                    <ColumnDefinition Width="*"/>
                                                                </Grid.ColumnDefinitions>
                                                                <Grid.RowDefinitions>
                                                                    <RowDefinition Height="Auto"/>
                                                                    <RowDefinition/>
                                                                </Grid.RowDefinitions>

                                                                <ToggleButton x:Name="Expander" ClickMode="Press" IsChecked="{Binding IsExpanded, RelativeSource={RelativeSource TemplatedParent}}"
                                                                              Style="{DynamicResource ExpandCollapseToggleStyle}"/>

                                                                <Border x:Name="Bd" Grid.Column="1" BorderBrush="{TemplateBinding BorderBrush}" BorderThickness="{TemplateBinding BorderThickness}" Background="{TemplateBinding Background}" Padding="{TemplateBinding Padding}" SnapsToDevicePixels="true">
                                                                    <ContentPresenter x:Name="PART_Header" ContentSource="Header" HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}" SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}"/>
                                                                </Border>

                                                                <ItemsPresenter x:Name="ItemsHost" Grid.Row="1" Grid.Column="1" />
                                                            </Grid>

                                                            <ControlTemplate.Triggers>
                                                                <Trigger Property="IsExpanded" Value="false">
                                                                    <Setter TargetName="ItemsHost" Property="Visibility" Value="Collapsed"/>
                                                                </Trigger>
                                                                <Trigger Property="HasItems" Value="false">
                                                                    <Setter Property="Visibility" TargetName="Expander" Value="Hidden"/>
                                                                </Trigger>
                                                                <Trigger Property="IsSelected" Value="true">
                                                                    <Setter Property="Background" TargetName="Bd" Value="{DynamicResource {x:Static SystemColors.HighlightBrushKey}}"/>
                                                                    <Setter Property="Foreground" Value="{DynamicResource {x:Static SystemColors.HighlightTextBrushKey}}"/>
                                                                </Trigger>
                                                                <MultiTrigger>
                                                                    <MultiTrigger.Conditions>
                                                                        <Condition Property="IsSelected" Value="true"/>
                                                                        <Condition Property="IsSelectionActive" Value="false"/>
                                                                    </MultiTrigger.Conditions>
                                                                    <Setter Property="Background" TargetName="Bd" Value="{DynamicResource {x:Static SystemColors.InactiveSelectionHighlightBrushKey}}"/>
                                                                    <Setter Property="Foreground" Value="{DynamicResource {x:Static SystemColors.InactiveSelectionHighlightTextBrushKey}}"/>
                                                                </MultiTrigger>
                                                                <Trigger Property="IsEnabled" Value="false">
                                                                    <Setter Property="Foreground" Value="{DynamicResource {x:Static SystemColors.GrayTextBrushKey}}"/>
                                                                </Trigger>
                                                            </ControlTemplate.Triggers>
                                                        </ControlTemplate>
                                                    </Setter.Value>
                                                </Setter>
                                            </Style>

                                            <Style x:Key="ExpandCollapseToggleStyle" TargetType="{x:Type ToggleButton}">
                                                <Setter Property="Focusable" Value="False"/>
                                                <Setter Property="Template">
                                                    <Setter.Value>
                                                        <ControlTemplate TargetType="{x:Type ToggleButton}">
                                                            <Border Background="Transparent" Height="25" Width="25" Padding="5">
                                                                <Path x:Name="ExpandPath" Data="{StaticResource TreeArrow}" Fill="{StaticResource TreeViewItem.TreeArrow.Static.Fill}" Stroke="{StaticResource TreeViewItem.TreeArrow.Static.Stroke}">
                                                                    <Path.RenderTransform>
                                                                        <RotateTransform Angle="135" CenterY="3" CenterX="3"/>
                                                                    </Path.RenderTransform>
                                                                </Path>
                                                            </Border>
                                                            
                                                            <ControlTemplate.Triggers>
                                                                <Trigger Property="IsChecked" Value="True">
                                                                    <Setter Property="RenderTransform" TargetName="ExpandPath">
                                                                        <Setter.Value>
                                                                            <RotateTransform Angle="180" CenterY="3" CenterX="3"/>
                                                                        </Setter.Value>
                                                                    </Setter>
                                                                    <Setter Property="Fill" TargetName="ExpandPath" Value="{StaticResource TreeViewItem.TreeArrow.Static.Checked.Fill}"/>
                                                                    <Setter Property="Stroke" TargetName="ExpandPath" Value="{StaticResource TreeViewItem.TreeArrow.Static.Checked.Stroke}"/>
                                                                </Trigger>
                                                                <Trigger Property="IsMouseOver" Value="True">
                                                                    <Setter Property="Stroke" TargetName="ExpandPath" Value="{StaticResource TreeViewItem.TreeArrow.MouseOver.Stroke}"/>
                                                                    <Setter Property="Fill" TargetName="ExpandPath" Value="{StaticResource TreeViewItem.TreeArrow.MouseOver.Fill}"/>
                                                                </Trigger>
                                                                <MultiTrigger>
                                                                    <MultiTrigger.Conditions>
                                                                        <Condition Property="IsMouseOver" Value="True"/>
                                                                        <Condition Property="IsChecked" Value="True"/>
                                                                    </MultiTrigger.Conditions>
                                                                    <Setter Property="Stroke" TargetName="ExpandPath" Value="{StaticResource TreeViewItem.TreeArrow.MouseOver.Checked.Stroke}"/>
                                                                    <Setter Property="Fill" TargetName="ExpandPath" Value="{StaticResource TreeViewItem.TreeArrow.MouseOver.Checked.Fill}"/>
                                                                </MultiTrigger>
                                                            </ControlTemplate.Triggers>
                                                        </ControlTemplate>
                                                    </Setter.Value>
                                                </Setter>
                                            </Style>

                                            <Style TargetType="{x:Type ContentControl}">
                                                <Setter Property="Margin" Value="-25,0,5,5"/>
                                            </Style>
                                        </TreeView.Resources>

                                        <TreeViewItem Header="Общие">
                                            <ContentControl ContentTemplate="{StaticResource PlitaTemplate3Style}"/>
                                        </TreeViewItem>

                                        <TreeViewItem Header="Доп.">
                                            <ContentControl ContentTemplate="{StaticResource PlitaDopTemplate3Style}"/>
                                        </TreeViewItem>

                                        <TreeViewItem Header="Сварка" HorizontalContentAlignment="Stretch">
                                            <ContentControl ContentTemplate="{StaticResource PlitaSvarkaTemplate3Style}"/>
                                        </TreeViewItem>

                                        <i:Interaction.Behaviors>
                                            <lib:TreeViewSelectedItemBehavior ExpandSelected="True"
                                                                              HierarchyPredicate="{Binding HierarchyPredicate}"
                                                                              SelectedItem="{Binding Path=SelectedItem, Mode=TwoWay}"/>
                                        </i:Interaction.Behaviors>
                                    </TreeView>
                                </avalonDock:LayoutAnchorable>
                            </avalonDock:LayoutAnchorablePane>
                        </avalonDock:LayoutAnchorablePaneGroup>
                    </avalonDock:LayoutPanel>
                </avalonDock:LayoutPanel>

                <avalonDock:LayoutRoot.RightSide>
                    <avalonDock:LayoutAnchorSide>
                        <avalonDock:LayoutAnchorGroup>
                            <avalonDock:LayoutAnchorable Title="Роботы" ContentId="Robots" AutoHideMinWidth="400">
                                <Grid Margin="10"
                                      DataContext="{Binding Path=DataContext, RelativeSource={RelativeSource AncestorType={x:Type Page}, Mode=FindAncestor}}">

                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="10"/>
                                        <RowDefinition Height="*"/>
                                    </Grid.RowDefinitions>

                                    <Grid.Resources>
                                        <Style TargetType="{x:Type ComboBox}" BasedOn="{StaticResource cbBase}"></Style>

                                        <Style x:Key="buttonBaseStyle" TargetType="{x:Type Button}">
                                            <Setter Property="Height" Value="40"/>
                                            <Setter Property="Width" Value="{Binding Path=ActualHeight, RelativeSource={RelativeSource Self}}"/>
                                            <Setter Property="Template">
                                                <Setter.Value>
                                                    <ControlTemplate TargetType="{x:Type Button}">
                                                        <Border Name="Panel" BorderThickness="1" BorderBrush="{DynamicResource NotActiveBorderBrush}" Background="Transparent">
                                                            <ContentPresenter x:Name="Content" VerticalAlignment="Center" HorizontalAlignment="Center" ContentSource="Content" Margin="3"/>
                                                        </Border>

                                                        <ControlTemplate.Triggers>
                                                            <Trigger Property="IsMouseOver" Value="True">
                                                                <Setter TargetName="Panel" Property="Background" Value="{DynamicResource ActiveBackround}"/>
                                                                <Setter TargetName="Panel" Property="BorderBrush" Value="{DynamicResource {x:Static SystemColors.HighlightBrushKey}}"/>
                                                            </Trigger>

                                                            <Trigger Property="IsPressed" Value="True">
                                                                <Setter TargetName="Panel" Property="Background" Value="{DynamicResource ActiveBackround}"/>
                                                                <Setter TargetName="Panel" Property="BorderBrush" Value="{DynamicResource {x:Static SystemColors.HighlightBrushKey}}"/>
                                                            </Trigger>
                                                        </ControlTemplate.Triggers>
                                                    </ControlTemplate>
                                                </Setter.Value>
                                            </Setter>
                                        </Style>

                                        <Style TargetType="{x:Type Button}" BasedOn="{StaticResource buttonBaseStyle}"></Style>

                                        <Style TargetType="{x:Type Grid}">
                                            <Setter Property="Margin" Value="0,0,0,10"/>
                                        </Style>

                                        <Style TargetType="{x:Type Path}">
                                            <Setter Property="Stretch" Value="Uniform"/>
                                        </Style>

                                        <Style TargetType="{x:Type TextBox}" BasedOn="{StaticResource TextBase}">
                                            <Setter Property="TextElement.FontSize" Value="{StaticResource FontSizeNP2}"/>
                                            <Setter Property="MinHeight" Value="35"/>
                                            <Setter Property="Padding" Value="5"/>
                                            <Setter Property="HorizontalContentAlignment" Value="Center"/>
                                            <Setter Property="VerticalContentAlignment" Value="Center"/>
                                        </Style>
                                    </Grid.Resources>

                                    <Grid Grid.Row="0">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>

                                        <Button Grid.Column="0" ToolTip="Удалить робота"
                                                Command="{Binding Path=DeleteRobotCommand}"
                                                CommandParameter="{Binding Path=SelectedRobot}">

                                            <Path Fill="{StaticResource IconDeleteBrush}"
                                                  Data="{StaticResource DeletePathGeomerty}"/>
                                        </Button>

                                        <ComboBox FontWeight="Bold" Grid.Column="1" Margin="5,0"
                                                  HorizontalContentAlignment="Center" VerticalContentAlignment="Center"
                                                  ItemsSource="{Binding Path=RobotsCollection, Mode=OneWay}"
                                                  SelectedItem="{Binding Path=SelectedRobot, Mode=TwoWay}"      
                                                  SelectedIndex="0">

                                            <ComboBox.ItemTemplate>
                                                <DataTemplate>
                                                    <TextBlock Text="{Binding Path=Name, Mode=OneWay}"/>
                                                </DataTemplate>
                                            </ComboBox.ItemTemplate>
                                        </ComboBox>

                                        <Button Grid.Column="2" ToolTip="Повторное соединение"
                                                Command="{Binding Path=ConnectedRobotCommand}"
                                                CommandParameter="{Binding Path=SelectedRobot}">

                                            <Button.Style>
                                                <Style TargetType="{x:Type Button}" BasedOn="{StaticResource buttonBaseStyle}">
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding Path=SelectedRobot.IsConnection}" Value="True">
                                                            <Setter Property="Height" Value="0"/>
                                                            <Setter Property="Visibility" Value="Hidden"/>
                                                            <Setter Property="Margin" Value="0"/>
                                                        </DataTrigger>

                                                        <DataTrigger Binding="{Binding Path=Visibility, RelativeSource={RelativeSource Self}}" Value="Visible">
                                                            <DataTrigger.EnterActions>
                                                                <BeginStoryboard Name="StartBlinking">
                                                                    <Storyboard>
                                                                        <DoubleAnimation Storyboard.TargetProperty="Opacity" From="0" To="1" RepeatBehavior="Forever" AutoReverse="True" Duration="0:0:1"/>
                                                                    </Storyboard>
                                                                </BeginStoryboard>
                                                            </DataTrigger.EnterActions>
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </Button.Style>

                                            <Path Fill="{StaticResource IconUpDateBrush}"
                                                  Data="{StaticResource UpDatePathGeomerty}"/>
                                        </Button>

                                        <Button Grid.Column="3" ToolTip="Закрыть соединение"
                                                Command="{Binding Path=DisconnectedRobotCommand}"
                                                CommandParameter="{Binding Path=SelectedRobot}">

                                            <Button.Style>
                                                <Style TargetType="{x:Type Button}" BasedOn="{StaticResource buttonBaseStyle}">
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding Path=SelectedRobot.IsConnection}" Value="False">
                                                            <Setter Property="Height" Value="0"/>
                                                            <Setter Property="Margin" Value="0"/>
                                                            <Setter Property="Visibility" Value="Hidden"/>
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </Button.Style>

                                            <Path Stroke="{StaticResource IconAddBrush}"
                                                  Data="{StaticResource DisconnectPathGeomerty}"
                                                  StrokeThickness="2.5"/>
                                        </Button>

                                        <Button Grid.Column="4" ToolTip="Добавить робота"
                                                Command="{Binding Path=AddRobotCommand}">

                                            <Path Data="{StaticResource AddRobotPathGeomerty}"
                                                  Stroke="{StaticResource IconAddBrush}" StrokeThickness="2"/>
                                        </Button>
                                    </Grid>

                                    <Grid Grid.Row="1">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="1.75*"/>
                                            <ColumnDefinition Width="5"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>

                                        <TextBox Grid.Column="0" Height="40" Text="{Binding Path=SelectedRobot.Host, Mode=TwoWay, FallbackValue='0.0.0.0', TargetNullValue='0.0.0.0', UpdateSourceTrigger=LostFocus}"/>
                                        <TextBox Grid.Column="2" Height="40" Text="{Binding Path=SelectedRobot.Port, Mode=TwoWay, FallbackValue=0000, TargetNullValue=0000, UpdateSourceTrigger=LostFocus}"/>
                                    </Grid>

                                    <Grid Grid.Row="2">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="5"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>

                                        <TextBox Grid.Column="0" Text="{Binding Path=SelectedRobot.PathProgramm, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>

                                        <Button Grid.Column="2" ToolTip="Изменить папку генерации"
                                                Command="{Binding Path=ChangePatnOnPCCommand}">

                                            <Path Fill="{StaticResource IconEditBrush}"
                                                  Data="{StaticResource EditPathGeomerty}">
                                                <Path.LayoutTransform>
                                                    <RotateTransform Angle="90"/>
                                                </Path.LayoutTransform>
                                            </Path>
                                        </Button>
                                    </Grid>

                                    <control:Breadcrumb Grid.Row="3" FontSize="{StaticResource FontSizeNP2}"
                                                        Robot="{Binding Path=SelectedRobot, Mode=TwoWay}"
                                                        Root="{x:Static client:JsonRpcConnection.DefaulRoot}"/>

                                    <control:NavigationTreeView Grid.Row="5" FontSize="{StaticResource FontSizeNP2}"
                                                                Robot="{Binding Path=SelectedRobot, Mode=TwoWay}"
                                                                DataFileIsHidden="{Binding Path=Settings.AccessDataFile, Source={x:Static Application.Current}}"
                                                                BlockedFolder="{Binding Path=Settings.AvailableFolders, Source={x:Static Application.Current}}"
                                                                Height="{Binding Path=ActualHeight, RelativeSource={RelativeSource AncestorType={x:Type RowDefinition}, Mode=FindAncestor}}"
                                                                ScrollViewer.CanContentScroll="False" ScrollViewer.VerticalScrollBarVisibility="Disabled"/>
                                </Grid>
                            </avalonDock:LayoutAnchorable>

                            <avalonDock:LayoutAnchorable Title="Управление" ContentId="Control" AutoHideMinWidth="900">
                                <Grid DataContext="{Binding Path=DataContext, RelativeSource={RelativeSource AncestorType={x:Type Page}, Mode=FindAncestor}}">
                                    <ListView SelectionMode="Single" Margin="0"
                                              FontSize="{StaticResource FontSizeNP4}" FontFamily="{StaticResource DefaultFont}" Foreground="{StaticResource ThemeFgP2Brush}"
                                              ScrollViewer.CanContentScroll="True"
                                              ScrollViewer.VerticalScrollBarVisibility="Auto"
                                              ScrollViewer.HorizontalScrollBarVisibility="Auto"
                                              ItemsSource="{Binding Path=RobotsCollection, Mode=OneWay}">

                                        <ListView.Resources>
                                            <Style x:Key="LvTextBase" TargetType="{x:Type FrameworkElement}" BasedOn="{StaticResource TextBase}">
                                                <Setter Property="TextElement.FontSize" Value="{StaticResource FontSizeNP4}"/>
                                                <Setter Property="TextElement.Foreground" Value="{StaticResource ThemeFgP2Brush}"/>
                                            </Style>

                                            <Style x:Key="UprControlButtonBase" TargetType="{x:Type Button}">
                                                <Setter Property="Height" Value="40"/>
                                                <Setter Property="Margin" Value="5"/>
                                            </Style>

                                            <Style TargetType="{x:Type Button}" BasedOn="{StaticResource UprControlButtonBase}"></Style>

                                            <DataTemplate x:Key="PanelLvDelete">
                                                <Button ToolTip="Удалить робота"
                                                        Width="{Binding Path=ActualHeight, RelativeSource={RelativeSource Self}}"
                                                        Command="{Binding Path=DataContext.DeleteRobotCommand, RelativeSource={RelativeSource AncestorType={x:Type Page}, Mode=FindAncestor}}"
                                                        CommandParameter="{Binding}">

                                                    <Path Fill="{StaticResource IconDeleteBrush}" Stretch="Uniform"
                                                          Data="{StaticResource DeletePathGeomerty}"/>
                                                </Button>
                                            </DataTemplate>

                                            <DataTemplate x:Key="PanelLvRobot">
                                                <DataTemplate.Resources>
                                                    <Style TargetType="{x:Type Button}" BasedOn="{StaticResource UprControlButtonBase}">
                                                        <Setter Property="Width" Value="{Binding Path=ActualHeight, RelativeSource={RelativeSource Self}}"/>
                                                    </Style>

                                                    <Style TargetType="{x:Type Path}">
                                                        <Setter Property="Stretch" Value="Uniform"/>
                                                    </Style>
                                                </DataTemplate.Resources>

                                                <Grid>
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="*"/>
                                                        <ColumnDefinition Width="5"/>
                                                        <ColumnDefinition Width="Auto"/>
                                                        <ColumnDefinition Width="Auto"/>
                                                        <ColumnDefinition Width="Auto"/>
                                                    </Grid.ColumnDefinitions>

                                                    <TextBlock Grid.Column="0" Text="{Binding Path=Name}" TextWrapping="Wrap"
                                                               TextAlignment="Center" VerticalAlignment="Center">

                                                        <TextBlock.ToolTip>
                                                            <MultiBinding Converter="{StaticResource StringFormatMultiConvert}" ConverterParameter="{}{0} : {1}">
                                                                <Binding Path="Host"/>
                                                                <Binding Path="Port"/>
                                                            </MultiBinding>
                                                        </TextBlock.ToolTip>
                                                    </TextBlock>

                                                    <Button Grid.Column="2" ToolTip="Переименовать робота"
                                                            Command="{Binding Path=DataContext.RenameRobotCommand, RelativeSource={RelativeSource AncestorType={x:Type Page}, Mode=FindAncestor}}"
                                                            CommandParameter="{Binding}">

                                                        <Path Fill="{StaticResource IconEditBrush}"
                                                              Data="{StaticResource EditPathGeomerty}">

                                                            <Path.LayoutTransform>
                                                                <RotateTransform Angle="90"/>
                                                            </Path.LayoutTransform>
                                                        </Path>
                                                    </Button>

                                                    <Button Grid.Column="3" ToolTip="Повторное соединение"
                                                            Command="{Binding Path=DataContext.ConnectedRobotCommand, RelativeSource={RelativeSource AncestorType={x:Type Page}, Mode=FindAncestor}}"
                                                            CommandParameter="{Binding}">

                                                        <Button.Style>
                                                            <Style TargetType="{x:Type Button}" BasedOn="{StaticResource UprControlButtonBase}">
                                                                <Setter Property="Width" Value="{Binding Path=ActualHeight, RelativeSource={RelativeSource Self}}"/>

                                                                <Style.Triggers>
                                                                    <DataTrigger Binding="{Binding Path=IsConnection}" Value="True">
                                                                        <Setter Property="Height" Value="0"/>
                                                                        <Setter Property="Margin" Value="0"/>
                                                                    </DataTrigger>

                                                                    <DataTrigger Binding="{Binding Path=Visibility, RelativeSource={RelativeSource Self}}" Value="Visible">
                                                                        <DataTrigger.EnterActions>
                                                                            <BeginStoryboard Name="StartBlinking">
                                                                                <Storyboard>
                                                                                    <DoubleAnimation Storyboard.TargetProperty="Opacity" From="0" To="1" RepeatBehavior="Forever" AutoReverse="True" Duration="0:0:1"/>
                                                                                </Storyboard>
                                                                            </BeginStoryboard>
                                                                        </DataTrigger.EnterActions>
                                                                    </DataTrigger>
                                                                </Style.Triggers>
                                                            </Style>
                                                        </Button.Style>

                                                        <Path Fill="{StaticResource IconUpDateBrush}" Data="{StaticResource UpDatePathGeomerty}"/>
                                                    </Button>

                                                    <Button Grid.Column="4" ToolTip="Закрыть соединение"
                                                            Command="{Binding Path=DataContext.DisconnectedRobotCommand, RelativeSource={RelativeSource AncestorType={x:Type Page}, Mode=FindAncestor}}"
                                                            CommandParameter="{Binding}">

                                                        <Button.Style>
                                                            <Style TargetType="{x:Type Button}" BasedOn="{StaticResource UprControlButtonBase}">
                                                                <Setter Property="Width" Value="{Binding Path=ActualHeight, RelativeSource={RelativeSource Self}}"/>

                                                                <Style.Triggers>
                                                                    <DataTrigger Binding="{Binding Path=IsConnection}" Value="False">
                                                                        <Setter Property="Height" Value="0"/>
                                                                        <Setter Property="Margin" Value="0"/>
                                                                    </DataTrigger>
                                                                </Style.Triggers>
                                                            </Style>
                                                        </Button.Style>

                                                        <Path Data="{StaticResource DisconnectPathGeomerty}"
                                                              Stroke="{StaticResource IconAddBrush}" StrokeThickness="2.5"/>
                                                    </Button>
                                                </Grid>
                                            </DataTemplate>

                                            <DataTemplate x:Key="PanelLvControl">
                                                <Menu Background="Transparent">
                                                    <Menu.Resources>
                                                        <Style x:Key="MenuItemBase" TargetType="{x:Type MenuItem}" BasedOn="{StaticResource LvTextBase}">
                                                            <Setter Property="HorizontalAlignment" Value="Left"/>
                                                            <Setter Property="Margin" Value="5"/>
                                                        </Style>

                                                        <Style TargetType="{x:Type MenuItem}" BasedOn="{StaticResource MenuItemBase}"></Style>

                                                        <Style x:Key="PathBase" TargetType="{x:Type Path}">
                                                            <Setter Property="Stretch" Value="Fill"/>
                                                            <Setter Property="StrokeThickness" Value="0"/>
                                                            <Setter Property="Height" Value="30"/>
                                                            <Setter Property="Width" Value="30"/>
                                                        </Style>

                                                        <Style TargetType="{x:Type Path}" BasedOn="{StaticResource PathBase}"></Style>

                                                        <ControlTemplate x:Key="SeparatorTemplate" TargetType="{x:Type MenuItem}">
                                                            <Separator Height="0" Margin="0,2"/>
                                                        </ControlTemplate>

                                                        <ControlTemplate x:Key="MenuItemTemplate" TargetType="{x:Type MenuItem}">
                                                            <Border Name="Panel" BorderThickness="0" Background="{StaticResource ThemeBgM1Brush}" CornerRadius="4">
                                                                <StackPanel Orientation="Horizontal" Margin="5">
                                                                    <ContentPresenter x:Name="Icon" ContentSource="Icon"/>
                                                                    <ContentPresenter ContentSource="Header" RecognizesAccessKey="True"
                                                                  TextElement.FontSize="{StaticResource FontSizeNP4}"
                                                                  VerticalAlignment="Center" Margin="10,0"
                                                                  Style="{StaticResource TextBase}"/>
                                                                </StackPanel>
                                                            </Border>

                                                            <ControlTemplate.Triggers>
                                                                <Trigger Property="IsMouseOver" Value="True">
                                                                    <Setter TargetName="Panel" Property="Background" Value="{StaticResource ThemeIsMouseOverMenuItemBgBrush}"/>
                                                                </Trigger>

                                                                <Trigger Property="IsPressed" Value="True">
                                                                    <Setter TargetName="Panel" Property="Background" Value="{StaticResource ThemeIsPressedMenuItemBgBrush}"/>
                                                                </Trigger>
                                                            </ControlTemplate.Triggers>
                                                        </ControlTemplate>
                                                    </Menu.Resources>

                                                    <Menu.ItemsPanel>
                                                        <ItemsPanelTemplate>
                                                            <WrapPanel Orientation="Horizontal" Margin="0, 5"/>
                                                        </ItemsPanelTemplate>
                                                    </Menu.ItemsPanel>

                                                    <MenuItem Template="{StaticResource MenuItemTemplate}">
                                                        <MenuItem.Icon>
                                                            <Path Stretch="Fill" StrokeThickness="0" Height="30" Width="30">
                                                                <Path.Style>
                                                                    <Style TargetType="{x:Type Path}" BasedOn="{StaticResource PathBase}">
                                                                        <Setter Property="Fill" Value="{StaticResource IconRunProgramBrush}"/>
                                                                        <Setter Property="Data" Value="{StaticResource RunProgramPathGeomerty}"/>

                                                                        <Style.Triggers>
                                                                            <DataTrigger Binding="{Binding Path=Pro_State}" Value="{x:Static model:ProcessStatuses.End}">
                                                                                <Setter Property="Fill" Value="{StaticResource IconRestartProgramBrush}"/>
                                                                                <Setter Property="Data" Value="{StaticResource RestartProgramPathGeomerty}"/>
                                                                            </DataTrigger>
                                                                        </Style.Triggers>
                                                                    </Style>
                                                                </Path.Style>
                                                            </Path>
                                                        </MenuItem.Icon>

                                                        <MenuItem.Style>
                                                            <Style TargetType="{x:Type MenuItem}" BasedOn="{StaticResource MenuItemBase}">
                                                                <Setter Property="Header" Value="Пуск"/>

                                                                <Style.Triggers>
                                                                    <DataTrigger Binding="{Binding Path=Pro_State}" Value="{x:Static model:ProcessStatuses.Stop}">
                                                                        <Setter Property="Header" Value="Продолжить"/>
                                                                    </DataTrigger>

                                                                    <DataTrigger Binding="{Binding Path=Pro_State}" Value="{x:Static model:ProcessStatuses.End}">
                                                                        <Setter Property="Header" Value="Перезапустить"/>
                                                                    </DataTrigger>
                                                                </Style.Triggers>
                                                            </Style>
                                                        </MenuItem.Style>

                                                        <i:Interaction.Triggers>
                                                            <i:EventTrigger EventName="PreviewMouseDown">
                                                                <i:InvokeCommandAction Command="{Binding Path=DataContext.RunProgramCommandAsync, RelativeSource={RelativeSource AncestorType={x:Type Page}, Mode=FindAncestor}}"
                                                                   CommandParameter="{Binding}"/>
                                                            </i:EventTrigger>

                                                            <i:EventTrigger EventName="PreviewMouseUp">
                                                                <i:InvokeCommandAction Command="{Binding Path=DataContext.RetentionRunButtonCommandAsync, RelativeSource={RelativeSource AncestorType={x:Type Page}, Mode=FindAncestor}}"
                                                                   CommandParameter="{Binding}"/>
                                                            </i:EventTrigger>
                                                        </i:Interaction.Triggers>
                                                    </MenuItem>

                                                    <MenuItem Template="{StaticResource MenuItemTemplate}" Header="Остановить" ToolTip="Аннулировать программу"
                                                              Command="{Binding Path=DataContext.PauseProgramCommandAsync, RelativeSource={RelativeSource AncestorType={x:Type Page}, Mode=FindAncestor}}"
                                                              CommandParameter="{Binding}">
                                                        <MenuItem.Icon>
                                                            <Path Data="{StaticResource StopProgramPathGeomerty}"
                                                                  Stretch="Fill" Fill="{StaticResource IconStopProgramBrush}" Height="30" Width="30"/>
                                                        </MenuItem.Icon>
                                                    </MenuItem>

                                                    <MenuItem Template="{StaticResource MenuItemTemplate}" Header="Анулировать" ToolTip="Аннулировать программу"
                                                              Command="{Binding Path=DataContext.CancelProgramCommandAsync, RelativeSource={RelativeSource AncestorType={x:Type Page}, Mode=FindAncestor}}"
                                                              CommandParameter="{Binding}">
                                                        <MenuItem.Icon>
                                                            <Path Data="{StaticResource CancelProgramPathGeomerty}"
                                                                  Fill="{StaticResource IconCancelProgramBrush}" StrokeThickness="0"/>
                                                        </MenuItem.Icon>
                                                    </MenuItem>
                                                </Menu>
                                            </DataTemplate>

                                            <DataTemplate x:Key="PanelLvStatus">
                                                <Grid>
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="20"/>
                                                        <ColumnDefinition Width="*"/>
                                                    </Grid.ColumnDefinitions>

                                                    <Ellipse Grid.Column="0"
                                                             Height="{Binding Path=ActualWidth, RelativeSource={RelativeSource Self}}"
                                                             Width="{Binding Path=ActualWidth, RelativeSource={RelativeSource AncestorType={x:Type ColumnDefinition}, Mode=FindAncestor}}">

                                                        <Ellipse.Style>
                                                            <Style TargetType="{x:Type Ellipse}">
                                                                <Style.Triggers>
                                                                    <DataTrigger Binding="{Binding Path=Pro_State}" Value="{x:Static model:ProcessStatuses.Active}">
                                                                        <DataTrigger.EnterActions>
                                                                            <BeginStoryboard x:Name="blinkAnimation">
                                                                                <Storyboard>
                                                                                    <DoubleAnimation Storyboard.TargetProperty="Opacity" From="0" To="1" RepeatBehavior="Forever" AutoReverse="True" Duration="0:0:1.25"/>
                                                                                </Storyboard>
                                                                            </BeginStoryboard>
                                                                        </DataTrigger.EnterActions>

                                                                        <DataTrigger.ExitActions>
                                                                            <StopStoryboard BeginStoryboardName="blinkAnimation"/>
                                                                        </DataTrigger.ExitActions>
                                                                    </DataTrigger>
                                                                </Style.Triggers>
                                                            </Style>
                                                        </Ellipse.Style>

                                                        <Ellipse.Fill>
                                                            <RadialGradientBrush>
                                                                <GradientStop Color="White" Offset="0"/>
                                                                <GradientStop Color="{Binding Path=Foreground.Color, ElementName=statusString}" Offset="1"/>
                                                            </RadialGradientBrush>
                                                        </Ellipse.Fill>
                                                    </Ellipse>

                                                    <TextBlock Grid.Column="1" x:Name="statusString" FontWeight="Bold" FontSize="{StaticResource FontSizeNP4}" 
                                                               HorizontalAlignment="Left" TextAlignment="Left" Margin="5,0"
                                                               Foreground="{Binding Path=Text, RelativeSource={RelativeSource Self}, Converter={StaticResource StatusColorConvert}}">

                                                        <TextBlock.Style>
                                                            <Style TargetType="{x:Type TextBlock}" BasedOn="{StaticResource LvTextBase}">
                                                                <Setter Property="Text" Value="Нет соединения"/>
                                                                <Setter Property="TextWrapping" Value="Wrap"/>

                                                                <Style.Triggers>
                                                                    <DataTrigger Binding="{Binding Path=Pro_State}" Value="{x:Static model:ProcessStatuses.Free}">
                                                                        <Setter Property="Text" Value="Программа не выбрана"/>
                                                                    </DataTrigger>

                                                                    <DataTrigger Binding="{Binding Path=Pro_State}" Value="{x:Static model:ProcessStatuses.Reset}">
                                                                        <Setter Property="Text">
                                                                            <Setter.Value>
                                                                                <MultiBinding Converter="{StaticResource StringFormatMultiConvert}" ConverterParameter="Выбрана программа {0}">
                                                                                    <Binding Path="RobotProgramName" Mode="OneWay"/>
                                                                                </MultiBinding>
                                                                            </Setter.Value>
                                                                        </Setter>
                                                                    </DataTrigger>

                                                                    <DataTrigger Binding="{Binding Path=Pro_State}" Value="{x:Static model:ProcessStatuses.Active}">
                                                                        <Setter Property="Text">
                                                                            <Setter.Value>
                                                                                <MultiBinding Converter="{StaticResource StringFormatMultiConvert}" ConverterParameter="Запущена программа {0}">
                                                                                    <Binding Path="RobotProgramName" Mode="OneWay"/>
                                                                                </MultiBinding>
                                                                            </Setter.Value>
                                                                        </Setter>
                                                                    </DataTrigger>

                                                                    <DataTrigger Binding="{Binding Path=Pro_State}" Value="{x:Static model:ProcessStatuses.Stop}">
                                                                        <Setter Property="Text">
                                                                            <Setter.Value>
                                                                                <MultiBinding Converter="{StaticResource StringFormatMultiConvert}" ConverterParameter="Программа {0} остановлена">
                                                                                    <Binding Path="RobotProgramName" Mode="OneWay"/>
                                                                                </MultiBinding>
                                                                            </Setter.Value>
                                                                        </Setter>
                                                                    </DataTrigger>

                                                                    <DataTrigger Binding="{Binding Path=Pro_State}" Value="{x:Static model:ProcessStatuses.End}">
                                                                        <Setter Property="Text">
                                                                            <Setter.Value>
                                                                                <MultiBinding Converter="{StaticResource StringFormatMultiConvert}" ConverterParameter="Программа {0} завершена">
                                                                                    <Binding Path="RobotProgramName" Mode="OneWay"/>
                                                                                </MultiBinding>
                                                                            </Setter.Value>
                                                                        </Setter>
                                                                    </DataTrigger>
                                                                </Style.Triggers>
                                                            </Style>
                                                        </TextBlock.Style>
                                                    </TextBlock>
                                                </Grid>
                                            </DataTemplate>
                                        </ListView.Resources>

                                        <ListView.ItemContainerStyle>
                                            <Style TargetType="{x:Type ListViewItem}">
                                                <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
                                            </Style>
                                        </ListView.ItemContainerStyle>

                                        <ListView.View>
                                            <GridView>
                                                <GridViewColumn CellTemplate="{StaticResource PanelLvDelete}" Width="Auto"></GridViewColumn>
                                                <GridViewColumn CellTemplate="{StaticResource PanelLvRobot}" Width="Auto"></GridViewColumn>
                                                <GridViewColumn CellTemplate="{StaticResource PanelLvControl}" Width="Auto"></GridViewColumn>
                                                <GridViewColumn CellTemplate="{StaticResource PanelLvStatus}">Статус</GridViewColumn>
                                            </GridView>
                                        </ListView.View>

                                        <i:Interaction.Triggers>
                                            <i:EventTrigger EventName="MouseDoubleClick">
                                                <i:InvokeCommandAction Command="{Binding Path=SelectRobotCommand}"
                                                   CommandParameter="{Binding Path=., RelativeSource={RelativeSource AncestorType={x:Type ListView}, Mode=FindAncestor}}"/>
                                            </i:EventTrigger>
                                        </i:Interaction.Triggers>
                                    </ListView>
                                </Grid>
                            </avalonDock:LayoutAnchorable>
                        </avalonDock:LayoutAnchorGroup>
                    </avalonDock:LayoutAnchorSide>
                </avalonDock:LayoutRoot.RightSide>
            </avalonDock:LayoutRoot>

            <i:Interaction.Behaviors>
                <behavior:CollapedLayoutAnchorableBehavior/>
            </i:Interaction.Behaviors>

            <i:Interaction.Triggers>
                <i:EventTrigger EventName="Loaded">
                    <i:InvokeCommandAction Command="{Binding Path=LoadedCommand}"/>
                </i:EventTrigger>
            </i:Interaction.Triggers>
        </avalonDock:DockingManager>

        <DockPanel Grid.Row="3" Background="{StaticResource ThemeBottomMenuBarBrush}">
            
        </DockPanel>
    </Grid>
</Page>
